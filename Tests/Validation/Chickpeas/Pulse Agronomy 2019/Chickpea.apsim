<?xml version="1.0" encoding="UTF-8"?>
<folder version="36" name="Simulations">
  <folder name="Plots">
    <RGraphics name="Flowering DAS x site">
      <script>
        <text># Make some plots
library(dplyr)
library(ggplot2)
library(gridExtra)
library(grid)

options(stringsAsFactors = F)

#### Cultivar groups
groups&lt;- list()
groups[["early"]] &lt;- c("HallmarkXT", "Bolt")
groups[["mid"]] &lt;- c("Blitz", "Jumbo2")
groups[["late"]] &lt;- c("Nugget", "Digger", "Greenfield", "Northfield")

# Generic function to read apsim output files. 
read.apsim &lt;- function(apsim.name) {
  header&lt;-readLines(apsim.name, n=25)
  if (length(header) == 0 ) {return(NULL)}
  i&lt;-3  # 4th line
  apsim &lt;- read.table(apsim.name,skip=i+1,na.strings=c("NA","?"))
  names(apsim) &lt;- unlist(strsplit(trimws(header[i]), " +"))  
#  cat(apsim.name, " = ", ncol(apsim), "\n")
  return(cbind(filename=apsim.name, apsim))
}

capitalise &lt;- function(x) {
  s &lt;- strsplit(x, " ")[[1]]
  paste(toupper(substring(s, 1,1)), tolower(substring(s, 2)),
        sep="", collapse=" ")
}

df.pred&lt;- do.call(rbind, lapply(list.files(pattern="^.*Harvest\\.out$"), read.apsim))
df.pred$SimulationName&lt;- tolower(sapply(strsplit(df.pred$filename, " "), function (x) {return(x[1])}))
df.pred$TOS &lt;- toupper(df.pred$TOS)
df.pred$site &lt;- sapply(df.pred$site, capitalise)
df.pred$cultivar &lt;- sapply(df.pred$cultivar, capitalise)
df.pred&lt;- df.pred[,c("SimulationName", "site", "TOS", "cultivar", "FloweringDAS", "MaturityDAS", "biomass", "yield", "MaxLAI")]

df.obs&lt;-  read.csv("Lentil auto observed.csv")
df.obs$SimulationName&lt;- tolower(df.obs$SimulationName)
df.obs$cultivar &lt;- sapply(df.obs$cultivar, capitalise)
df.obs$site &lt;- sapply(df.obs$site, capitalise)

df &lt;- df.obs %&gt;% left_join(df.pred[,!names(df.pred) %in% c("site", "TOS", "cultivar")], 
                           by=c("SimulationName"), 
                           suffix = c(".obs", ".pred"))

jpeg(imageFileName, width=width, height=height)
g&lt;-ggplot(df[!is.na(df$FloweringDAS.obs),]) + geom_point(aes(x=FloweringDAS.obs, y=FloweringDAS.pred, color=site)) + 
    scale_x_continuous(limits=range(na.omit(c(df$FloweringDAS.obs, df$FloweringDAS.pred)))) +
    scale_y_continuous(limits=range(na.omit(c(df$FloweringDAS.obs, df$FloweringDAS.pred)))) +
  labs(title="Flowering DAS", x="Observed", y = "Predicted") +
  geom_abline(intercept=0, colour="grey") + theme_minimal()
  
print(g)
dev.off()

</text>
      </script>
    </RGraphics>
    <RGraphics name="Flowering DAS x cultivar">
      <script>
        <text># Make some plots
library(dplyr)
library(ggplot2)
library(gridExtra)
library(grid)

options(stringsAsFactors = F)

#### Cultivar groups
groups&lt;- list()
groups[["early"]] &lt;- c("HallmarkXT", "Bolt")
groups[["mid"]] &lt;- c("Blitz", "Jumbo2")
groups[["late"]] &lt;- c("Nugget", "Digger", "Greenfield", "Northfield")

# Generic function to read apsim output files. 
read.apsim &lt;- function(apsim.name) {
  header&lt;-readLines(apsim.name, n=25)
  if (length(header) == 0 ) {return(NULL)}
  i&lt;-3  # 4th line
  apsim &lt;- read.table(apsim.name,skip=i+1,na.strings=c("NA","?"))
  names(apsim) &lt;- unlist(strsplit(trimws(header[i]), " +"))  
#  cat(apsim.name, " = ", ncol(apsim), "\n")
  return(cbind(filename=apsim.name, apsim))
}

capitalise &lt;- function(x) {
  s &lt;- strsplit(x, " ")[[1]]
  paste(toupper(substring(s, 1,1)), tolower(substring(s, 2)),
        sep="", collapse=" ")
}

df.pred&lt;- do.call(rbind, lapply(list.files(pattern="^.*Harvest\\.out$"), read.apsim))
df.pred$SimulationName&lt;- tolower(sapply(strsplit(df.pred$filename, " "), function (x) {return(x[1])}))
df.pred$TOS &lt;- toupper(df.pred$TOS)
df.pred$site &lt;- sapply(df.pred$site, capitalise)
df.pred$cultivar &lt;- sapply(df.pred$cultivar, capitalise)
df.pred&lt;- df.pred[,c("SimulationName", "site", "TOS", "cultivar", "FloweringDAS", "MaturityDAS", "biomass", "yield", "MaxLAI")]

df.obs&lt;-  read.csv("Lentil auto observed.csv")
df.obs$SimulationName&lt;- tolower(df.obs$SimulationName)
df.obs$cultivar &lt;- sapply(df.obs$cultivar, capitalise)
df.obs$site &lt;- sapply(df.obs$site, capitalise)

df &lt;- df.obs %&gt;% left_join(df.pred[,!names(df.pred) %in% c("site", "TOS", "cultivar")], 
                           by=c("SimulationName"), 
                           suffix = c(".obs", ".pred"))

jpeg(imageFileName, width=width, height=height)
g&lt;-ggplot(df[!is.na(df$FloweringDAS.obs),]) + geom_point(aes(x=FloweringDAS.obs, y=FloweringDAS.pred, color=cultivar)) + 
    scale_x_continuous(limits=range(na.omit(c(df$FloweringDAS.obs, df$FloweringDAS.pred)))) +
    scale_y_continuous(limits=range(na.omit(c(df$FloweringDAS.obs, df$FloweringDAS.pred)))) +
  labs(title="Flowering DAS", x="Observed", y = "Predicted") +
  geom_abline(intercept=0, colour="grey") + theme_minimal()
  
print(g)
dev.off()

</text>
      </script>
    </RGraphics>
    <RGraphics name="Maturity DAS x site">
      <script>
        <text># Make some plots
library(dplyr)
library(ggplot2)
library(gridExtra)
library(grid)

options(stringsAsFactors = F)

#### Cultivar groups
groups&lt;- list()
groups[["early"]] &lt;- c("HallmarkXT", "Bolt")
groups[["mid"]] &lt;- c("Blitz", "Jumbo2")
groups[["late"]] &lt;- c("Nugget", "Digger", "Greenfield", "Northfield")

# Generic function to read apsim output files. 
read.apsim &lt;- function(apsim.name) {
  header&lt;-readLines(apsim.name, n=25)
  if (length(header) == 0 ) {return(NULL)}
  i&lt;-3  # 4th line
  apsim &lt;- read.table(apsim.name,skip=i+1,na.strings=c("NA","?"))
  names(apsim) &lt;- unlist(strsplit(trimws(header[i]), " +"))  
#  cat(apsim.name, " = ", ncol(apsim), "\n")
  return(cbind(filename=apsim.name, apsim))
}

capitalise &lt;- function(x) {
  s &lt;- strsplit(x, " ")[[1]]
  paste(toupper(substring(s, 1,1)), tolower(substring(s, 2)),
        sep="", collapse=" ")
}

df.pred&lt;- do.call(rbind, lapply(list.files(pattern="^.*Harvest\\.out$"), read.apsim))
df.pred$SimulationName&lt;- tolower(sapply(strsplit(df.pred$filename, " "), function (x) {return(x[1])}))
df.pred$TOS &lt;- toupper(df.pred$TOS)
df.pred$site &lt;- sapply(df.pred$site, capitalise)
df.pred$cultivar &lt;- sapply(df.pred$cultivar, capitalise)
df.pred&lt;- df.pred[,c("SimulationName", "site", "TOS", "cultivar", "FloweringDAS", "MaturityDAS", "biomass", "yield", "MaxLAI")]

df.obs&lt;-  read.csv("Lentil auto observed.csv")
df.obs$SimulationName&lt;- tolower(df.obs$SimulationName)
df.obs$cultivar &lt;- sapply(df.obs$cultivar, capitalise)
df.obs$site &lt;- sapply(df.obs$site, capitalise)

df &lt;- df.obs %&gt;% left_join(df.pred[,!names(df.pred) %in% c("site", "TOS", "cultivar")], 
                           by=c("SimulationName"), 
                           suffix = c(".obs", ".pred"))

jpeg(imageFileName, width=width, height=height)
g&lt;-ggplot(df[!is.na(df$MaturityDAS.obs),]) + geom_point(aes(x=MaturityDAS.obs, y=MaturityDAS.pred, color=site)) + 
  scale_x_continuous(limits=range(na.omit(c(df$MaturityDAS.obs, df$MaturityDAS.pred)))) +
  scale_y_continuous(limits=range(na.omit(c(df$MaturityDAS.obs, df$MaturityDAS.pred)))) +
  labs(title="Maturity DAS", x="Observed", y = "Predicted") +
  geom_abline(intercept=0, colour="grey") +
  theme_minimal()
    
print(g)
dev.off()

</text>
      </script>
    </RGraphics>
    <RGraphics name="Maturity DAS x cultivar">
      <script>
        <text># Make some plots
library(dplyr)
library(ggplot2)
library(gridExtra)
library(grid)

options(stringsAsFactors = F)

#### Cultivar groups
groups&lt;- list()
groups[["early"]] &lt;- c("HallmarkXT", "Bolt")
groups[["mid"]] &lt;- c("Blitz", "Jumbo2")
groups[["late"]] &lt;- c("Nugget", "Digger", "Greenfield", "Northfield")

# Generic function to read apsim output files. 
read.apsim &lt;- function(apsim.name) {
  header&lt;-readLines(apsim.name, n=25)
  if (length(header) == 0 ) {return(NULL)}
  i&lt;-3  # 4th line
  apsim &lt;- read.table(apsim.name,skip=i+1,na.strings=c("NA","?"))
  names(apsim) &lt;- unlist(strsplit(trimws(header[i]), " +"))  
#  cat(apsim.name, " = ", ncol(apsim), "\n")
  return(cbind(filename=apsim.name, apsim))
}

capitalise &lt;- function(x) {
  s &lt;- strsplit(x, " ")[[1]]
  paste(toupper(substring(s, 1,1)), tolower(substring(s, 2)),
        sep="", collapse=" ")
}

df.pred&lt;- do.call(rbind, lapply(list.files(pattern="^.*Harvest\\.out$"), read.apsim))
df.pred$SimulationName&lt;- tolower(sapply(strsplit(df.pred$filename, " "), function (x) {return(x[1])}))
df.pred$TOS &lt;- toupper(df.pred$TOS)
df.pred$site &lt;- sapply(df.pred$site, capitalise)
df.pred$cultivar &lt;- sapply(df.pred$cultivar, capitalise)
df.pred&lt;- df.pred[,c("SimulationName", "site", "TOS", "cultivar", "FloweringDAS", "MaturityDAS", "biomass", "yield", "MaxLAI")]

df.obs&lt;-  read.csv("Lentil auto observed.csv")
df.obs$SimulationName&lt;- tolower(df.obs$SimulationName)
df.obs$cultivar &lt;- sapply(df.obs$cultivar, capitalise)
df.obs$site &lt;- sapply(df.obs$site, capitalise)

df &lt;- df.obs %&gt;% left_join(df.pred[,!names(df.pred) %in% c("site", "TOS", "cultivar")], 
                           by=c("SimulationName"), 
                           suffix = c(".obs", ".pred"))

jpeg(imageFileName, width=width, height=height)
g&lt;-ggplot(df[!is.na(df$MaturityDAS.obs),]) + geom_point(aes(x=MaturityDAS.obs, y=MaturityDAS.pred, color=cultivar)) + 
  scale_x_continuous(limits=range(na.omit(c(df$MaturityDAS.obs, df$MaturityDAS.pred)))) +
  scale_y_continuous(limits=range(na.omit(c(df$MaturityDAS.obs, df$MaturityDAS.pred)))) +
  labs(title="Maturity DAS", x="Observed", y = "Predicted") +
  geom_abline(intercept=0, colour="grey") +
  theme_minimal()
    
print(g)
dev.off()

</text>
      </script>
    </RGraphics>
    <RGraphics name="Harvest biomass">
      <script>
        <text># Make some plots
library(dplyr)
library(ggplot2)
library(gridExtra)
library(grid)

options(stringsAsFactors = F)

#### Cultivar groups
groups&lt;- list()
groups[["early"]] &lt;- c("HallmarkXT", "Bolt")
groups[["mid"]] &lt;- c("Blitz", "Jumbo2")
groups[["late"]] &lt;- c("Nugget", "Digger", "Greenfield", "Northfield")

# Generic function to read apsim output files. 
read.apsim &lt;- function(apsim.name) {
  header&lt;-readLines(apsim.name, n=25)
  if (length(header) == 0 ) {return(NULL)}
  i&lt;-3  # 4th line
  apsim &lt;- read.table(apsim.name,skip=i+1,na.strings=c("NA","?"))
  names(apsim) &lt;- unlist(strsplit(trimws(header[i]), " +"))  
#  cat(apsim.name, " = ", ncol(apsim), "\n")
  return(cbind(filename=apsim.name, apsim))
}

capitalise &lt;- function(x) {
  s &lt;- strsplit(x, " ")[[1]]
  paste(toupper(substring(s, 1,1)), tolower(substring(s, 2)),
        sep="", collapse=" ")
}

df.pred&lt;- do.call(rbind, lapply(list.files(pattern="^.*Harvest\\.out$"), read.apsim))
df.pred$SimulationName&lt;- tolower(sapply(strsplit(df.pred$filename, " "), function (x) {return(x[1])}))
df.pred$TOS &lt;- toupper(df.pred$TOS)
df.pred$site &lt;- sapply(df.pred$site, capitalise)
df.pred$cultivar &lt;- sapply(df.pred$cultivar, capitalise)
df.pred&lt;- df.pred[,c("SimulationName", "site", "TOS", "cultivar", "FloweringDAS", "MaturityDAS", "biomass", "yield", "MaxLAI")]

df.obs&lt;-  read.csv("Lentil auto observed.csv")
df.obs$SimulationName&lt;- tolower(df.obs$SimulationName)
df.obs$cultivar &lt;- sapply(df.obs$cultivar, capitalise)
df.obs$site &lt;- sapply(df.obs$site, capitalise)

df &lt;- df.obs %&gt;% left_join(df.pred[,!names(df.pred) %in% c("site", "TOS", "cultivar")], 
                           by=c("SimulationName"), 
                           suffix = c(".obs", ".pred"))

jpeg(imageFileName, width=width, height=height)
g&lt;-ggplot(df[!is.na(df$biomass.obs),]) + geom_point(aes(x=biomass.obs, y=biomass.pred, color=cultivar)) + 
  scale_x_continuous(limits=range(na.omit(c(df$biomass.obs, df$biomass.pred)))) +
  scale_y_continuous(limits=range(na.omit(c(df$biomass.obs, df$biomass.pred)))) +
  labs(title="Biomass (kg/ha)", x="Observed", y = "Predicted") +
  geom_abline(intercept=0, colour="grey") + facet_wrap(~site) +
  theme_minimal()

print(g)
dev.off()

</text>
      </script>
    </RGraphics>
    <RGraphics name="Harvest yield">
      <script>
        <text># Make some plots
library(dplyr)
library(ggplot2)
library(gridExtra)
library(grid)

options(stringsAsFactors = F)

#### Cultivar groups
groups&lt;- list()
groups[["early"]] &lt;- c("HallmarkXT", "Bolt")
groups[["mid"]] &lt;- c("Blitz", "Jumbo2")
groups[["late"]] &lt;- c("Nugget", "Digger", "Greenfield", "Northfield")

# Generic function to read apsim output files. 
read.apsim &lt;- function(apsim.name) {
  header&lt;-readLines(apsim.name, n=25)
  if (length(header) == 0 ) {return(NULL)}
  i&lt;-3  # 4th line
  apsim &lt;- read.table(apsim.name,skip=i+1,na.strings=c("NA","?"))
  names(apsim) &lt;- unlist(strsplit(trimws(header[i]), " +"))  
#  cat(apsim.name, " = ", ncol(apsim), "\n")
  return(cbind(filename=apsim.name, apsim))
}

capitalise &lt;- function(x) {
  s &lt;- strsplit(x, " ")[[1]]
  paste(toupper(substring(s, 1,1)), tolower(substring(s, 2)),
        sep="", collapse=" ")
}

df.pred&lt;- do.call(rbind, lapply(list.files(pattern="^.*Harvest\\.out$"), read.apsim))
df.pred$SimulationName&lt;- tolower(sapply(strsplit(df.pred$filename, " "), function (x) {return(x[1])}))
df.pred$TOS &lt;- toupper(df.pred$TOS)
df.pred$site &lt;- sapply(df.pred$site, capitalise)
df.pred$cultivar &lt;- sapply(df.pred$cultivar, capitalise)
df.pred&lt;- df.pred[,c("SimulationName", "site", "TOS", "cultivar", "FloweringDAS", "MaturityDAS", "biomass", "yield", "MaxLAI")]

df.obs&lt;-  read.csv("Lentil auto observed.csv")
df.obs$SimulationName&lt;- tolower(df.obs$SimulationName)
df.obs$cultivar &lt;- sapply(df.obs$cultivar, capitalise)
df.obs$site &lt;- sapply(df.obs$site, capitalise)

df &lt;- df.obs %&gt;% left_join(df.pred[,!names(df.pred) %in% c("site", "TOS", "cultivar")], 
                           by=c("SimulationName"), 
                           suffix = c(".obs", ".pred"))

jpeg(imageFileName, width=width, height=height)
g&lt;-ggplot(df[!is.na(df$yield.obs),]) + geom_point(aes(x=yield.obs, y=yield.pred, color=cultivar)) + 
  scale_x_continuous(limits=range(na.omit(c(df$yield.obs, df$yield.pred)))) +
  scale_y_continuous(limits=range(na.omit(c(df$yield.obs, df$yield.pred)))) +
  labs(title="Yield (kg/ha)", x="Observed", y = "Predicted") +
  geom_abline(intercept=0, colour="grey") + facet_wrap(~site) +
  theme_minimal()
print(g)
dev.off()

</text>
      </script>
    </RGraphics>
    <RGraphics name="ESW (0-600)">
      <script>
        <text>library(dplyr)
library(ggplot2)
library(gridExtra)
library(grid)
library(data.table)

options(stringsAsFactors = F)

# Generic function to read apsim output files. Adds factor levels if found.
read.apsim &lt;- function(apsim.name) {
  header&lt;-readLines(apsim.name, n=25)
  if (length(header) == 0 ) {return(NULL)}
  i&lt;-3  # 4th line
  apsim &lt;- read.table(apsim.name,skip=i+1,na.strings=c("NA","?"))
  names(apsim) &lt;- unlist(strsplit(trimws(header[i]), " +"))
  
  #cat(apsim.name, " = ", ncol(apsim), "\n")
  return(cbind(filename=apsim.name, apsim))
}

capitalise &lt;- function(x) {
  s &lt;- strsplit(x, " ")[[1]]
  paste(toupper(substring(s, 1,1)), tolower(substring(s, 2)),
        sep="", collapse=" ")
}

groups&lt;- list()
groups[["early"]] &lt;- c("HallmarkXT", "Bolt")
groups[["mid"]] &lt;- c("Blitz", "Jumbo2", "Ace")
groups[["late"]] &lt;- c("Nugget", "Digger", "Greenfield", "Northfield")

df.pred&lt;- rbindlist( lapply(list.files(pattern="^.*Daily\\.out$"), read.apsim), fill=T)
df.pred$SimulationName&lt;- tolower(sapply(strsplit(df.pred$filename, " "), function (x) {return(x[1])}))
df.pred$TOS &lt;- toupper(df.pred$TOS)
df.pred$site &lt;- sapply(df.pred$site, capitalise)
df.pred$cultivar &lt;- sapply(df.pred$cultivar, capitalise)
df.pred$Date &lt;- as.Date(df.pred$Date, format="%d/%m/%Y")
colnames(df.pred)[which(names(df.pred) == "esw_0_600")] &lt;-"esw(0-600)"
colnames(df.pred)[which(names(df.pred) == "esw_100_600")] &lt;-"esw(100-600)"

df.pred$cvgroup &lt;- ifelse(df.pred$cultivar %in% groups[["early"]], "Early",
                            ifelse(df.pred$cultivar %in% groups[["mid"]], "Mid",
                                   ifelse(df.pred$cultivar %in% groups[["late"]], "Late", NA)))


df.obs&lt;-  read.csv("Lentil auto observed daily.csv")
df.obs$SimulationName&lt;- tolower(df.obs$SimulationName)
df.obs$cultivar &lt;- sapply(df.obs$cultivar, capitalise)
df.obs$site &lt;- sapply(df.obs$site, capitalise)
df.obs$Date &lt;- as.Date(df.obs$Date, format="%d/%m/%Y")
df.obs$cvgroup &lt;- ifelse(df.obs$cultivar %in% groups[["early"]], "Early",
                          ifelse(df.obs$cultivar %in% groups[["mid"]], "Mid",
                                 ifelse(df.obs$cultivar %in% groups[["late"]], "Late", NA)))


colnames(df.obs)[which(names(df.obs) == "sw.1.")] &lt;-"sw(1)"
colnames(df.obs)[which(names(df.obs) == "sw.2.")] &lt;-"sw(2)"
colnames(df.obs)[which(names(df.obs) == "sw.3.")] &lt;-"sw(3)"
colnames(df.obs)[which(names(df.obs) == "sw.4.")] &lt;-"sw(4)"
colnames(df.obs)[which(names(df.obs) == "sw.5.")] &lt;-"sw(5)"
colnames(df.obs)[which(names(df.obs) == "sw.6.")] &lt;-"sw(6)"
colnames(df.obs)[which(names(df.obs) == "sw.7.")] &lt;-"sw(7)"

colnames(df.obs)[which(names(df.obs) == "esw.1.")] &lt;-"esw(1)"
colnames(df.obs)[which(names(df.obs) == "esw.2.")] &lt;-"esw(2)"
colnames(df.obs)[which(names(df.obs) == "esw.3.")] &lt;-"esw(3)"
colnames(df.obs)[which(names(df.obs) == "esw.4.")] &lt;-"esw(4)"
colnames(df.obs)[which(names(df.obs) == "esw.5.")] &lt;-"esw(5)"
colnames(df.obs)[which(names(df.obs) == "esw.6.")] &lt;-"esw(6)"
colnames(df.obs)[which(names(df.obs) == "esw.7.")] &lt;-"esw(7)"

colnames(df.obs)[which(names(df.obs) == "esw_0_600")] &lt;-"esw(0-600)"
colnames(df.obs)[which(names(df.obs) == "esw_100_600")] &lt;-"esw(100-600)"


#table(df.obs$`sw(2)` &gt; 0 , df.obs$site)

# merge together 
df &lt;- df.pred %&gt;% 
  left_join(select(df.obs, -one_of( c("site", "TOS", "cultivar", "cvgroup", "Date"))), 
     by=c("SimulationName", "DaysAfterSowing"), 
     suffix = c(".pred", ".obs")) 

jpeg(imageFileName, width=width, height=height)

g&lt;-ggplot(df) + geom_abline(intercept=0, colour="lightgrey") +
  geom_point(aes(x=`esw(0-600).obs`, y=`esw(0-600).pred`, color=site), na.rm = TRUE) + 
  labs(title="All esw (0-600)") + 
  theme_minimal()
print(g)

dev.off()</text>
      </script>
    </RGraphics>
    <RGraphics name="ESW (100-600)">
      <script>
        <text>library(dplyr)
library(ggplot2)
library(gridExtra)
library(grid)
library(data.table)

options(stringsAsFactors = F)

# Generic function to read apsim output files. Adds factor levels if found.
read.apsim &lt;- function(apsim.name) {
  header&lt;-readLines(apsim.name, n=25)
  if (length(header) == 0 ) {return(NULL)}
  i&lt;-3  # 4th line
  apsim &lt;- read.table(apsim.name,skip=i+1,na.strings=c("NA","?"))
  names(apsim) &lt;- unlist(strsplit(trimws(header[i]), " +"))
  
  #cat(apsim.name, " = ", ncol(apsim), "\n")
  return(cbind(filename=apsim.name, apsim))
}

capitalise &lt;- function(x) {
  s &lt;- strsplit(x, " ")[[1]]
  paste(toupper(substring(s, 1,1)), tolower(substring(s, 2)),
        sep="", collapse=" ")
}

groups&lt;- list()
groups[["early"]] &lt;- c("HallmarkXT", "Bolt")
groups[["mid"]] &lt;- c("Blitz", "Jumbo2", "Ace")
groups[["late"]] &lt;- c("Nugget", "Digger", "Greenfield", "Northfield")

df.pred&lt;- rbindlist( lapply(list.files(pattern="^.*Daily\\.out$"), read.apsim), fill=T)
df.pred$SimulationName&lt;- tolower(sapply(strsplit(df.pred$filename, " "), function (x) {return(x[1])}))
df.pred$TOS &lt;- toupper(df.pred$TOS)
df.pred$site &lt;- sapply(df.pred$site, capitalise)
df.pred$cultivar &lt;- sapply(df.pred$cultivar, capitalise)
df.pred$Date &lt;- as.Date(df.pred$Date, format="%d/%m/%Y")
colnames(df.pred)[which(names(df.pred) == "esw_0_600")] &lt;-"esw(0-600)"
colnames(df.pred)[which(names(df.pred) == "esw_100_600")] &lt;-"esw(100-600)"

df.pred$cvgroup &lt;- ifelse(df.pred$cultivar %in% groups[["early"]], "Early",
                            ifelse(df.pred$cultivar %in% groups[["mid"]], "Mid",
                                   ifelse(df.pred$cultivar %in% groups[["late"]], "Late", NA)))


df.obs&lt;-  read.csv("Lentil auto observed daily.csv")
df.obs$SimulationName&lt;- tolower(df.obs$SimulationName)
df.obs$cultivar &lt;- sapply(df.obs$cultivar, capitalise)
df.obs$site &lt;- sapply(df.obs$site, capitalise)
df.obs$Date &lt;- as.Date(df.obs$Date, format="%d/%m/%Y")
df.obs$cvgroup &lt;- ifelse(df.obs$cultivar %in% groups[["early"]], "Early",
                          ifelse(df.obs$cultivar %in% groups[["mid"]], "Mid",
                                 ifelse(df.obs$cultivar %in% groups[["late"]], "Late", NA)))


colnames(df.obs)[which(names(df.obs) == "sw.1.")] &lt;-"sw(1)"
colnames(df.obs)[which(names(df.obs) == "sw.2.")] &lt;-"sw(2)"
colnames(df.obs)[which(names(df.obs) == "sw.3.")] &lt;-"sw(3)"
colnames(df.obs)[which(names(df.obs) == "sw.4.")] &lt;-"sw(4)"
colnames(df.obs)[which(names(df.obs) == "sw.5.")] &lt;-"sw(5)"
colnames(df.obs)[which(names(df.obs) == "sw.6.")] &lt;-"sw(6)"
colnames(df.obs)[which(names(df.obs) == "sw.7.")] &lt;-"sw(7)"

colnames(df.obs)[which(names(df.obs) == "esw.1.")] &lt;-"esw(1)"
colnames(df.obs)[which(names(df.obs) == "esw.2.")] &lt;-"esw(2)"
colnames(df.obs)[which(names(df.obs) == "esw.3.")] &lt;-"esw(3)"
colnames(df.obs)[which(names(df.obs) == "esw.4.")] &lt;-"esw(4)"
colnames(df.obs)[which(names(df.obs) == "esw.5.")] &lt;-"esw(5)"
colnames(df.obs)[which(names(df.obs) == "esw.6.")] &lt;-"esw(6)"
colnames(df.obs)[which(names(df.obs) == "esw.7.")] &lt;-"esw(7)"

colnames(df.obs)[which(names(df.obs) == "esw_0_600")] &lt;-"esw(0-600)"
colnames(df.obs)[which(names(df.obs) == "esw_100_600")] &lt;-"esw(100-600)"


#table(df.obs$`sw(2)` &gt; 0 , df.obs$site)

# merge together 
df &lt;- df.pred %&gt;% 
  left_join(select(df.obs, -one_of( c("site", "TOS", "cultivar", "cvgroup", "Date"))), 
     by=c("SimulationName", "DaysAfterSowing"), 
     suffix = c(".pred", ".obs")) 

jpeg(imageFileName, width=width, height=height)

g&lt;-ggplot(df) + geom_abline(intercept=0, colour="lightgrey") +
  geom_point(aes(x=`esw(100-600).obs`, y=`esw(100-600).pred`, color=site), na.rm = TRUE) + 
  labs(title="All esw (100-600)") + 
  theme_minimal()
print(g)

dev.off()</text>
      </script>
    </RGraphics>
    <RGraphics name="sw(1)">
      <script>
        <text>library(dplyr)
library(ggplot2)
library(gridExtra)
library(grid)
library(data.table)

options(stringsAsFactors = F)

# Generic function to read apsim output files. Adds factor levels if found.
read.apsim &lt;- function(apsim.name) {
  header&lt;-readLines(apsim.name, n=25)
  if (length(header) == 0 ) {return(NULL)}
  i&lt;-3  # 4th line
  apsim &lt;- read.table(apsim.name,skip=i+1,na.strings=c("NA","?"))
  names(apsim) &lt;- unlist(strsplit(trimws(header[i]), " +"))
  
  #cat(apsim.name, " = ", ncol(apsim), "\n")
  return(cbind(filename=apsim.name, apsim))
}

capitalise &lt;- function(x) {
  s &lt;- strsplit(x, " ")[[1]]
  paste(toupper(substring(s, 1,1)), tolower(substring(s, 2)),
        sep="", collapse=" ")
}

groups&lt;- list()
groups[["early"]] &lt;- c("HallmarkXT", "Bolt")
groups[["mid"]] &lt;- c("Blitz", "Jumbo2", "Ace")
groups[["late"]] &lt;- c("Nugget", "Digger", "Greenfield", "Northfield")

df.pred&lt;- rbindlist( lapply(list.files(pattern="^.*Daily\\.out$"), read.apsim), fill=T)
df.pred$SimulationName&lt;- tolower(sapply(strsplit(df.pred$filename, " "), function (x) {return(x[1])}))
df.pred$TOS &lt;- toupper(df.pred$TOS)
df.pred$site &lt;- sapply(df.pred$site, capitalise)
df.pred$cultivar &lt;- sapply(df.pred$cultivar, capitalise)
df.pred$Date &lt;- as.Date(df.pred$Date, format="%d/%m/%Y")
colnames(df.pred)[which(names(df.pred) == "esw_0_600")] &lt;-"esw(0-600)"
colnames(df.pred)[which(names(df.pred) == "esw_100_600")] &lt;-"esw(100-600)"

df.pred$cvgroup &lt;- ifelse(df.pred$cultivar %in% groups[["early"]], "Early",
                            ifelse(df.pred$cultivar %in% groups[["mid"]], "Mid",
                                   ifelse(df.pred$cultivar %in% groups[["late"]], "Late", NA)))


df.obs&lt;-  read.csv("Lentil auto observed daily.csv")
df.obs$SimulationName&lt;- tolower(df.obs$SimulationName)
df.obs$cultivar &lt;- sapply(df.obs$cultivar, capitalise)
df.obs$site &lt;- sapply(df.obs$site, capitalise)
df.obs$Date &lt;- as.Date(df.obs$Date, format="%d/%m/%Y")
df.obs$cvgroup &lt;- ifelse(df.obs$cultivar %in% groups[["early"]], "Early",
                          ifelse(df.obs$cultivar %in% groups[["mid"]], "Mid",
                                 ifelse(df.obs$cultivar %in% groups[["late"]], "Late", NA)))


colnames(df.obs)[which(names(df.obs) == "sw.1.")] &lt;-"sw(1)"
colnames(df.obs)[which(names(df.obs) == "sw.2.")] &lt;-"sw(2)"
colnames(df.obs)[which(names(df.obs) == "sw.3.")] &lt;-"sw(3)"
colnames(df.obs)[which(names(df.obs) == "sw.4.")] &lt;-"sw(4)"
colnames(df.obs)[which(names(df.obs) == "sw.5.")] &lt;-"sw(5)"
colnames(df.obs)[which(names(df.obs) == "sw.6.")] &lt;-"sw(6)"
colnames(df.obs)[which(names(df.obs) == "sw.7.")] &lt;-"sw(7)"

colnames(df.obs)[which(names(df.obs) == "esw.1.")] &lt;-"esw(1)"
colnames(df.obs)[which(names(df.obs) == "esw.2.")] &lt;-"esw(2)"
colnames(df.obs)[which(names(df.obs) == "esw.3.")] &lt;-"esw(3)"
colnames(df.obs)[which(names(df.obs) == "esw.4.")] &lt;-"esw(4)"
colnames(df.obs)[which(names(df.obs) == "esw.5.")] &lt;-"esw(5)"
colnames(df.obs)[which(names(df.obs) == "esw.6.")] &lt;-"esw(6)"
colnames(df.obs)[which(names(df.obs) == "esw.7.")] &lt;-"esw(7)"

colnames(df.obs)[which(names(df.obs) == "esw_0_600")] &lt;-"esw(0-600)"
colnames(df.obs)[which(names(df.obs) == "esw_100_600")] &lt;-"esw(100-600)"


#table(df.obs$`sw(2)` &gt; 0 , df.obs$site)

# merge together 
df &lt;- df.pred %&gt;% 
  left_join(select(df.obs, -one_of( c("site", "TOS", "cultivar", "cvgroup", "Date"))), 
     by=c("SimulationName", "DaysAfterSowing"), 
     suffix = c(".pred", ".obs")) 

swSites&lt;-unique(df$site[!is.na(df$`esw(100-600).obs`)])

jpeg(imageFileName, width=width, height=height)

# Not all sites have sw(1)
df2 &lt;- df[!is.na(df$`sw(1).obs`),]
g&lt;-ggplot() + 
  geom_point(data=df2, aes(x=DaysAfterSowing, color=SimulationName, y=`sw(1).obs`))  + 
  geom_line(data=df.pred[df.pred$site %in% swSites,], aes(x=DaysAfterSowing, group=SimulationName, color=SimulationName, y=`sw(1)`)) + 
  labs(y="sw(1)", x="Days after sowing") +
  facet_wrap(~site)  + theme_minimal() + theme(legend.position = "none")

print(g)
dev.off()
</text>
      </script>
    </RGraphics>
    <RGraphics name="sw(2)">
      <script>
        <text>library(dplyr)
library(ggplot2)
library(gridExtra)
library(grid)
library(data.table)

options(stringsAsFactors = F)

# Generic function to read apsim output files. Adds factor levels if found.
read.apsim &lt;- function(apsim.name) {
  header&lt;-readLines(apsim.name, n=25)
  if (length(header) == 0 ) {return(NULL)}
  i&lt;-3  # 4th line
  apsim &lt;- read.table(apsim.name,skip=i+1,na.strings=c("NA","?"))
  names(apsim) &lt;- unlist(strsplit(trimws(header[i]), " +"))
  
  #cat(apsim.name, " = ", ncol(apsim), "\n")
  return(cbind(filename=apsim.name, apsim))
}

capitalise &lt;- function(x) {
  s &lt;- strsplit(x, " ")[[1]]
  paste(toupper(substring(s, 1,1)), tolower(substring(s, 2)),
        sep="", collapse=" ")
}

groups&lt;- list()
groups[["early"]] &lt;- c("HallmarkXT", "Bolt")
groups[["mid"]] &lt;- c("Blitz", "Jumbo2", "Ace")
groups[["late"]] &lt;- c("Nugget", "Digger", "Greenfield", "Northfield")

df.pred&lt;- rbindlist( lapply(list.files(pattern="^.*Daily\\.out$"), read.apsim), fill=T)
df.pred$SimulationName&lt;- tolower(sapply(strsplit(df.pred$filename, " "), function (x) {return(x[1])}))
df.pred$TOS &lt;- toupper(df.pred$TOS)
df.pred$site &lt;- sapply(df.pred$site, capitalise)
df.pred$cultivar &lt;- sapply(df.pred$cultivar, capitalise)
df.pred$Date &lt;- as.Date(df.pred$Date, format="%d/%m/%Y")
colnames(df.pred)[which(names(df.pred) == "esw_0_600")] &lt;-"esw(0-600)"
colnames(df.pred)[which(names(df.pred) == "esw_100_600")] &lt;-"esw(100-600)"

df.pred$cvgroup &lt;- ifelse(df.pred$cultivar %in% groups[["early"]], "Early",
                            ifelse(df.pred$cultivar %in% groups[["mid"]], "Mid",
                                   ifelse(df.pred$cultivar %in% groups[["late"]], "Late", NA)))


df.obs&lt;-  read.csv("Lentil auto observed daily.csv")
df.obs$SimulationName&lt;- tolower(df.obs$SimulationName)
df.obs$cultivar &lt;- sapply(df.obs$cultivar, capitalise)
df.obs$site &lt;- sapply(df.obs$site, capitalise)
df.obs$Date &lt;- as.Date(df.obs$Date, format="%d/%m/%Y")
df.obs$cvgroup &lt;- ifelse(df.obs$cultivar %in% groups[["early"]], "Early",
                          ifelse(df.obs$cultivar %in% groups[["mid"]], "Mid",
                                 ifelse(df.obs$cultivar %in% groups[["late"]], "Late", NA)))


colnames(df.obs)[which(names(df.obs) == "sw.1.")] &lt;-"sw(1)"
colnames(df.obs)[which(names(df.obs) == "sw.2.")] &lt;-"sw(2)"
colnames(df.obs)[which(names(df.obs) == "sw.3.")] &lt;-"sw(3)"
colnames(df.obs)[which(names(df.obs) == "sw.4.")] &lt;-"sw(4)"
colnames(df.obs)[which(names(df.obs) == "sw.5.")] &lt;-"sw(5)"
colnames(df.obs)[which(names(df.obs) == "sw.6.")] &lt;-"sw(6)"
colnames(df.obs)[which(names(df.obs) == "sw.7.")] &lt;-"sw(7)"

colnames(df.obs)[which(names(df.obs) == "esw.1.")] &lt;-"esw(1)"
colnames(df.obs)[which(names(df.obs) == "esw.2.")] &lt;-"esw(2)"
colnames(df.obs)[which(names(df.obs) == "esw.3.")] &lt;-"esw(3)"
colnames(df.obs)[which(names(df.obs) == "esw.4.")] &lt;-"esw(4)"
colnames(df.obs)[which(names(df.obs) == "esw.5.")] &lt;-"esw(5)"
colnames(df.obs)[which(names(df.obs) == "esw.6.")] &lt;-"esw(6)"
colnames(df.obs)[which(names(df.obs) == "esw.7.")] &lt;-"esw(7)"

colnames(df.obs)[which(names(df.obs) == "esw_0_600")] &lt;-"esw(0-600)"
colnames(df.obs)[which(names(df.obs) == "esw_100_600")] &lt;-"esw(100-600)"


#table(df.obs$`sw(2)` &gt; 0 , df.obs$site)

# merge together 
df &lt;- df.pred %&gt;% 
  left_join(select(df.obs, -one_of( c("site", "TOS", "cultivar", "cvgroup", "Date"))), 
     by=c("SimulationName", "DaysAfterSowing"), 
     suffix = c(".pred", ".obs")) 

swSites&lt;-unique(df$site[!is.na(df$`esw(100-600).obs`)])

# Not all sites have sw(1)
df2 &lt;- df[!is.na(df$`sw(2).obs`),]

jpeg(imageFileName, width=width, height=height)
ggplot() + 
  geom_point(data=df2, aes(x=DaysAfterSowing, 
             color=SimulationName, y=`sw(2).obs`))  + 
  geom_line(data=df.pred[df.pred$site %in% swSites,], 
             aes(x=DaysAfterSowing, group=SimulationName, color=SimulationName, y=`sw(2)`)) + 
  labs(y="sw(2)", x="Days after sowing") +
  facet_wrap(~site)  + theme_minimal() + theme(legend.position = "none")

print(g)
dev.off()
</text>
      </script>
    </RGraphics>
    <RGraphics name="sw(3)">
      <script>
        <text>library(dplyr)
library(ggplot2)
library(gridExtra)
library(grid)
library(data.table)

options(stringsAsFactors = F)

# Generic function to read apsim output files. Adds factor levels if found.
read.apsim &lt;- function(apsim.name) {
  header&lt;-readLines(apsim.name, n=25)
  if (length(header) == 0 ) {return(NULL)}
  i&lt;-3  # 4th line
  apsim &lt;- read.table(apsim.name,skip=i+1,na.strings=c("NA","?"))
  names(apsim) &lt;- unlist(strsplit(trimws(header[i]), " +"))
  
  #cat(apsim.name, " = ", ncol(apsim), "\n")
  return(cbind(filename=apsim.name, apsim))
}

capitalise &lt;- function(x) {
  s &lt;- strsplit(x, " ")[[1]]
  paste(toupper(substring(s, 1,1)), tolower(substring(s, 2)),
        sep="", collapse=" ")
}

groups&lt;- list()
groups[["early"]] &lt;- c("HallmarkXT", "Bolt")
groups[["mid"]] &lt;- c("Blitz", "Jumbo2", "Ace")
groups[["late"]] &lt;- c("Nugget", "Digger", "Greenfield", "Northfield")

df.pred&lt;- rbindlist( lapply(list.files(pattern="^.*Daily\\.out$"), read.apsim), fill=T)
df.pred$SimulationName&lt;- tolower(sapply(strsplit(df.pred$filename, " "), function (x) {return(x[1])}))
df.pred$TOS &lt;- toupper(df.pred$TOS)
df.pred$site &lt;- sapply(df.pred$site, capitalise)
df.pred$cultivar &lt;- sapply(df.pred$cultivar, capitalise)
df.pred$Date &lt;- as.Date(df.pred$Date, format="%d/%m/%Y")
colnames(df.pred)[which(names(df.pred) == "esw_0_600")] &lt;-"esw(0-600)"
colnames(df.pred)[which(names(df.pred) == "esw_100_600")] &lt;-"esw(100-600)"

df.pred$cvgroup &lt;- ifelse(df.pred$cultivar %in% groups[["early"]], "Early",
                            ifelse(df.pred$cultivar %in% groups[["mid"]], "Mid",
                                   ifelse(df.pred$cultivar %in% groups[["late"]], "Late", NA)))


df.obs&lt;-  read.csv("Lentil auto observed daily.csv")
df.obs$SimulationName&lt;- tolower(df.obs$SimulationName)
df.obs$cultivar &lt;- sapply(df.obs$cultivar, capitalise)
df.obs$site &lt;- sapply(df.obs$site, capitalise)
df.obs$Date &lt;- as.Date(df.obs$Date, format="%d/%m/%Y")
df.obs$cvgroup &lt;- ifelse(df.obs$cultivar %in% groups[["early"]], "Early",
                          ifelse(df.obs$cultivar %in% groups[["mid"]], "Mid",
                                 ifelse(df.obs$cultivar %in% groups[["late"]], "Late", NA)))


colnames(df.obs)[which(names(df.obs) == "sw.1.")] &lt;-"sw(1)"
colnames(df.obs)[which(names(df.obs) == "sw.2.")] &lt;-"sw(2)"
colnames(df.obs)[which(names(df.obs) == "sw.3.")] &lt;-"sw(3)"
colnames(df.obs)[which(names(df.obs) == "sw.4.")] &lt;-"sw(4)"
colnames(df.obs)[which(names(df.obs) == "sw.5.")] &lt;-"sw(5)"
colnames(df.obs)[which(names(df.obs) == "sw.6.")] &lt;-"sw(6)"
colnames(df.obs)[which(names(df.obs) == "sw.7.")] &lt;-"sw(7)"

colnames(df.obs)[which(names(df.obs) == "esw.1.")] &lt;-"esw(1)"
colnames(df.obs)[which(names(df.obs) == "esw.2.")] &lt;-"esw(2)"
colnames(df.obs)[which(names(df.obs) == "esw.3.")] &lt;-"esw(3)"
colnames(df.obs)[which(names(df.obs) == "esw.4.")] &lt;-"esw(4)"
colnames(df.obs)[which(names(df.obs) == "esw.5.")] &lt;-"esw(5)"
colnames(df.obs)[which(names(df.obs) == "esw.6.")] &lt;-"esw(6)"
colnames(df.obs)[which(names(df.obs) == "esw.7.")] &lt;-"esw(7)"

colnames(df.obs)[which(names(df.obs) == "esw_0_600")] &lt;-"esw(0-600)"
colnames(df.obs)[which(names(df.obs) == "esw_100_600")] &lt;-"esw(100-600)"

# merge together 
df &lt;- df.pred %&gt;% 
  left_join(select(df.obs, -one_of( c("site", "TOS", "cultivar", "cvgroup", "Date"))), 
     by=c("SimulationName", "DaysAfterSowing"), 
     suffix = c(".pred", ".obs")) 

swSites&lt;-unique(df$site[!is.na(df$`esw(100-600).obs`)])

# Not all sites have sw(1)
df2 &lt;- df[!is.na(df$`sw(3).obs`),]
jpeg(imageFileName, width=width, height=height)
ggplot() + 
  geom_point(data=df2, aes(x=DaysAfterSowing, color=SimulationName, y=`sw(3).obs`))  + 
  geom_line(data=df.pred[df.pred$site %in% swSites,], aes(x=DaysAfterSowing, group=SimulationName, color=SimulationName, y=`sw(3)`)) + 
  labs(y="sw(3)", x="Days after sowing") +
  facet_wrap(~site)  + theme_minimal() + theme(legend.position = "none")

print(g)
dev.off()

</text>
      </script>
    </RGraphics>
    <RGraphics name="TS Biomass">
      <script>
        <text>library(dplyr)
library(ggplot2)
library(gridExtra)
library(grid)
library(data.table)

options(stringsAsFactors = F)

# Generic function to read apsim output files. Adds factor levels if found.
read.apsim &lt;- function(apsim.name) {
  header&lt;-readLines(apsim.name, n=25)
  if (length(header) == 0 ) {return(NULL)}
  i&lt;-3  # 4th line
  apsim &lt;- read.table(apsim.name,skip=i+1,na.strings=c("NA","?"))
  names(apsim) &lt;- unlist(strsplit(trimws(header[i]), " +"))
  
  #cat(apsim.name, " = ", ncol(apsim), "\n")
  return(cbind(filename=apsim.name, apsim))
}

capitalise &lt;- function(x) {
  s &lt;- strsplit(x, " ")[[1]]
  paste(toupper(substring(s, 1,1)), tolower(substring(s, 2)),
        sep="", collapse=" ")
}

groups&lt;- list()
groups[["early"]] &lt;- c("HallmarkXT", "Bolt")
groups[["mid"]] &lt;- c("Blitz", "Jumbo2", "Ace")
groups[["late"]] &lt;- c("Nugget", "Digger", "Greenfield", "Northfield")

df.pred&lt;- rbindlist( lapply(list.files(pattern="^.*Daily\\.out$"), read.apsim), fill=T)
df.pred$SimulationName&lt;- tolower(sapply(strsplit(df.pred$filename, " "), function (x) {return(x[1])}))
df.pred$TOS &lt;- toupper(df.pred$TOS)
df.pred$site &lt;- sapply(df.pred$site, capitalise)
df.pred$cultivar &lt;- sapply(df.pred$cultivar, capitalise)
df.pred$Date &lt;- as.Date(df.pred$Date, format="%d/%m/%Y")
colnames(df.pred)[which(names(df.pred) == "esw_0_600")] &lt;-"esw(0-600)"
colnames(df.pred)[which(names(df.pred) == "esw_100_600")] &lt;-"esw(100-600)"

df.pred$cvgroup &lt;- ifelse(df.pred$cultivar %in% groups[["early"]], "Early",
                            ifelse(df.pred$cultivar %in% groups[["mid"]], "Mid",
                                   ifelse(df.pred$cultivar %in% groups[["late"]], "Late", NA)))


df.obs&lt;-  read.csv("Lentil auto observed daily.csv")
df.obs$SimulationName&lt;- tolower(df.obs$SimulationName)
df.obs$cultivar &lt;- sapply(df.obs$cultivar, capitalise)
df.obs$site &lt;- sapply(df.obs$site, capitalise)
df.obs$Date &lt;- as.Date(df.obs$Date, format="%d/%m/%Y")
df.obs$cvgroup &lt;- ifelse(df.obs$cultivar %in% groups[["early"]], "Early",
                          ifelse(df.obs$cultivar %in% groups[["mid"]], "Mid",
                                 ifelse(df.obs$cultivar %in% groups[["late"]], "Late", NA)))


colnames(df.obs)[which(names(df.obs) == "sw.1.")] &lt;-"sw(1)"
colnames(df.obs)[which(names(df.obs) == "sw.2.")] &lt;-"sw(2)"
colnames(df.obs)[which(names(df.obs) == "sw.3.")] &lt;-"sw(3)"
colnames(df.obs)[which(names(df.obs) == "sw.4.")] &lt;-"sw(4)"
colnames(df.obs)[which(names(df.obs) == "sw.5.")] &lt;-"sw(5)"
colnames(df.obs)[which(names(df.obs) == "sw.6.")] &lt;-"sw(6)"
colnames(df.obs)[which(names(df.obs) == "sw.7.")] &lt;-"sw(7)"

colnames(df.obs)[which(names(df.obs) == "esw.1.")] &lt;-"esw(1)"
colnames(df.obs)[which(names(df.obs) == "esw.2.")] &lt;-"esw(2)"
colnames(df.obs)[which(names(df.obs) == "esw.3.")] &lt;-"esw(3)"
colnames(df.obs)[which(names(df.obs) == "esw.4.")] &lt;-"esw(4)"
colnames(df.obs)[which(names(df.obs) == "esw.5.")] &lt;-"esw(5)"
colnames(df.obs)[which(names(df.obs) == "esw.6.")] &lt;-"esw(6)"
colnames(df.obs)[which(names(df.obs) == "esw.7.")] &lt;-"esw(7)"

colnames(df.obs)[which(names(df.obs) == "esw_0_600")] &lt;-"esw(0-600)"
colnames(df.obs)[which(names(df.obs) == "esw_100_600")] &lt;-"esw(100-600)"

# merge together 
df &lt;- df.pred %&gt;% 
  left_join(select(df.obs, -one_of( c("site", "TOS", "cultivar", "cvgroup", "Date"))), 
     by=c("SimulationName", "DaysAfterSowing"), 
     suffix = c(".pred", ".obs")) 


jpeg(imageFileName, width=width, height=height)

df2 &lt;- df[! df$site %in% c("Beulah", "Birchip", "Gatton", "Greenethorpe2", "Horsham" ),]
ggplot(df2) + 
  geom_point(aes(x=DaysAfterSowing, color=cvgroup, y=AboveGround.Wt.obs), na.rm=T)  + 
  geom_line(aes(x=DaysAfterSowing, group=SimulationName, color=cvgroup, y=AboveGround.Wt.pred))  +
  labs(y="Biomass Wt (g/m2)") +
  facet_wrap(~site)  + theme_minimal() + theme(legend.position = "none")

print(g)
dev.off()

</text>
      </script>
    </RGraphics>
    <RGraphics name="TS Yield">
      <script>
        <text>library(dplyr)
library(ggplot2)
library(gridExtra)
library(grid)
library(data.table)

options(stringsAsFactors = F)

# Generic function to read apsim output files. Adds factor levels if found.
read.apsim &lt;- function(apsim.name) {
  header&lt;-readLines(apsim.name, n=25)
  if (length(header) == 0 ) {return(NULL)}
  i&lt;-3  # 4th line
  apsim &lt;- read.table(apsim.name,skip=i+1,na.strings=c("NA","?"))
  names(apsim) &lt;- unlist(strsplit(trimws(header[i]), " +"))
  
  #cat(apsim.name, " = ", ncol(apsim), "\n")
  return(cbind(filename=apsim.name, apsim))
}

capitalise &lt;- function(x) {
  s &lt;- strsplit(x, " ")[[1]]
  paste(toupper(substring(s, 1,1)), tolower(substring(s, 2)),
        sep="", collapse=" ")
}

groups&lt;- list()
groups[["early"]] &lt;- c("HallmarkXT", "Bolt")
groups[["mid"]] &lt;- c("Blitz", "Jumbo2", "Ace")
groups[["late"]] &lt;- c("Nugget", "Digger", "Greenfield", "Northfield")

df.pred&lt;- rbindlist( lapply(list.files(pattern="^.*Daily\\.out$"), read.apsim), fill=T)
df.pred$SimulationName&lt;- tolower(sapply(strsplit(df.pred$filename, " "), function (x) {return(x[1])}))
df.pred$TOS &lt;- toupper(df.pred$TOS)
df.pred$site &lt;- sapply(df.pred$site, capitalise)
df.pred$cultivar &lt;- sapply(df.pred$cultivar, capitalise)
df.pred$Date &lt;- as.Date(df.pred$Date, format="%d/%m/%Y")
colnames(df.pred)[which(names(df.pred) == "esw_0_600")] &lt;-"esw(0-600)"
colnames(df.pred)[which(names(df.pred) == "esw_100_600")] &lt;-"esw(100-600)"

df.pred$cvgroup &lt;- ifelse(df.pred$cultivar %in% groups[["early"]], "Early",
                            ifelse(df.pred$cultivar %in% groups[["mid"]], "Mid",
                                   ifelse(df.pred$cultivar %in% groups[["late"]], "Late", NA)))


df.obs&lt;-  read.csv("Lentil auto observed daily.csv")
df.obs$SimulationName&lt;- tolower(df.obs$SimulationName)
df.obs$cultivar &lt;- sapply(df.obs$cultivar, capitalise)
df.obs$site &lt;- sapply(df.obs$site, capitalise)
df.obs$Date &lt;- as.Date(df.obs$Date, format="%d/%m/%Y")
df.obs$cvgroup &lt;- ifelse(df.obs$cultivar %in% groups[["early"]], "Early",
                          ifelse(df.obs$cultivar %in% groups[["mid"]], "Mid",
                                 ifelse(df.obs$cultivar %in% groups[["late"]], "Late", NA)))


colnames(df.obs)[which(names(df.obs) == "sw.1.")] &lt;-"sw(1)"
colnames(df.obs)[which(names(df.obs) == "sw.2.")] &lt;-"sw(2)"
colnames(df.obs)[which(names(df.obs) == "sw.3.")] &lt;-"sw(3)"
colnames(df.obs)[which(names(df.obs) == "sw.4.")] &lt;-"sw(4)"
colnames(df.obs)[which(names(df.obs) == "sw.5.")] &lt;-"sw(5)"
colnames(df.obs)[which(names(df.obs) == "sw.6.")] &lt;-"sw(6)"
colnames(df.obs)[which(names(df.obs) == "sw.7.")] &lt;-"sw(7)"

colnames(df.obs)[which(names(df.obs) == "esw.1.")] &lt;-"esw(1)"
colnames(df.obs)[which(names(df.obs) == "esw.2.")] &lt;-"esw(2)"
colnames(df.obs)[which(names(df.obs) == "esw.3.")] &lt;-"esw(3)"
colnames(df.obs)[which(names(df.obs) == "esw.4.")] &lt;-"esw(4)"
colnames(df.obs)[which(names(df.obs) == "esw.5.")] &lt;-"esw(5)"
colnames(df.obs)[which(names(df.obs) == "esw.6.")] &lt;-"esw(6)"
colnames(df.obs)[which(names(df.obs) == "esw.7.")] &lt;-"esw(7)"

colnames(df.obs)[which(names(df.obs) == "esw_0_600")] &lt;-"esw(0-600)"
colnames(df.obs)[which(names(df.obs) == "esw_100_600")] &lt;-"esw(100-600)"

# merge together 
df &lt;- df.pred %&gt;% 
  left_join(select(df.obs, -one_of( c("site", "TOS", "cultivar", "cvgroup", "Date"))), 
     by=c("SimulationName", "DaysAfterSowing"), 
     suffix = c(".pred", ".obs")) 


jpeg(imageFileName, width=width, height=height)
df2 &lt;- df[! df$site %in% c("Beulah", "Birchip","Caragabal", "Emerald",  "Gatton", "Greenethorpe2", "Horsham", "Mildura", "Millmerran" ),]
ggplot(df2) + 
  geom_point(aes(x=DaysAfterSowing, color=cvgroup, y=GrainWt.obs))  + 
  geom_line(aes(x=DaysAfterSowing, group=SimulationName, color=cvgroup, y=GrainWt.pred))  +
  labs(y="Grain Wt") +
  facet_wrap(~site)  + theme_minimal() + theme(legend.position = "none")


print(g)
dev.off()

</text>
      </script>
    </RGraphics>
  </folder>
  <simulation name="Gatton.irrigated.TOS1.Genesis">
    <metfile name="met">
      <filename>Gatton.met</filename>
    </metfile>
    <clock>
      <start_date>21/05/2019</start_date>
      <end_date>16/02/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea/>
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>22/05/2019</sow_date>
            <reset_date>21/05/2019</reset_date>
            <cultivar>Genesis</cultivar>
            <density>25</density>
            <soil>Black Vertosol (Lawes No037) </soil>
            <Irrigation_level>irrigated</Irrigation_level>
            <site>Gatton</site>
            <tos>TOS1</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif


if (today = Date('22-may')) then
irrigation apply amount = 40
endif

if (today = Date('11-jun')) then
irrigation apply amount = 15
endif

if (today = Date('26-jun')) then
irrigation apply amount = 15
endif

if (today = Date('23-jul')) then
irrigation apply amount = 30
endif

if (today = Date('6-aug')) then
irrigation apply amount = 40
endif

if (today = Date('15-aug')) then
irrigation apply amount = 30
endif

if (today = Date('4-sep')) then
irrigation apply amount = 30
endif
</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Black Vertosol (Lawes No037) ">
        <RecordNumber>148</RecordNumber>
        <ASCOrder>Vertosol</ASCOrder>
        <ASCSubOrder>Black</ASCSubOrder>
        <SoilType>Clay</SoilType>
        <LocalName/>
        <Site>Lawes</Site>
        <NearestTown>Lawes, Q 4343</NearestTown>
        <Region>Southeast Coast</Region>
        <State>Queensland</State>
        <Country>Australia</Country>
        <NaturalVegetation>Blue Gum, Moreton Bay Ash, Tea Tree</NaturalVegetation>
        <ApsoilNumber>37</ApsoilNumber>
        <Latitude>-27.537</Latitude>
        <Longitude>152.336</Longitude>
        <LocationAccuracy>+/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>CSIRO Sustainable Ecosystems, Toowoomba</DataSource>
        <Comments>OC and ph estimated</Comments>
        <Water>
          <BDMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </BDMetadata>
          <AirDryMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </AirDryMetadata>
          <LL15Metadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </LL15Metadata>
          <DULMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </DULMetadata>
          <SATMetadata>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
          </SATMetadata>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.25</double>
            <double>1.25</double>
            <double>1.23</double>
            <double>1.27</double>
            <double>1.37</double>
            <double>1.35</double>
          </BD>
          <AirDry>
            <double>0.182</double>
            <double>0.259</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </AirDry>
          <LL15>
            <double>0.192</double>
            <double>0.273</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </LL15>
          <DUL>
            <double>0.49</double>
            <double>0.48</double>
            <double>0.386</double>
            <double>0.37</double>
            <double>0.34</double>
            <double>0.332</double>
          </DUL>
          <SAT>
            <double>0.52</double>
            <double>0.52</double>
            <double>0.509</double>
            <double>0.495</double>
            <double>0.459</double>
            <double>0.466</double>
          </SAT>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.192</double>
              <double>0.273</double>
              <double>0.298</double>
              <double>0.257</double>
              <double>0.265</double>
              <double>0.272</double>
            </LL>
            <KL>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2.5</WinterCona>
          <WinterU>4</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>40</DiffusConst>
          <DiffusSlope>16</DiffusSlope>
          <Salb>0.12</Salb>
          <CN2Bare>73</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.953846153846154</double>
            <double>0.953846153846154</double>
            <double>0.961538461538461</double>
            <double>0.846153846153846</double>
            <double>0.546153846153846</double>
            <double>0.261538461538462</double>
            <double>0.2</double>
          </OC>
          <OCMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.6</double>
            <double>0.8</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <PH>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
          </PH>
          <PHMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>22</double>
            <double>15</double>
            <double>7.5</double>
            <double>9</double>
            <double>11</double>
            <double>11</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.33</double>
            <double>0.355</double>
            <double>0.34</double>
            <double>0.27</double>
            <double>0.265</double>
            <double>0.29</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Gatton.irrigated.TOS1.HatTrick">
    <metfile name="met">
      <filename>Gatton.met</filename>
    </metfile>
    <clock>
      <start_date>21/05/2019</start_date>
      <end_date>16/02/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea/>
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>22/05/2019</sow_date>
            <reset_date>21/05/2019</reset_date>
            <cultivar>HatTrick</cultivar>
            <density>25</density>
            <soil>Black Vertosol (Lawes No037) </soil>
            <Irrigation_level>irrigated</Irrigation_level>
            <site>Gatton</site>
            <tos>TOS1</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif


if (today = Date('22-may')) then
irrigation apply amount = 40
endif

if (today = Date('11-jun')) then
irrigation apply amount = 15
endif

if (today = Date('26-jun')) then
irrigation apply amount = 15
endif

if (today = Date('23-jul')) then
irrigation apply amount = 30
endif

if (today = Date('6-aug')) then
irrigation apply amount = 40
endif

if (today = Date('15-aug')) then
irrigation apply amount = 30
endif

if (today = Date('4-sep')) then
irrigation apply amount = 30
endif
</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Black Vertosol (Lawes No037) ">
        <RecordNumber>148</RecordNumber>
        <ASCOrder>Vertosol</ASCOrder>
        <ASCSubOrder>Black</ASCSubOrder>
        <SoilType>Clay</SoilType>
        <LocalName/>
        <Site>Lawes</Site>
        <NearestTown>Lawes, Q 4343</NearestTown>
        <Region>Southeast Coast</Region>
        <State>Queensland</State>
        <Country>Australia</Country>
        <NaturalVegetation>Blue Gum, Moreton Bay Ash, Tea Tree</NaturalVegetation>
        <ApsoilNumber>37</ApsoilNumber>
        <Latitude>-27.537</Latitude>
        <Longitude>152.336</Longitude>
        <LocationAccuracy>+/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>CSIRO Sustainable Ecosystems, Toowoomba</DataSource>
        <Comments>OC and ph estimated</Comments>
        <Water>
          <BDMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </BDMetadata>
          <AirDryMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </AirDryMetadata>
          <LL15Metadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </LL15Metadata>
          <DULMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </DULMetadata>
          <SATMetadata>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
          </SATMetadata>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.25</double>
            <double>1.25</double>
            <double>1.23</double>
            <double>1.27</double>
            <double>1.37</double>
            <double>1.35</double>
          </BD>
          <AirDry>
            <double>0.182</double>
            <double>0.259</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </AirDry>
          <LL15>
            <double>0.192</double>
            <double>0.273</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </LL15>
          <DUL>
            <double>0.49</double>
            <double>0.48</double>
            <double>0.386</double>
            <double>0.37</double>
            <double>0.34</double>
            <double>0.332</double>
          </DUL>
          <SAT>
            <double>0.52</double>
            <double>0.52</double>
            <double>0.509</double>
            <double>0.495</double>
            <double>0.459</double>
            <double>0.466</double>
          </SAT>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.192</double>
              <double>0.273</double>
              <double>0.298</double>
              <double>0.257</double>
              <double>0.265</double>
              <double>0.272</double>
            </LL>
            <KL>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2.5</WinterCona>
          <WinterU>4</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>40</DiffusConst>
          <DiffusSlope>16</DiffusSlope>
          <Salb>0.12</Salb>
          <CN2Bare>73</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.953846153846154</double>
            <double>0.953846153846154</double>
            <double>0.961538461538461</double>
            <double>0.846153846153846</double>
            <double>0.546153846153846</double>
            <double>0.261538461538462</double>
            <double>0.2</double>
          </OC>
          <OCMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.6</double>
            <double>0.8</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <PH>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
          </PH>
          <PHMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>22</double>
            <double>15</double>
            <double>7.5</double>
            <double>9</double>
            <double>11</double>
            <double>11</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.33</double>
            <double>0.355</double>
            <double>0.34</double>
            <double>0.27</double>
            <double>0.265</double>
            <double>0.29</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Gatton.irrigated.TOS2.Genesis">
    <metfile name="met">
      <filename>Gatton.met</filename>
    </metfile>
    <clock>
      <start_date>21/05/2019</start_date>
      <end_date>16/02/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea/>
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>10/06/2019</sow_date>
            <reset_date>21/05/2019</reset_date>
            <cultivar>Genesis</cultivar>
            <density>25</density>
            <soil>Black Vertosol (Lawes No037) </soil>
            <Irrigation_level>irrigated</Irrigation_level>
            <site>Gatton</site>
            <tos>TOS2</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif


if (today = Date('22-may')) then
irrigation apply amount = 40
endif

if (today = Date('11-jun')) then
irrigation apply amount = 15
endif

if (today = Date('26-jun')) then
irrigation apply amount = 15
endif

if (today = Date('23-jul')) then
irrigation apply amount = 30
endif

if (today = Date('6-aug')) then
irrigation apply amount = 40
endif

if (today = Date('15-aug')) then
irrigation apply amount = 30
endif

if (today = Date('4-sep')) then
irrigation apply amount = 30
endif
</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Black Vertosol (Lawes No037) ">
        <RecordNumber>148</RecordNumber>
        <ASCOrder>Vertosol</ASCOrder>
        <ASCSubOrder>Black</ASCSubOrder>
        <SoilType>Clay</SoilType>
        <LocalName/>
        <Site>Lawes</Site>
        <NearestTown>Lawes, Q 4343</NearestTown>
        <Region>Southeast Coast</Region>
        <State>Queensland</State>
        <Country>Australia</Country>
        <NaturalVegetation>Blue Gum, Moreton Bay Ash, Tea Tree</NaturalVegetation>
        <ApsoilNumber>37</ApsoilNumber>
        <Latitude>-27.537</Latitude>
        <Longitude>152.336</Longitude>
        <LocationAccuracy>+/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>CSIRO Sustainable Ecosystems, Toowoomba</DataSource>
        <Comments>OC and ph estimated</Comments>
        <Water>
          <BDMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </BDMetadata>
          <AirDryMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </AirDryMetadata>
          <LL15Metadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </LL15Metadata>
          <DULMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </DULMetadata>
          <SATMetadata>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
          </SATMetadata>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.25</double>
            <double>1.25</double>
            <double>1.23</double>
            <double>1.27</double>
            <double>1.37</double>
            <double>1.35</double>
          </BD>
          <AirDry>
            <double>0.182</double>
            <double>0.259</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </AirDry>
          <LL15>
            <double>0.192</double>
            <double>0.273</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </LL15>
          <DUL>
            <double>0.49</double>
            <double>0.48</double>
            <double>0.386</double>
            <double>0.37</double>
            <double>0.34</double>
            <double>0.332</double>
          </DUL>
          <SAT>
            <double>0.52</double>
            <double>0.52</double>
            <double>0.509</double>
            <double>0.495</double>
            <double>0.459</double>
            <double>0.466</double>
          </SAT>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.192</double>
              <double>0.273</double>
              <double>0.298</double>
              <double>0.257</double>
              <double>0.265</double>
              <double>0.272</double>
            </LL>
            <KL>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2.5</WinterCona>
          <WinterU>4</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>40</DiffusConst>
          <DiffusSlope>16</DiffusSlope>
          <Salb>0.12</Salb>
          <CN2Bare>73</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.953846153846154</double>
            <double>0.953846153846154</double>
            <double>0.961538461538461</double>
            <double>0.846153846153846</double>
            <double>0.546153846153846</double>
            <double>0.261538461538462</double>
            <double>0.2</double>
          </OC>
          <OCMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.6</double>
            <double>0.8</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <PH>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
          </PH>
          <PHMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>22</double>
            <double>15</double>
            <double>7.5</double>
            <double>9</double>
            <double>11</double>
            <double>11</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.33</double>
            <double>0.355</double>
            <double>0.34</double>
            <double>0.27</double>
            <double>0.265</double>
            <double>0.29</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Gatton.irrigated.TOS2.HatTrick">
    <metfile name="met">
      <filename>Gatton.met</filename>
    </metfile>
    <clock>
      <start_date>21/05/2019</start_date>
      <end_date>16/02/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea/>
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>10/06/2019</sow_date>
            <reset_date>21/05/2019</reset_date>
            <cultivar>HatTrick</cultivar>
            <density>25</density>
            <soil>Black Vertosol (Lawes No037) </soil>
            <Irrigation_level>irrigated</Irrigation_level>
            <site>Gatton</site>
            <tos>TOS2</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif


if (today = Date('22-may')) then
irrigation apply amount = 40
endif

if (today = Date('11-jun')) then
irrigation apply amount = 15
endif

if (today = Date('26-jun')) then
irrigation apply amount = 15
endif

if (today = Date('23-jul')) then
irrigation apply amount = 30
endif

if (today = Date('6-aug')) then
irrigation apply amount = 40
endif

if (today = Date('15-aug')) then
irrigation apply amount = 30
endif

if (today = Date('4-sep')) then
irrigation apply amount = 30
endif
</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Black Vertosol (Lawes No037) ">
        <RecordNumber>148</RecordNumber>
        <ASCOrder>Vertosol</ASCOrder>
        <ASCSubOrder>Black</ASCSubOrder>
        <SoilType>Clay</SoilType>
        <LocalName/>
        <Site>Lawes</Site>
        <NearestTown>Lawes, Q 4343</NearestTown>
        <Region>Southeast Coast</Region>
        <State>Queensland</State>
        <Country>Australia</Country>
        <NaturalVegetation>Blue Gum, Moreton Bay Ash, Tea Tree</NaturalVegetation>
        <ApsoilNumber>37</ApsoilNumber>
        <Latitude>-27.537</Latitude>
        <Longitude>152.336</Longitude>
        <LocationAccuracy>+/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>CSIRO Sustainable Ecosystems, Toowoomba</DataSource>
        <Comments>OC and ph estimated</Comments>
        <Water>
          <BDMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </BDMetadata>
          <AirDryMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </AirDryMetadata>
          <LL15Metadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </LL15Metadata>
          <DULMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </DULMetadata>
          <SATMetadata>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
          </SATMetadata>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.25</double>
            <double>1.25</double>
            <double>1.23</double>
            <double>1.27</double>
            <double>1.37</double>
            <double>1.35</double>
          </BD>
          <AirDry>
            <double>0.182</double>
            <double>0.259</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </AirDry>
          <LL15>
            <double>0.192</double>
            <double>0.273</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </LL15>
          <DUL>
            <double>0.49</double>
            <double>0.48</double>
            <double>0.386</double>
            <double>0.37</double>
            <double>0.34</double>
            <double>0.332</double>
          </DUL>
          <SAT>
            <double>0.52</double>
            <double>0.52</double>
            <double>0.509</double>
            <double>0.495</double>
            <double>0.459</double>
            <double>0.466</double>
          </SAT>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.192</double>
              <double>0.273</double>
              <double>0.298</double>
              <double>0.257</double>
              <double>0.265</double>
              <double>0.272</double>
            </LL>
            <KL>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2.5</WinterCona>
          <WinterU>4</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>40</DiffusConst>
          <DiffusSlope>16</DiffusSlope>
          <Salb>0.12</Salb>
          <CN2Bare>73</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.953846153846154</double>
            <double>0.953846153846154</double>
            <double>0.961538461538461</double>
            <double>0.846153846153846</double>
            <double>0.546153846153846</double>
            <double>0.261538461538462</double>
            <double>0.2</double>
          </OC>
          <OCMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.6</double>
            <double>0.8</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <PH>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
          </PH>
          <PHMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>22</double>
            <double>15</double>
            <double>7.5</double>
            <double>9</double>
            <double>11</double>
            <double>11</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.33</double>
            <double>0.355</double>
            <double>0.34</double>
            <double>0.27</double>
            <double>0.265</double>
            <double>0.29</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Gatton.irrigated.TOS3.Genesis">
    <metfile name="met">
      <filename>Gatton.met</filename>
    </metfile>
    <clock>
      <start_date>21/05/2019</start_date>
      <end_date>16/02/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>25/06/2019</sow_date>
            <reset_date>21/05/2019</reset_date>
            <cultivar>Genesis</cultivar>
            <density>25</density>
            <soil>Black Vertosol (Lawes No037) </soil>
            <Irrigation_level>irrigated</Irrigation_level>
            <site>Gatton</site>
            <tos>TOS3</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif


if (today = Date('22-may')) then
irrigation apply amount = 40
endif

if (today = Date('11-jun')) then
irrigation apply amount = 15
endif

if (today = Date('26-jun')) then
irrigation apply amount = 15
endif

if (today = Date('23-jul')) then
irrigation apply amount = 30
endif

if (today = Date('6-aug')) then
irrigation apply amount = 40
endif

if (today = Date('15-aug')) then
irrigation apply amount = 30
endif

if (today = Date('4-sep')) then
irrigation apply amount = 30
endif
</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Black Vertosol (Lawes No037) ">
        <RecordNumber>148</RecordNumber>
        <ASCOrder>Vertosol</ASCOrder>
        <ASCSubOrder>Black</ASCSubOrder>
        <SoilType>Clay</SoilType>
        <LocalName/>
        <Site>Lawes</Site>
        <NearestTown>Lawes, Q 4343</NearestTown>
        <Region>Southeast Coast</Region>
        <State>Queensland</State>
        <Country>Australia</Country>
        <NaturalVegetation>Blue Gum, Moreton Bay Ash, Tea Tree</NaturalVegetation>
        <ApsoilNumber>37</ApsoilNumber>
        <Latitude>-27.537</Latitude>
        <Longitude>152.336</Longitude>
        <LocationAccuracy>+/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>CSIRO Sustainable Ecosystems, Toowoomba</DataSource>
        <Comments>OC and ph estimated</Comments>
        <Water>
          <BDMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </BDMetadata>
          <AirDryMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </AirDryMetadata>
          <LL15Metadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </LL15Metadata>
          <DULMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </DULMetadata>
          <SATMetadata>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
          </SATMetadata>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.25</double>
            <double>1.25</double>
            <double>1.23</double>
            <double>1.27</double>
            <double>1.37</double>
            <double>1.35</double>
          </BD>
          <AirDry>
            <double>0.182</double>
            <double>0.259</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </AirDry>
          <LL15>
            <double>0.192</double>
            <double>0.273</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </LL15>
          <DUL>
            <double>0.49</double>
            <double>0.48</double>
            <double>0.386</double>
            <double>0.37</double>
            <double>0.34</double>
            <double>0.332</double>
          </DUL>
          <SAT>
            <double>0.52</double>
            <double>0.52</double>
            <double>0.509</double>
            <double>0.495</double>
            <double>0.459</double>
            <double>0.466</double>
          </SAT>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.192</double>
              <double>0.273</double>
              <double>0.298</double>
              <double>0.257</double>
              <double>0.265</double>
              <double>0.272</double>
            </LL>
            <KL>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2.5</WinterCona>
          <WinterU>4</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>40</DiffusConst>
          <DiffusSlope>16</DiffusSlope>
          <Salb>0.12</Salb>
          <CN2Bare>73</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.953846153846154</double>
            <double>0.953846153846154</double>
            <double>0.961538461538461</double>
            <double>0.846153846153846</double>
            <double>0.546153846153846</double>
            <double>0.261538461538462</double>
            <double>0.2</double>
          </OC>
          <OCMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.6</double>
            <double>0.8</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <PH>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
          </PH>
          <PHMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>22</double>
            <double>15</double>
            <double>7.5</double>
            <double>9</double>
            <double>11</double>
            <double>11</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.33</double>
            <double>0.355</double>
            <double>0.34</double>
            <double>0.27</double>
            <double>0.265</double>
            <double>0.29</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Gatton.irrigated.TOS3.HatTrick">
    <metfile name="met">
      <filename>Gatton.met</filename>
    </metfile>
    <clock>
      <start_date>21/05/2019</start_date>
      <end_date>16/02/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>25/06/2019</sow_date>
            <reset_date>21/05/2019</reset_date>
            <cultivar>HatTrick</cultivar>
            <density>25</density>
            <soil>Black Vertosol (Lawes No037) </soil>
            <Irrigation_level>irrigated</Irrigation_level>
            <site>Gatton</site>
            <tos>TOS3</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif


if (today = Date('22-may')) then
irrigation apply amount = 40
endif

if (today = Date('11-jun')) then
irrigation apply amount = 15
endif

if (today = Date('26-jun')) then
irrigation apply amount = 15
endif

if (today = Date('23-jul')) then
irrigation apply amount = 30
endif

if (today = Date('6-aug')) then
irrigation apply amount = 40
endif

if (today = Date('15-aug')) then
irrigation apply amount = 30
endif

if (today = Date('4-sep')) then
irrigation apply amount = 30
endif
</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Black Vertosol (Lawes No037) ">
        <RecordNumber>148</RecordNumber>
        <ASCOrder>Vertosol</ASCOrder>
        <ASCSubOrder>Black</ASCSubOrder>
        <SoilType>Clay</SoilType>
        <LocalName/>
        <Site>Lawes</Site>
        <NearestTown>Lawes, Q 4343</NearestTown>
        <Region>Southeast Coast</Region>
        <State>Queensland</State>
        <Country>Australia</Country>
        <NaturalVegetation>Blue Gum, Moreton Bay Ash, Tea Tree</NaturalVegetation>
        <ApsoilNumber>37</ApsoilNumber>
        <Latitude>-27.537</Latitude>
        <Longitude>152.336</Longitude>
        <LocationAccuracy>+/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>CSIRO Sustainable Ecosystems, Toowoomba</DataSource>
        <Comments>OC and ph estimated</Comments>
        <Water>
          <BDMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </BDMetadata>
          <AirDryMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </AirDryMetadata>
          <LL15Metadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </LL15Metadata>
          <DULMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </DULMetadata>
          <SATMetadata>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
          </SATMetadata>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.25</double>
            <double>1.25</double>
            <double>1.23</double>
            <double>1.27</double>
            <double>1.37</double>
            <double>1.35</double>
          </BD>
          <AirDry>
            <double>0.182</double>
            <double>0.259</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </AirDry>
          <LL15>
            <double>0.192</double>
            <double>0.273</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </LL15>
          <DUL>
            <double>0.49</double>
            <double>0.48</double>
            <double>0.386</double>
            <double>0.37</double>
            <double>0.34</double>
            <double>0.332</double>
          </DUL>
          <SAT>
            <double>0.52</double>
            <double>0.52</double>
            <double>0.509</double>
            <double>0.495</double>
            <double>0.459</double>
            <double>0.466</double>
          </SAT>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.192</double>
              <double>0.273</double>
              <double>0.298</double>
              <double>0.257</double>
              <double>0.265</double>
              <double>0.272</double>
            </LL>
            <KL>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2.5</WinterCona>
          <WinterU>4</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>40</DiffusConst>
          <DiffusSlope>16</DiffusSlope>
          <Salb>0.12</Salb>
          <CN2Bare>73</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.953846153846154</double>
            <double>0.953846153846154</double>
            <double>0.961538461538461</double>
            <double>0.846153846153846</double>
            <double>0.546153846153846</double>
            <double>0.261538461538462</double>
            <double>0.2</double>
          </OC>
          <OCMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.6</double>
            <double>0.8</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <PH>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
          </PH>
          <PHMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>22</double>
            <double>15</double>
            <double>7.5</double>
            <double>9</double>
            <double>11</double>
            <double>11</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.33</double>
            <double>0.355</double>
            <double>0.34</double>
            <double>0.27</double>
            <double>0.265</double>
            <double>0.29</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Gatton.rainfed.TOS1.Genesis">
    <metfile name="met">
      <filename>Gatton.met</filename>
    </metfile>
    <clock>
      <start_date>21/05/2019</start_date>
      <end_date>16/02/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>22/05/2019</sow_date>
            <reset_date>21/05/2019</reset_date>
            <cultivar>Genesis</cultivar>
            <density>25</density>
            <soil>Black Vertosol (Lawes No037) </soil>
            <Irrigation_level>rainfed</Irrigation_level>
            <site>Gatton</site>
            <tos>TOS1</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif


if (today = Date('22-may')) then
irrigation apply amount = 40
endif

if (today = Date('11-jun')) then
irrigation apply amount = 15
endif

if (today = Date('26-jun')) then
irrigation apply amount = 15
endif

if (today = Date('15-aug')) then
irrigation apply amount = 15
endif
</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Black Vertosol (Lawes No037) ">
        <RecordNumber>148</RecordNumber>
        <ASCOrder>Vertosol</ASCOrder>
        <ASCSubOrder>Black</ASCSubOrder>
        <SoilType>Clay</SoilType>
        <LocalName/>
        <Site>Lawes</Site>
        <NearestTown>Lawes, Q 4343</NearestTown>
        <Region>Southeast Coast</Region>
        <State>Queensland</State>
        <Country>Australia</Country>
        <NaturalVegetation>Blue Gum, Moreton Bay Ash, Tea Tree</NaturalVegetation>
        <ApsoilNumber>37</ApsoilNumber>
        <Latitude>-27.537</Latitude>
        <Longitude>152.336</Longitude>
        <LocationAccuracy>+/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>CSIRO Sustainable Ecosystems, Toowoomba</DataSource>
        <Comments>OC and ph estimated</Comments>
        <Water>
          <BDMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </BDMetadata>
          <AirDryMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </AirDryMetadata>
          <LL15Metadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </LL15Metadata>
          <DULMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </DULMetadata>
          <SATMetadata>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
          </SATMetadata>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.25</double>
            <double>1.25</double>
            <double>1.23</double>
            <double>1.27</double>
            <double>1.37</double>
            <double>1.35</double>
          </BD>
          <AirDry>
            <double>0.182</double>
            <double>0.259</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </AirDry>
          <LL15>
            <double>0.192</double>
            <double>0.273</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </LL15>
          <DUL>
            <double>0.49</double>
            <double>0.48</double>
            <double>0.386</double>
            <double>0.37</double>
            <double>0.34</double>
            <double>0.332</double>
          </DUL>
          <SAT>
            <double>0.52</double>
            <double>0.52</double>
            <double>0.509</double>
            <double>0.495</double>
            <double>0.459</double>
            <double>0.466</double>
          </SAT>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.192</double>
              <double>0.273</double>
              <double>0.298</double>
              <double>0.257</double>
              <double>0.265</double>
              <double>0.272</double>
            </LL>
            <KL>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2.5</WinterCona>
          <WinterU>4</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>40</DiffusConst>
          <DiffusSlope>16</DiffusSlope>
          <Salb>0.12</Salb>
          <CN2Bare>73</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.953846153846154</double>
            <double>0.953846153846154</double>
            <double>0.961538461538461</double>
            <double>0.846153846153846</double>
            <double>0.546153846153846</double>
            <double>0.261538461538462</double>
            <double>0.2</double>
          </OC>
          <OCMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.6</double>
            <double>0.8</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <PH>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
          </PH>
          <PHMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>57</double>
            <double>35</double>
            <double>14</double>
            <double>17</double>
            <double>23</double>
            <double>27</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.33</double>
            <double>0.355</double>
            <double>0.35</double>
            <double>0.31</double>
            <double>0.315</double>
            <double>0.33</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Gatton.rainfed.TOS1.HatTrick">
    <metfile name="met">
      <filename>Gatton.met</filename>
    </metfile>
    <clock>
      <start_date>21/05/2019</start_date>
      <end_date>16/02/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>22/05/2019</sow_date>
            <reset_date>21/05/2019</reset_date>
            <cultivar>HatTrick</cultivar>
            <density>25</density>
            <soil>Black Vertosol (Lawes No037) </soil>
            <Irrigation_level>rainfed</Irrigation_level>
            <site>Gatton</site>
            <tos>TOS1</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif


if (today = Date('22-may')) then
irrigation apply amount = 40
endif

if (today = Date('11-jun')) then
irrigation apply amount = 15
endif

if (today = Date('26-jun')) then
irrigation apply amount = 15
endif

if (today = Date('15-aug')) then
irrigation apply amount = 15
endif
</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Black Vertosol (Lawes No037) ">
        <RecordNumber>148</RecordNumber>
        <ASCOrder>Vertosol</ASCOrder>
        <ASCSubOrder>Black</ASCSubOrder>
        <SoilType>Clay</SoilType>
        <LocalName/>
        <Site>Lawes</Site>
        <NearestTown>Lawes, Q 4343</NearestTown>
        <Region>Southeast Coast</Region>
        <State>Queensland</State>
        <Country>Australia</Country>
        <NaturalVegetation>Blue Gum, Moreton Bay Ash, Tea Tree</NaturalVegetation>
        <ApsoilNumber>37</ApsoilNumber>
        <Latitude>-27.537</Latitude>
        <Longitude>152.336</Longitude>
        <LocationAccuracy>+/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>CSIRO Sustainable Ecosystems, Toowoomba</DataSource>
        <Comments>OC and ph estimated</Comments>
        <Water>
          <BDMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </BDMetadata>
          <AirDryMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </AirDryMetadata>
          <LL15Metadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </LL15Metadata>
          <DULMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </DULMetadata>
          <SATMetadata>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
          </SATMetadata>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.25</double>
            <double>1.25</double>
            <double>1.23</double>
            <double>1.27</double>
            <double>1.37</double>
            <double>1.35</double>
          </BD>
          <AirDry>
            <double>0.182</double>
            <double>0.259</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </AirDry>
          <LL15>
            <double>0.192</double>
            <double>0.273</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </LL15>
          <DUL>
            <double>0.49</double>
            <double>0.48</double>
            <double>0.386</double>
            <double>0.37</double>
            <double>0.34</double>
            <double>0.332</double>
          </DUL>
          <SAT>
            <double>0.52</double>
            <double>0.52</double>
            <double>0.509</double>
            <double>0.495</double>
            <double>0.459</double>
            <double>0.466</double>
          </SAT>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.192</double>
              <double>0.273</double>
              <double>0.298</double>
              <double>0.257</double>
              <double>0.265</double>
              <double>0.272</double>
            </LL>
            <KL>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2.5</WinterCona>
          <WinterU>4</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>40</DiffusConst>
          <DiffusSlope>16</DiffusSlope>
          <Salb>0.12</Salb>
          <CN2Bare>73</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.953846153846154</double>
            <double>0.953846153846154</double>
            <double>0.961538461538461</double>
            <double>0.846153846153846</double>
            <double>0.546153846153846</double>
            <double>0.261538461538462</double>
            <double>0.2</double>
          </OC>
          <OCMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.6</double>
            <double>0.8</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <PH>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
          </PH>
          <PHMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>57</double>
            <double>35</double>
            <double>14</double>
            <double>17</double>
            <double>23</double>
            <double>27</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.33</double>
            <double>0.355</double>
            <double>0.35</double>
            <double>0.31</double>
            <double>0.315</double>
            <double>0.33</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Gatton.rainfed.TOS2.Genesis">
    <metfile name="met">
      <filename>Gatton.met</filename>
    </metfile>
    <clock>
      <start_date>21/05/2019</start_date>
      <end_date>16/02/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>10/06/2019</sow_date>
            <reset_date>21/05/2019</reset_date>
            <cultivar>Genesis</cultivar>
            <density>25</density>
            <soil>Black Vertosol (Lawes No037) </soil>
            <Irrigation_level>rainfed</Irrigation_level>
            <site>Gatton</site>
            <tos>TOS2</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif


if (today = Date('22-may')) then
irrigation apply amount = 40
endif

if (today = Date('11-jun')) then
irrigation apply amount = 15
endif

if (today = Date('26-jun')) then
irrigation apply amount = 15
endif

if (today = Date('15-aug')) then
irrigation apply amount = 15
endif
</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Black Vertosol (Lawes No037) ">
        <RecordNumber>148</RecordNumber>
        <ASCOrder>Vertosol</ASCOrder>
        <ASCSubOrder>Black</ASCSubOrder>
        <SoilType>Clay</SoilType>
        <LocalName/>
        <Site>Lawes</Site>
        <NearestTown>Lawes, Q 4343</NearestTown>
        <Region>Southeast Coast</Region>
        <State>Queensland</State>
        <Country>Australia</Country>
        <NaturalVegetation>Blue Gum, Moreton Bay Ash, Tea Tree</NaturalVegetation>
        <ApsoilNumber>37</ApsoilNumber>
        <Latitude>-27.537</Latitude>
        <Longitude>152.336</Longitude>
        <LocationAccuracy>+/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>CSIRO Sustainable Ecosystems, Toowoomba</DataSource>
        <Comments>OC and ph estimated</Comments>
        <Water>
          <BDMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </BDMetadata>
          <AirDryMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </AirDryMetadata>
          <LL15Metadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </LL15Metadata>
          <DULMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </DULMetadata>
          <SATMetadata>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
          </SATMetadata>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.25</double>
            <double>1.25</double>
            <double>1.23</double>
            <double>1.27</double>
            <double>1.37</double>
            <double>1.35</double>
          </BD>
          <AirDry>
            <double>0.182</double>
            <double>0.259</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </AirDry>
          <LL15>
            <double>0.192</double>
            <double>0.273</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </LL15>
          <DUL>
            <double>0.49</double>
            <double>0.48</double>
            <double>0.386</double>
            <double>0.37</double>
            <double>0.34</double>
            <double>0.332</double>
          </DUL>
          <SAT>
            <double>0.52</double>
            <double>0.52</double>
            <double>0.509</double>
            <double>0.495</double>
            <double>0.459</double>
            <double>0.466</double>
          </SAT>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.192</double>
              <double>0.273</double>
              <double>0.298</double>
              <double>0.257</double>
              <double>0.265</double>
              <double>0.272</double>
            </LL>
            <KL>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2.5</WinterCona>
          <WinterU>4</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>40</DiffusConst>
          <DiffusSlope>16</DiffusSlope>
          <Salb>0.12</Salb>
          <CN2Bare>73</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.953846153846154</double>
            <double>0.953846153846154</double>
            <double>0.961538461538461</double>
            <double>0.846153846153846</double>
            <double>0.546153846153846</double>
            <double>0.261538461538462</double>
            <double>0.2</double>
          </OC>
          <OCMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.6</double>
            <double>0.8</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <PH>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
          </PH>
          <PHMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>57</double>
            <double>35</double>
            <double>14</double>
            <double>17</double>
            <double>23</double>
            <double>27</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.33</double>
            <double>0.355</double>
            <double>0.35</double>
            <double>0.31</double>
            <double>0.315</double>
            <double>0.33</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Gatton.rainfed.TOS2.HatTrick">
    <metfile name="met">
      <filename>Gatton.met</filename>
    </metfile>
    <clock>
      <start_date>21/05/2019</start_date>
      <end_date>16/02/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>10/06/2019</sow_date>
            <reset_date>21/05/2019</reset_date>
            <cultivar>HatTrick</cultivar>
            <density>25</density>
            <soil>Black Vertosol (Lawes No037) </soil>
            <Irrigation_level>rainfed</Irrigation_level>
            <site>Gatton</site>
            <tos>TOS2</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif


if (today = Date('22-may')) then
irrigation apply amount = 40
endif

if (today = Date('11-jun')) then
irrigation apply amount = 15
endif

if (today = Date('26-jun')) then
irrigation apply amount = 15
endif

if (today = Date('15-aug')) then
irrigation apply amount = 15
endif
</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Black Vertosol (Lawes No037) ">
        <RecordNumber>148</RecordNumber>
        <ASCOrder>Vertosol</ASCOrder>
        <ASCSubOrder>Black</ASCSubOrder>
        <SoilType>Clay</SoilType>
        <LocalName/>
        <Site>Lawes</Site>
        <NearestTown>Lawes, Q 4343</NearestTown>
        <Region>Southeast Coast</Region>
        <State>Queensland</State>
        <Country>Australia</Country>
        <NaturalVegetation>Blue Gum, Moreton Bay Ash, Tea Tree</NaturalVegetation>
        <ApsoilNumber>37</ApsoilNumber>
        <Latitude>-27.537</Latitude>
        <Longitude>152.336</Longitude>
        <LocationAccuracy>+/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>CSIRO Sustainable Ecosystems, Toowoomba</DataSource>
        <Comments>OC and ph estimated</Comments>
        <Water>
          <BDMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </BDMetadata>
          <AirDryMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </AirDryMetadata>
          <LL15Metadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </LL15Metadata>
          <DULMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </DULMetadata>
          <SATMetadata>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
          </SATMetadata>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.25</double>
            <double>1.25</double>
            <double>1.23</double>
            <double>1.27</double>
            <double>1.37</double>
            <double>1.35</double>
          </BD>
          <AirDry>
            <double>0.182</double>
            <double>0.259</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </AirDry>
          <LL15>
            <double>0.192</double>
            <double>0.273</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </LL15>
          <DUL>
            <double>0.49</double>
            <double>0.48</double>
            <double>0.386</double>
            <double>0.37</double>
            <double>0.34</double>
            <double>0.332</double>
          </DUL>
          <SAT>
            <double>0.52</double>
            <double>0.52</double>
            <double>0.509</double>
            <double>0.495</double>
            <double>0.459</double>
            <double>0.466</double>
          </SAT>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.192</double>
              <double>0.273</double>
              <double>0.298</double>
              <double>0.257</double>
              <double>0.265</double>
              <double>0.272</double>
            </LL>
            <KL>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2.5</WinterCona>
          <WinterU>4</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>40</DiffusConst>
          <DiffusSlope>16</DiffusSlope>
          <Salb>0.12</Salb>
          <CN2Bare>73</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.953846153846154</double>
            <double>0.953846153846154</double>
            <double>0.961538461538461</double>
            <double>0.846153846153846</double>
            <double>0.546153846153846</double>
            <double>0.261538461538462</double>
            <double>0.2</double>
          </OC>
          <OCMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.6</double>
            <double>0.8</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <PH>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
          </PH>
          <PHMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>57</double>
            <double>35</double>
            <double>14</double>
            <double>17</double>
            <double>23</double>
            <double>27</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.33</double>
            <double>0.355</double>
            <double>0.35</double>
            <double>0.31</double>
            <double>0.315</double>
            <double>0.33</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Gatton.rainfed.TOS3.Genesis">
    <metfile name="met">
      <filename>Gatton.met</filename>
    </metfile>
    <clock>
      <start_date>21/05/2019</start_date>
      <end_date>16/02/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>25/06/2019</sow_date>
            <reset_date>21/05/2019</reset_date>
            <cultivar>Genesis</cultivar>
            <density>25</density>
            <soil>Black Vertosol (Lawes No037) </soil>
            <Irrigation_level>rainfed</Irrigation_level>
            <site>Gatton</site>
            <tos>TOS3</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif


if (today = Date('22-may')) then
irrigation apply amount = 40
endif

if (today = Date('11-jun')) then
irrigation apply amount = 15
endif

if (today = Date('26-jun')) then
irrigation apply amount = 15
endif

if (today = Date('15-aug')) then
irrigation apply amount = 15
endif
</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Black Vertosol (Lawes No037) ">
        <RecordNumber>148</RecordNumber>
        <ASCOrder>Vertosol</ASCOrder>
        <ASCSubOrder>Black</ASCSubOrder>
        <SoilType>Clay</SoilType>
        <LocalName/>
        <Site>Lawes</Site>
        <NearestTown>Lawes, Q 4343</NearestTown>
        <Region>Southeast Coast</Region>
        <State>Queensland</State>
        <Country>Australia</Country>
        <NaturalVegetation>Blue Gum, Moreton Bay Ash, Tea Tree</NaturalVegetation>
        <ApsoilNumber>37</ApsoilNumber>
        <Latitude>-27.537</Latitude>
        <Longitude>152.336</Longitude>
        <LocationAccuracy>+/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>CSIRO Sustainable Ecosystems, Toowoomba</DataSource>
        <Comments>OC and ph estimated</Comments>
        <Water>
          <BDMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </BDMetadata>
          <AirDryMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </AirDryMetadata>
          <LL15Metadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </LL15Metadata>
          <DULMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </DULMetadata>
          <SATMetadata>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
          </SATMetadata>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.25</double>
            <double>1.25</double>
            <double>1.23</double>
            <double>1.27</double>
            <double>1.37</double>
            <double>1.35</double>
          </BD>
          <AirDry>
            <double>0.182</double>
            <double>0.259</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </AirDry>
          <LL15>
            <double>0.192</double>
            <double>0.273</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </LL15>
          <DUL>
            <double>0.49</double>
            <double>0.48</double>
            <double>0.386</double>
            <double>0.37</double>
            <double>0.34</double>
            <double>0.332</double>
          </DUL>
          <SAT>
            <double>0.52</double>
            <double>0.52</double>
            <double>0.509</double>
            <double>0.495</double>
            <double>0.459</double>
            <double>0.466</double>
          </SAT>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.192</double>
              <double>0.273</double>
              <double>0.298</double>
              <double>0.257</double>
              <double>0.265</double>
              <double>0.272</double>
            </LL>
            <KL>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2.5</WinterCona>
          <WinterU>4</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>40</DiffusConst>
          <DiffusSlope>16</DiffusSlope>
          <Salb>0.12</Salb>
          <CN2Bare>73</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.953846153846154</double>
            <double>0.953846153846154</double>
            <double>0.961538461538461</double>
            <double>0.846153846153846</double>
            <double>0.546153846153846</double>
            <double>0.261538461538462</double>
            <double>0.2</double>
          </OC>
          <OCMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.6</double>
            <double>0.8</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <PH>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
          </PH>
          <PHMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>57</double>
            <double>35</double>
            <double>14</double>
            <double>17</double>
            <double>23</double>
            <double>27</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.33</double>
            <double>0.355</double>
            <double>0.35</double>
            <double>0.31</double>
            <double>0.315</double>
            <double>0.33</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Gatton.rainfed.TOS3.HatTrick">
    <metfile name="met">
      <filename>Gatton.met</filename>
    </metfile>
    <clock>
      <start_date>21/05/2019</start_date>
      <end_date>16/02/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>25/06/2019</sow_date>
            <reset_date>21/05/2019</reset_date>
            <cultivar>HatTrick</cultivar>
            <density>25</density>
            <soil>Black Vertosol (Lawes No037) </soil>
            <Irrigation_level>rainfed</Irrigation_level>
            <site>Gatton</site>
            <tos>TOS3</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif


if (today = Date('22-may')) then
irrigation apply amount = 40
endif

if (today = Date('11-jun')) then
irrigation apply amount = 15
endif

if (today = Date('26-jun')) then
irrigation apply amount = 15
endif

if (today = Date('15-aug')) then
irrigation apply amount = 15
endif
</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Black Vertosol (Lawes No037) ">
        <RecordNumber>148</RecordNumber>
        <ASCOrder>Vertosol</ASCOrder>
        <ASCSubOrder>Black</ASCSubOrder>
        <SoilType>Clay</SoilType>
        <LocalName/>
        <Site>Lawes</Site>
        <NearestTown>Lawes, Q 4343</NearestTown>
        <Region>Southeast Coast</Region>
        <State>Queensland</State>
        <Country>Australia</Country>
        <NaturalVegetation>Blue Gum, Moreton Bay Ash, Tea Tree</NaturalVegetation>
        <ApsoilNumber>37</ApsoilNumber>
        <Latitude>-27.537</Latitude>
        <Longitude>152.336</Longitude>
        <LocationAccuracy>+/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>CSIRO Sustainable Ecosystems, Toowoomba</DataSource>
        <Comments>OC and ph estimated</Comments>
        <Water>
          <BDMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </BDMetadata>
          <AirDryMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </AirDryMetadata>
          <LL15Metadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </LL15Metadata>
          <DULMetadata>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
            <string>Field measured and checked for sensibility</string>
          </DULMetadata>
          <SATMetadata>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
            <string>Calculated from measured, estimated or calculated BD</string>
          </SATMetadata>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.25</double>
            <double>1.25</double>
            <double>1.23</double>
            <double>1.27</double>
            <double>1.37</double>
            <double>1.35</double>
          </BD>
          <AirDry>
            <double>0.182</double>
            <double>0.259</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </AirDry>
          <LL15>
            <double>0.192</double>
            <double>0.273</double>
            <double>0.298</double>
            <double>0.257</double>
            <double>0.265</double>
            <double>0.272</double>
          </LL15>
          <DUL>
            <double>0.49</double>
            <double>0.48</double>
            <double>0.386</double>
            <double>0.37</double>
            <double>0.34</double>
            <double>0.332</double>
          </DUL>
          <SAT>
            <double>0.52</double>
            <double>0.52</double>
            <double>0.509</double>
            <double>0.495</double>
            <double>0.459</double>
            <double>0.466</double>
          </SAT>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.192</double>
              <double>0.273</double>
              <double>0.298</double>
              <double>0.257</double>
              <double>0.265</double>
              <double>0.272</double>
            </LL>
            <KL>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.08</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2.5</WinterCona>
          <WinterU>4</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>40</DiffusConst>
          <DiffusSlope>16</DiffusSlope>
          <Salb>0.12</Salb>
          <CN2Bare>73</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.953846153846154</double>
            <double>0.953846153846154</double>
            <double>0.961538461538461</double>
            <double>0.846153846153846</double>
            <double>0.546153846153846</double>
            <double>0.261538461538462</double>
            <double>0.2</double>
          </OC>
          <OCMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.6</double>
            <double>0.8</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <PH>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
            <double>8</double>
          </PH>
          <PHMetadata>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>57</double>
            <double>35</double>
            <double>14</double>
            <double>17</double>
            <double>23</double>
            <double>27</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.33</double>
            <double>0.355</double>
            <double>0.35</double>
            <double>0.31</double>
            <double>0.315</double>
            <double>0.33</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Greenethorpe.irrigated.TOS1.Genesis">
    <metfile name="met">
      <filename>Greenethorpe.met</filename>
    </metfile>
    <clock>
      <start_date>29/04/2019</start_date>
      <end_date>25/01/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>30/04/2019</sow_date>
            <reset_date>29/04/2019</reset_date>
            <cultivar>Genesis</cultivar>
            <density>25</density>
            <soil>Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)</soil>
            <Irrigation_level>irrigated</Irrigation_level>
            <site>Greenethorpe</site>
            <tos>TOS1</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif


if (today = Date('21-may')) then
if (TOS = 'TOS2') then 
 irrigation apply amount = 15 
 endif
endif

if (today = Date('13-aug')) then
irrigation apply amount = 10
endif

if (today = Date('14-aug')) then
irrigation apply amount = 10
endif

if (today = Date('15-aug')) then
irrigation apply amount = 10
endif

if (today = Date('26-aug')) then
irrigation apply amount = 10
endif

if (today = Date('31-aug')) then
irrigation apply amount = 10
endif

if (today = Date('03-sep')) then
irrigation apply amount = 10
endif

if (today = Date('25-sep')) then
irrigation apply amount = 10
endif

if (today = Date('30-sep')) then
irrigation apply amount = 10
endif

if (today = Date('1-oct')) then
irrigation apply amount = 10
endif
</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)">
        <RecordNumber>178</RecordNumber>
        <ASCOrder/>
        <ASCSubOrder/>
        <SoilType>Sandy loam </SoilType>
        <LocalName/>
        <Site>Greenethorpe</Site>
        <NearestTown>Greenethorpe</NearestTown>
        <Region>Central West Slopes and Plains</Region>
        <State>New South Wales</State>
        <Country>Australia</Country>
        <NaturalVegetation/>
        <ApsoilNumber>691</ApsoilNumber>
        <Latitude>-34.01972</Latitude>
        <Longitude>148.39261</Longitude>
        <LocationAccuracy> +/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>Data collected as part of the GRDC project ‘Training growers to manage soil water’ by CSIRO Sustainable Ecosystems in collaboration with farmers and Lachlan CMA</DataSource>
        <Comments>Classification based on partical size analysis.</Comments>
        <Water>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.48580542264753</double>
            <double>1.48548644338118</double>
            <double>1.53604465709729</double>
            <double>1.47304625199362</double>
            <double>1.62232854864434</double>
            <double>1.59237375099871</double>
          </BD>
          <AirDry>
            <double>0.05</double>
            <double>0.08</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </AirDry>
          <LL15>
            <double>0.1</double>
            <double>0.1</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </LL15>
          <DUL>
            <double>0.212928416447704</double>
            <double>0.205254328299839</double>
            <double>0.250328719742656</double>
            <double>0.296631845906788</double>
            <double>0.303413715125929</double>
            <double>0.319104244906146</double>
          </DUL>
          <SAT>
            <double>0.409318708434895</double>
            <double>0.409439077969366</double>
            <double>0.39036050675574</double>
            <double>0.414133489813728</double>
            <double>0.357800547681382</double>
            <double>0.369104244906146</double>
          </SAT>
          <SoilCrop name="wheat">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="barley">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.05</double>
              <double>0.05</double>
              <double>0.03</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="oats">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
          <SoilCrop name="canola">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2</WinterCona>
          <WinterU>2</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>88</DiffusConst>
          <DiffusSlope>35</DiffusSlope>
          <Salb>0.13</Salb>
          <CN2Bare>68</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.5</double>
            <double>0.5</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.95545515394913</double>
            <double>0.34206827309237</double>
            <double>0.172858099062918</double>
            <double>0.04595046854083</double>
            <double>0.04595046854083</double>
            <double>0.0459505</double>
          </OC>
          <OCMetadata>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.5</double>
            <double>0.7</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <Texture>
            <string>Sandy loam</string>
            <string>Sandy clay loam</string>
            <string>Sandy clay</string>
            <string>Heavy clay</string>
            <string>Heavy clay</string>
            <string/>
          </Texture>
          <EC>
            <double>0.051</double>
            <double>0.052</double>
            <double>0.033</double>
            <double>0.054</double>
            <double>0.039</double>
            <double>NaN</double>
          </EC>
          <PH>
            <double>4.9</double>
            <double>5.3</double>
            <double>6</double>
            <double>6.4</double>
            <double>6.4</double>
            <double>6.4</double>
          </PH>
          <PHMetadata>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <CL>
            <double>14.7715151515151</double>
            <double>14.7715151515151</double>
            <double>9.62707070707071</double>
            <double>17.4146464646465</double>
            <double>9.62707070707071</double>
            <double>NaN</double>
          </CL>
          <Boron>
            <double>0.603846967220306</double>
            <double>0.594115257263184</double>
            <double>0.649315655231476</double>
            <double>0.862612664699554</double>
            <double>1.26479303836823</double>
            <double>NaN</double>
          </Boron>
          <CEC>
            <double>5.39634633436799</double>
            <double>6.99875513091683</double>
            <double>8.67176376655698</double>
            <double>14.0939270183444</double>
            <double>14.0319516956806</double>
            <double>NaN</double>
          </CEC>
          <Ca>
            <double>3.92466855049133</double>
            <double>5.52656364440918</double>
            <double>6.10458183288574</double>
            <double>8.60516834259033</double>
            <double>8.16468906402588</double>
            <double>NaN</double>
          </Ca>
          <Mg>
            <double>0.518550574779511</double>
            <double>0.987762272357941</double>
            <double>2.07717967033386</double>
            <double>4.75020360946655</double>
            <double>4.96332788467407</double>
            <double>NaN</double>
          </Mg>
          <Na>
            <double>0.0558853186666965</double>
            <double>0.0399000681936741</double>
            <double>0.0451155491173267</double>
            <double>0.0929039046168327</double>
            <double>0.11166724562645</double>
            <double>NaN</double>
          </Na>
          <K>
            <double>0.89724189043045</double>
            <double>0.444529145956039</double>
            <double>0.444886714220047</double>
            <double>0.645651161670685</double>
            <double>0.792267501354218</double>
            <double>NaN</double>
          </K>
          <ESP>
            <double>1.03561400999741</double>
            <double>0.57010236031</double>
            <double>0.520258050516975</double>
            <double>0.659176853235515</double>
            <double>0.795806941530618</double>
            <double>NaN</double>
          </ESP>
          <ParticleSizeSand>
            <double>74.8673428</double>
            <double>64.823956048</double>
            <double>52.991956048</double>
            <double>32.183956048</double>
            <double>35.447956048</double>
            <double>NaN</double>
          </ParticleSizeSand>
          <ParticleSizeSilt>
            <double>5.92687319</double>
            <double>9.89027904</double>
            <double>8.66627904</double>
            <double>6.21827904000001</double>
            <double>5.40227903</double>
            <double>NaN</double>
          </ParticleSizeSilt>
          <ParticleSizeClay>
            <double>19.205784</double>
            <double>25.285764912</double>
            <double>38.341764912</double>
            <double>61.597764912</double>
            <double>59.149764912</double>
            <double>NaN</double>
          </ParticleSizeClay>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>42</double>
            <double>14</double>
            <double>7</double>
            <double>7</double>
            <double>0</double>
            <double>0</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.1925</double>
            <double>0.3855</double>
            <double>0.319</double>
            <double>0.2965</double>
            <double>0.269</double>
            <double>0.255</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Greenethorpe.irrigated.TOS1.HatTrick">
    <metfile name="met">
      <filename>Greenethorpe.met</filename>
    </metfile>
    <clock>
      <start_date>29/04/2019</start_date>
      <end_date>25/01/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>30/04/2019</sow_date>
            <reset_date>29/04/2019</reset_date>
            <cultivar>HatTrick</cultivar>
            <density>25</density>
            <soil>Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)</soil>
            <Irrigation_level>irrigated</Irrigation_level>
            <site>Greenethorpe</site>
            <tos>TOS1</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif


if (today = Date('21-may')) then
if (TOS = 'TOS2') then 
 irrigation apply amount = 15 
 endif
endif

if (today = Date('13-aug')) then
irrigation apply amount = 10
endif

if (today = Date('14-aug')) then
irrigation apply amount = 10
endif

if (today = Date('15-aug')) then
irrigation apply amount = 10
endif

if (today = Date('26-aug')) then
irrigation apply amount = 10
endif

if (today = Date('31-aug')) then
irrigation apply amount = 10
endif

if (today = Date('03-sep')) then
irrigation apply amount = 10
endif

if (today = Date('25-sep')) then
irrigation apply amount = 10
endif

if (today = Date('30-sep')) then
irrigation apply amount = 10
endif

if (today = Date('1-oct')) then
irrigation apply amount = 10
endif
</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)">
        <RecordNumber>178</RecordNumber>
        <ASCOrder/>
        <ASCSubOrder/>
        <SoilType>Sandy loam </SoilType>
        <LocalName/>
        <Site>Greenethorpe</Site>
        <NearestTown>Greenethorpe</NearestTown>
        <Region>Central West Slopes and Plains</Region>
        <State>New South Wales</State>
        <Country>Australia</Country>
        <NaturalVegetation/>
        <ApsoilNumber>691</ApsoilNumber>
        <Latitude>-34.01972</Latitude>
        <Longitude>148.39261</Longitude>
        <LocationAccuracy> +/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>Data collected as part of the GRDC project ‘Training growers to manage soil water’ by CSIRO Sustainable Ecosystems in collaboration with farmers and Lachlan CMA</DataSource>
        <Comments>Classification based on partical size analysis.</Comments>
        <Water>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.48580542264753</double>
            <double>1.48548644338118</double>
            <double>1.53604465709729</double>
            <double>1.47304625199362</double>
            <double>1.62232854864434</double>
            <double>1.59237375099871</double>
          </BD>
          <AirDry>
            <double>0.05</double>
            <double>0.08</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </AirDry>
          <LL15>
            <double>0.1</double>
            <double>0.1</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </LL15>
          <DUL>
            <double>0.212928416447704</double>
            <double>0.205254328299839</double>
            <double>0.250328719742656</double>
            <double>0.296631845906788</double>
            <double>0.303413715125929</double>
            <double>0.319104244906146</double>
          </DUL>
          <SAT>
            <double>0.409318708434895</double>
            <double>0.409439077969366</double>
            <double>0.39036050675574</double>
            <double>0.414133489813728</double>
            <double>0.357800547681382</double>
            <double>0.369104244906146</double>
          </SAT>
          <SoilCrop name="wheat">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="barley">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.05</double>
              <double>0.05</double>
              <double>0.03</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="oats">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
          <SoilCrop name="canola">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2</WinterCona>
          <WinterU>2</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>88</DiffusConst>
          <DiffusSlope>35</DiffusSlope>
          <Salb>0.13</Salb>
          <CN2Bare>68</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.5</double>
            <double>0.5</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.95545515394913</double>
            <double>0.34206827309237</double>
            <double>0.172858099062918</double>
            <double>0.04595046854083</double>
            <double>0.04595046854083</double>
            <double>0.0459505</double>
          </OC>
          <OCMetadata>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.5</double>
            <double>0.7</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <Texture>
            <string>Sandy loam</string>
            <string>Sandy clay loam</string>
            <string>Sandy clay</string>
            <string>Heavy clay</string>
            <string>Heavy clay</string>
            <string/>
          </Texture>
          <EC>
            <double>0.051</double>
            <double>0.052</double>
            <double>0.033</double>
            <double>0.054</double>
            <double>0.039</double>
            <double>NaN</double>
          </EC>
          <PH>
            <double>4.9</double>
            <double>5.3</double>
            <double>6</double>
            <double>6.4</double>
            <double>6.4</double>
            <double>6.4</double>
          </PH>
          <PHMetadata>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <CL>
            <double>14.7715151515151</double>
            <double>14.7715151515151</double>
            <double>9.62707070707071</double>
            <double>17.4146464646465</double>
            <double>9.62707070707071</double>
            <double>NaN</double>
          </CL>
          <Boron>
            <double>0.603846967220306</double>
            <double>0.594115257263184</double>
            <double>0.649315655231476</double>
            <double>0.862612664699554</double>
            <double>1.26479303836823</double>
            <double>NaN</double>
          </Boron>
          <CEC>
            <double>5.39634633436799</double>
            <double>6.99875513091683</double>
            <double>8.67176376655698</double>
            <double>14.0939270183444</double>
            <double>14.0319516956806</double>
            <double>NaN</double>
          </CEC>
          <Ca>
            <double>3.92466855049133</double>
            <double>5.52656364440918</double>
            <double>6.10458183288574</double>
            <double>8.60516834259033</double>
            <double>8.16468906402588</double>
            <double>NaN</double>
          </Ca>
          <Mg>
            <double>0.518550574779511</double>
            <double>0.987762272357941</double>
            <double>2.07717967033386</double>
            <double>4.75020360946655</double>
            <double>4.96332788467407</double>
            <double>NaN</double>
          </Mg>
          <Na>
            <double>0.0558853186666965</double>
            <double>0.0399000681936741</double>
            <double>0.0451155491173267</double>
            <double>0.0929039046168327</double>
            <double>0.11166724562645</double>
            <double>NaN</double>
          </Na>
          <K>
            <double>0.89724189043045</double>
            <double>0.444529145956039</double>
            <double>0.444886714220047</double>
            <double>0.645651161670685</double>
            <double>0.792267501354218</double>
            <double>NaN</double>
          </K>
          <ESP>
            <double>1.03561400999741</double>
            <double>0.57010236031</double>
            <double>0.520258050516975</double>
            <double>0.659176853235515</double>
            <double>0.795806941530618</double>
            <double>NaN</double>
          </ESP>
          <ParticleSizeSand>
            <double>74.8673428</double>
            <double>64.823956048</double>
            <double>52.991956048</double>
            <double>32.183956048</double>
            <double>35.447956048</double>
            <double>NaN</double>
          </ParticleSizeSand>
          <ParticleSizeSilt>
            <double>5.92687319</double>
            <double>9.89027904</double>
            <double>8.66627904</double>
            <double>6.21827904000001</double>
            <double>5.40227903</double>
            <double>NaN</double>
          </ParticleSizeSilt>
          <ParticleSizeClay>
            <double>19.205784</double>
            <double>25.285764912</double>
            <double>38.341764912</double>
            <double>61.597764912</double>
            <double>59.149764912</double>
            <double>NaN</double>
          </ParticleSizeClay>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>42</double>
            <double>14</double>
            <double>7</double>
            <double>7</double>
            <double>0</double>
            <double>0</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.1925</double>
            <double>0.3855</double>
            <double>0.319</double>
            <double>0.2965</double>
            <double>0.269</double>
            <double>0.255</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Greenethorpe.irrigated.TOS2.Genesis">
    <metfile name="met">
      <filename>Greenethorpe.met</filename>
    </metfile>
    <clock>
      <start_date>29/04/2019</start_date>
      <end_date>25/01/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>21/05/2019</sow_date>
            <reset_date>29/04/2019</reset_date>
            <cultivar>Genesis</cultivar>
            <density>25</density>
            <soil>Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)</soil>
            <Irrigation_level>irrigated</Irrigation_level>
            <site>Greenethorpe</site>
            <tos>TOS2</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif


if (today = Date('21-may')) then
if (TOS = 'TOS2') then 
 irrigation apply amount = 15 
 endif
endif

if (today = Date('13-aug')) then
irrigation apply amount = 10
endif

if (today = Date('14-aug')) then
irrigation apply amount = 10
endif

if (today = Date('15-aug')) then
irrigation apply amount = 10
endif

if (today = Date('26-aug')) then
irrigation apply amount = 10
endif

if (today = Date('31-aug')) then
irrigation apply amount = 10
endif

if (today = Date('03-sep')) then
irrigation apply amount = 10
endif

if (today = Date('25-sep')) then
irrigation apply amount = 10
endif

if (today = Date('30-sep')) then
irrigation apply amount = 10
endif

if (today = Date('1-oct')) then
irrigation apply amount = 10
endif
</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)">
        <RecordNumber>178</RecordNumber>
        <ASCOrder/>
        <ASCSubOrder/>
        <SoilType>Sandy loam </SoilType>
        <LocalName/>
        <Site>Greenethorpe</Site>
        <NearestTown>Greenethorpe</NearestTown>
        <Region>Central West Slopes and Plains</Region>
        <State>New South Wales</State>
        <Country>Australia</Country>
        <NaturalVegetation/>
        <ApsoilNumber>691</ApsoilNumber>
        <Latitude>-34.01972</Latitude>
        <Longitude>148.39261</Longitude>
        <LocationAccuracy> +/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>Data collected as part of the GRDC project ‘Training growers to manage soil water’ by CSIRO Sustainable Ecosystems in collaboration with farmers and Lachlan CMA</DataSource>
        <Comments>Classification based on partical size analysis.</Comments>
        <Water>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.48580542264753</double>
            <double>1.48548644338118</double>
            <double>1.53604465709729</double>
            <double>1.47304625199362</double>
            <double>1.62232854864434</double>
            <double>1.59237375099871</double>
          </BD>
          <AirDry>
            <double>0.05</double>
            <double>0.08</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </AirDry>
          <LL15>
            <double>0.1</double>
            <double>0.1</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </LL15>
          <DUL>
            <double>0.212928416447704</double>
            <double>0.205254328299839</double>
            <double>0.250328719742656</double>
            <double>0.296631845906788</double>
            <double>0.303413715125929</double>
            <double>0.319104244906146</double>
          </DUL>
          <SAT>
            <double>0.409318708434895</double>
            <double>0.409439077969366</double>
            <double>0.39036050675574</double>
            <double>0.414133489813728</double>
            <double>0.357800547681382</double>
            <double>0.369104244906146</double>
          </SAT>
          <SoilCrop name="wheat">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="barley">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.05</double>
              <double>0.05</double>
              <double>0.03</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="oats">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
          <SoilCrop name="canola">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2</WinterCona>
          <WinterU>2</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>88</DiffusConst>
          <DiffusSlope>35</DiffusSlope>
          <Salb>0.13</Salb>
          <CN2Bare>68</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.5</double>
            <double>0.5</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.95545515394913</double>
            <double>0.34206827309237</double>
            <double>0.172858099062918</double>
            <double>0.04595046854083</double>
            <double>0.04595046854083</double>
            <double>0.0459505</double>
          </OC>
          <OCMetadata>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.5</double>
            <double>0.7</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <Texture>
            <string>Sandy loam</string>
            <string>Sandy clay loam</string>
            <string>Sandy clay</string>
            <string>Heavy clay</string>
            <string>Heavy clay</string>
            <string/>
          </Texture>
          <EC>
            <double>0.051</double>
            <double>0.052</double>
            <double>0.033</double>
            <double>0.054</double>
            <double>0.039</double>
            <double>NaN</double>
          </EC>
          <PH>
            <double>4.9</double>
            <double>5.3</double>
            <double>6</double>
            <double>6.4</double>
            <double>6.4</double>
            <double>6.4</double>
          </PH>
          <PHMetadata>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <CL>
            <double>14.7715151515151</double>
            <double>14.7715151515151</double>
            <double>9.62707070707071</double>
            <double>17.4146464646465</double>
            <double>9.62707070707071</double>
            <double>NaN</double>
          </CL>
          <Boron>
            <double>0.603846967220306</double>
            <double>0.594115257263184</double>
            <double>0.649315655231476</double>
            <double>0.862612664699554</double>
            <double>1.26479303836823</double>
            <double>NaN</double>
          </Boron>
          <CEC>
            <double>5.39634633436799</double>
            <double>6.99875513091683</double>
            <double>8.67176376655698</double>
            <double>14.0939270183444</double>
            <double>14.0319516956806</double>
            <double>NaN</double>
          </CEC>
          <Ca>
            <double>3.92466855049133</double>
            <double>5.52656364440918</double>
            <double>6.10458183288574</double>
            <double>8.60516834259033</double>
            <double>8.16468906402588</double>
            <double>NaN</double>
          </Ca>
          <Mg>
            <double>0.518550574779511</double>
            <double>0.987762272357941</double>
            <double>2.07717967033386</double>
            <double>4.75020360946655</double>
            <double>4.96332788467407</double>
            <double>NaN</double>
          </Mg>
          <Na>
            <double>0.0558853186666965</double>
            <double>0.0399000681936741</double>
            <double>0.0451155491173267</double>
            <double>0.0929039046168327</double>
            <double>0.11166724562645</double>
            <double>NaN</double>
          </Na>
          <K>
            <double>0.89724189043045</double>
            <double>0.444529145956039</double>
            <double>0.444886714220047</double>
            <double>0.645651161670685</double>
            <double>0.792267501354218</double>
            <double>NaN</double>
          </K>
          <ESP>
            <double>1.03561400999741</double>
            <double>0.57010236031</double>
            <double>0.520258050516975</double>
            <double>0.659176853235515</double>
            <double>0.795806941530618</double>
            <double>NaN</double>
          </ESP>
          <ParticleSizeSand>
            <double>74.8673428</double>
            <double>64.823956048</double>
            <double>52.991956048</double>
            <double>32.183956048</double>
            <double>35.447956048</double>
            <double>NaN</double>
          </ParticleSizeSand>
          <ParticleSizeSilt>
            <double>5.92687319</double>
            <double>9.89027904</double>
            <double>8.66627904</double>
            <double>6.21827904000001</double>
            <double>5.40227903</double>
            <double>NaN</double>
          </ParticleSizeSilt>
          <ParticleSizeClay>
            <double>19.205784</double>
            <double>25.285764912</double>
            <double>38.341764912</double>
            <double>61.597764912</double>
            <double>59.149764912</double>
            <double>NaN</double>
          </ParticleSizeClay>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>42</double>
            <double>14</double>
            <double>7</double>
            <double>7</double>
            <double>0</double>
            <double>0</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.1925</double>
            <double>0.3855</double>
            <double>0.319</double>
            <double>0.2965</double>
            <double>0.269</double>
            <double>0.255</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Greenethorpe.irrigated.TOS2.HatTrick">
    <metfile name="met">
      <filename>Greenethorpe.met</filename>
    </metfile>
    <clock>
      <start_date>29/04/2019</start_date>
      <end_date>25/01/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>21/05/2019</sow_date>
            <reset_date>29/04/2019</reset_date>
            <cultivar>HatTrick</cultivar>
            <density>25</density>
            <soil>Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)</soil>
            <Irrigation_level>irrigated</Irrigation_level>
            <site>Greenethorpe</site>
            <tos>TOS2</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif


if (today = Date('21-may')) then
if (TOS = 'TOS2') then 
 irrigation apply amount = 15 
 endif
endif

if (today = Date('13-aug')) then
irrigation apply amount = 10
endif

if (today = Date('14-aug')) then
irrigation apply amount = 10
endif

if (today = Date('15-aug')) then
irrigation apply amount = 10
endif

if (today = Date('26-aug')) then
irrigation apply amount = 10
endif

if (today = Date('31-aug')) then
irrigation apply amount = 10
endif

if (today = Date('03-sep')) then
irrigation apply amount = 10
endif

if (today = Date('25-sep')) then
irrigation apply amount = 10
endif

if (today = Date('30-sep')) then
irrigation apply amount = 10
endif

if (today = Date('1-oct')) then
irrigation apply amount = 10
endif
</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)">
        <RecordNumber>178</RecordNumber>
        <ASCOrder/>
        <ASCSubOrder/>
        <SoilType>Sandy loam </SoilType>
        <LocalName/>
        <Site>Greenethorpe</Site>
        <NearestTown>Greenethorpe</NearestTown>
        <Region>Central West Slopes and Plains</Region>
        <State>New South Wales</State>
        <Country>Australia</Country>
        <NaturalVegetation/>
        <ApsoilNumber>691</ApsoilNumber>
        <Latitude>-34.01972</Latitude>
        <Longitude>148.39261</Longitude>
        <LocationAccuracy> +/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>Data collected as part of the GRDC project ‘Training growers to manage soil water’ by CSIRO Sustainable Ecosystems in collaboration with farmers and Lachlan CMA</DataSource>
        <Comments>Classification based on partical size analysis.</Comments>
        <Water>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.48580542264753</double>
            <double>1.48548644338118</double>
            <double>1.53604465709729</double>
            <double>1.47304625199362</double>
            <double>1.62232854864434</double>
            <double>1.59237375099871</double>
          </BD>
          <AirDry>
            <double>0.05</double>
            <double>0.08</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </AirDry>
          <LL15>
            <double>0.1</double>
            <double>0.1</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </LL15>
          <DUL>
            <double>0.212928416447704</double>
            <double>0.205254328299839</double>
            <double>0.250328719742656</double>
            <double>0.296631845906788</double>
            <double>0.303413715125929</double>
            <double>0.319104244906146</double>
          </DUL>
          <SAT>
            <double>0.409318708434895</double>
            <double>0.409439077969366</double>
            <double>0.39036050675574</double>
            <double>0.414133489813728</double>
            <double>0.357800547681382</double>
            <double>0.369104244906146</double>
          </SAT>
          <SoilCrop name="wheat">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="barley">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.05</double>
              <double>0.05</double>
              <double>0.03</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="oats">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
          <SoilCrop name="canola">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2</WinterCona>
          <WinterU>2</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>88</DiffusConst>
          <DiffusSlope>35</DiffusSlope>
          <Salb>0.13</Salb>
          <CN2Bare>68</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.5</double>
            <double>0.5</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.95545515394913</double>
            <double>0.34206827309237</double>
            <double>0.172858099062918</double>
            <double>0.04595046854083</double>
            <double>0.04595046854083</double>
            <double>0.0459505</double>
          </OC>
          <OCMetadata>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.5</double>
            <double>0.7</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <Texture>
            <string>Sandy loam</string>
            <string>Sandy clay loam</string>
            <string>Sandy clay</string>
            <string>Heavy clay</string>
            <string>Heavy clay</string>
            <string/>
          </Texture>
          <EC>
            <double>0.051</double>
            <double>0.052</double>
            <double>0.033</double>
            <double>0.054</double>
            <double>0.039</double>
            <double>NaN</double>
          </EC>
          <PH>
            <double>4.9</double>
            <double>5.3</double>
            <double>6</double>
            <double>6.4</double>
            <double>6.4</double>
            <double>6.4</double>
          </PH>
          <PHMetadata>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <CL>
            <double>14.7715151515151</double>
            <double>14.7715151515151</double>
            <double>9.62707070707071</double>
            <double>17.4146464646465</double>
            <double>9.62707070707071</double>
            <double>NaN</double>
          </CL>
          <Boron>
            <double>0.603846967220306</double>
            <double>0.594115257263184</double>
            <double>0.649315655231476</double>
            <double>0.862612664699554</double>
            <double>1.26479303836823</double>
            <double>NaN</double>
          </Boron>
          <CEC>
            <double>5.39634633436799</double>
            <double>6.99875513091683</double>
            <double>8.67176376655698</double>
            <double>14.0939270183444</double>
            <double>14.0319516956806</double>
            <double>NaN</double>
          </CEC>
          <Ca>
            <double>3.92466855049133</double>
            <double>5.52656364440918</double>
            <double>6.10458183288574</double>
            <double>8.60516834259033</double>
            <double>8.16468906402588</double>
            <double>NaN</double>
          </Ca>
          <Mg>
            <double>0.518550574779511</double>
            <double>0.987762272357941</double>
            <double>2.07717967033386</double>
            <double>4.75020360946655</double>
            <double>4.96332788467407</double>
            <double>NaN</double>
          </Mg>
          <Na>
            <double>0.0558853186666965</double>
            <double>0.0399000681936741</double>
            <double>0.0451155491173267</double>
            <double>0.0929039046168327</double>
            <double>0.11166724562645</double>
            <double>NaN</double>
          </Na>
          <K>
            <double>0.89724189043045</double>
            <double>0.444529145956039</double>
            <double>0.444886714220047</double>
            <double>0.645651161670685</double>
            <double>0.792267501354218</double>
            <double>NaN</double>
          </K>
          <ESP>
            <double>1.03561400999741</double>
            <double>0.57010236031</double>
            <double>0.520258050516975</double>
            <double>0.659176853235515</double>
            <double>0.795806941530618</double>
            <double>NaN</double>
          </ESP>
          <ParticleSizeSand>
            <double>74.8673428</double>
            <double>64.823956048</double>
            <double>52.991956048</double>
            <double>32.183956048</double>
            <double>35.447956048</double>
            <double>NaN</double>
          </ParticleSizeSand>
          <ParticleSizeSilt>
            <double>5.92687319</double>
            <double>9.89027904</double>
            <double>8.66627904</double>
            <double>6.21827904000001</double>
            <double>5.40227903</double>
            <double>NaN</double>
          </ParticleSizeSilt>
          <ParticleSizeClay>
            <double>19.205784</double>
            <double>25.285764912</double>
            <double>38.341764912</double>
            <double>61.597764912</double>
            <double>59.149764912</double>
            <double>NaN</double>
          </ParticleSizeClay>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>42</double>
            <double>14</double>
            <double>7</double>
            <double>7</double>
            <double>0</double>
            <double>0</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.1925</double>
            <double>0.3855</double>
            <double>0.319</double>
            <double>0.2965</double>
            <double>0.269</double>
            <double>0.255</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Greenethorpe.irrigated.TOS3.Genesis">
    <metfile name="met">
      <filename>Greenethorpe.met</filename>
    </metfile>
    <clock>
      <start_date>29/04/2019</start_date>
      <end_date>25/01/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>11/06/2019</sow_date>
            <reset_date>29/04/2019</reset_date>
            <cultivar>Genesis</cultivar>
            <density>25</density>
            <soil>Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)</soil>
            <Irrigation_level>irrigated</Irrigation_level>
            <site>Greenethorpe</site>
            <tos>TOS3</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif


if (today = Date('21-may')) then
if (TOS = 'TOS2') then 
 irrigation apply amount = 15 
 endif
endif

if (today = Date('13-aug')) then
irrigation apply amount = 10
endif

if (today = Date('14-aug')) then
irrigation apply amount = 10
endif

if (today = Date('15-aug')) then
irrigation apply amount = 10
endif

if (today = Date('26-aug')) then
irrigation apply amount = 10
endif

if (today = Date('31-aug')) then
irrigation apply amount = 10
endif

if (today = Date('03-sep')) then
irrigation apply amount = 10
endif

if (today = Date('25-sep')) then
irrigation apply amount = 10
endif

if (today = Date('30-sep')) then
irrigation apply amount = 10
endif

if (today = Date('1-oct')) then
irrigation apply amount = 10
endif
</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)">
        <RecordNumber>178</RecordNumber>
        <ASCOrder/>
        <ASCSubOrder/>
        <SoilType>Sandy loam </SoilType>
        <LocalName/>
        <Site>Greenethorpe</Site>
        <NearestTown>Greenethorpe</NearestTown>
        <Region>Central West Slopes and Plains</Region>
        <State>New South Wales</State>
        <Country>Australia</Country>
        <NaturalVegetation/>
        <ApsoilNumber>691</ApsoilNumber>
        <Latitude>-34.01972</Latitude>
        <Longitude>148.39261</Longitude>
        <LocationAccuracy> +/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>Data collected as part of the GRDC project ‘Training growers to manage soil water’ by CSIRO Sustainable Ecosystems in collaboration with farmers and Lachlan CMA</DataSource>
        <Comments>Classification based on partical size analysis.</Comments>
        <Water>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.48580542264753</double>
            <double>1.48548644338118</double>
            <double>1.53604465709729</double>
            <double>1.47304625199362</double>
            <double>1.62232854864434</double>
            <double>1.59237375099871</double>
          </BD>
          <AirDry>
            <double>0.05</double>
            <double>0.08</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </AirDry>
          <LL15>
            <double>0.1</double>
            <double>0.1</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </LL15>
          <DUL>
            <double>0.212928416447704</double>
            <double>0.205254328299839</double>
            <double>0.250328719742656</double>
            <double>0.296631845906788</double>
            <double>0.303413715125929</double>
            <double>0.319104244906146</double>
          </DUL>
          <SAT>
            <double>0.409318708434895</double>
            <double>0.409439077969366</double>
            <double>0.39036050675574</double>
            <double>0.414133489813728</double>
            <double>0.357800547681382</double>
            <double>0.369104244906146</double>
          </SAT>
          <SoilCrop name="wheat">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="barley">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.05</double>
              <double>0.05</double>
              <double>0.03</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="oats">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
          <SoilCrop name="canola">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2</WinterCona>
          <WinterU>2</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>88</DiffusConst>
          <DiffusSlope>35</DiffusSlope>
          <Salb>0.13</Salb>
          <CN2Bare>68</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.5</double>
            <double>0.5</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.95545515394913</double>
            <double>0.34206827309237</double>
            <double>0.172858099062918</double>
            <double>0.04595046854083</double>
            <double>0.04595046854083</double>
            <double>0.0459505</double>
          </OC>
          <OCMetadata>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.5</double>
            <double>0.7</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <Texture>
            <string>Sandy loam</string>
            <string>Sandy clay loam</string>
            <string>Sandy clay</string>
            <string>Heavy clay</string>
            <string>Heavy clay</string>
            <string/>
          </Texture>
          <EC>
            <double>0.051</double>
            <double>0.052</double>
            <double>0.033</double>
            <double>0.054</double>
            <double>0.039</double>
            <double>NaN</double>
          </EC>
          <PH>
            <double>4.9</double>
            <double>5.3</double>
            <double>6</double>
            <double>6.4</double>
            <double>6.4</double>
            <double>6.4</double>
          </PH>
          <PHMetadata>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <CL>
            <double>14.7715151515151</double>
            <double>14.7715151515151</double>
            <double>9.62707070707071</double>
            <double>17.4146464646465</double>
            <double>9.62707070707071</double>
            <double>NaN</double>
          </CL>
          <Boron>
            <double>0.603846967220306</double>
            <double>0.594115257263184</double>
            <double>0.649315655231476</double>
            <double>0.862612664699554</double>
            <double>1.26479303836823</double>
            <double>NaN</double>
          </Boron>
          <CEC>
            <double>5.39634633436799</double>
            <double>6.99875513091683</double>
            <double>8.67176376655698</double>
            <double>14.0939270183444</double>
            <double>14.0319516956806</double>
            <double>NaN</double>
          </CEC>
          <Ca>
            <double>3.92466855049133</double>
            <double>5.52656364440918</double>
            <double>6.10458183288574</double>
            <double>8.60516834259033</double>
            <double>8.16468906402588</double>
            <double>NaN</double>
          </Ca>
          <Mg>
            <double>0.518550574779511</double>
            <double>0.987762272357941</double>
            <double>2.07717967033386</double>
            <double>4.75020360946655</double>
            <double>4.96332788467407</double>
            <double>NaN</double>
          </Mg>
          <Na>
            <double>0.0558853186666965</double>
            <double>0.0399000681936741</double>
            <double>0.0451155491173267</double>
            <double>0.0929039046168327</double>
            <double>0.11166724562645</double>
            <double>NaN</double>
          </Na>
          <K>
            <double>0.89724189043045</double>
            <double>0.444529145956039</double>
            <double>0.444886714220047</double>
            <double>0.645651161670685</double>
            <double>0.792267501354218</double>
            <double>NaN</double>
          </K>
          <ESP>
            <double>1.03561400999741</double>
            <double>0.57010236031</double>
            <double>0.520258050516975</double>
            <double>0.659176853235515</double>
            <double>0.795806941530618</double>
            <double>NaN</double>
          </ESP>
          <ParticleSizeSand>
            <double>74.8673428</double>
            <double>64.823956048</double>
            <double>52.991956048</double>
            <double>32.183956048</double>
            <double>35.447956048</double>
            <double>NaN</double>
          </ParticleSizeSand>
          <ParticleSizeSilt>
            <double>5.92687319</double>
            <double>9.89027904</double>
            <double>8.66627904</double>
            <double>6.21827904000001</double>
            <double>5.40227903</double>
            <double>NaN</double>
          </ParticleSizeSilt>
          <ParticleSizeClay>
            <double>19.205784</double>
            <double>25.285764912</double>
            <double>38.341764912</double>
            <double>61.597764912</double>
            <double>59.149764912</double>
            <double>NaN</double>
          </ParticleSizeClay>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>42</double>
            <double>14</double>
            <double>7</double>
            <double>7</double>
            <double>0</double>
            <double>0</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.1925</double>
            <double>0.3855</double>
            <double>0.319</double>
            <double>0.2965</double>
            <double>0.269</double>
            <double>0.255</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Greenethorpe.irrigated.TOS3.HatTrick">
    <metfile name="met">
      <filename>Greenethorpe.met</filename>
    </metfile>
    <clock>
      <start_date>29/04/2019</start_date>
      <end_date>25/01/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>11/06/2019</sow_date>
            <reset_date>29/04/2019</reset_date>
            <cultivar>HatTrick</cultivar>
            <density>25</density>
            <soil>Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)</soil>
            <Irrigation_level>irrigated</Irrigation_level>
            <site>Greenethorpe</site>
            <tos>TOS3</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif


if (today = Date('21-may')) then
if (TOS = 'TOS2') then 
 irrigation apply amount = 15 
 endif
endif

if (today = Date('13-aug')) then
irrigation apply amount = 10
endif

if (today = Date('14-aug')) then
irrigation apply amount = 10
endif

if (today = Date('15-aug')) then
irrigation apply amount = 10
endif

if (today = Date('26-aug')) then
irrigation apply amount = 10
endif

if (today = Date('31-aug')) then
irrigation apply amount = 10
endif

if (today = Date('03-sep')) then
irrigation apply amount = 10
endif

if (today = Date('25-sep')) then
irrigation apply amount = 10
endif

if (today = Date('30-sep')) then
irrigation apply amount = 10
endif

if (today = Date('1-oct')) then
irrigation apply amount = 10
endif
</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)">
        <RecordNumber>178</RecordNumber>
        <ASCOrder/>
        <ASCSubOrder/>
        <SoilType>Sandy loam </SoilType>
        <LocalName/>
        <Site>Greenethorpe</Site>
        <NearestTown>Greenethorpe</NearestTown>
        <Region>Central West Slopes and Plains</Region>
        <State>New South Wales</State>
        <Country>Australia</Country>
        <NaturalVegetation/>
        <ApsoilNumber>691</ApsoilNumber>
        <Latitude>-34.01972</Latitude>
        <Longitude>148.39261</Longitude>
        <LocationAccuracy> +/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>Data collected as part of the GRDC project ‘Training growers to manage soil water’ by CSIRO Sustainable Ecosystems in collaboration with farmers and Lachlan CMA</DataSource>
        <Comments>Classification based on partical size analysis.</Comments>
        <Water>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.48580542264753</double>
            <double>1.48548644338118</double>
            <double>1.53604465709729</double>
            <double>1.47304625199362</double>
            <double>1.62232854864434</double>
            <double>1.59237375099871</double>
          </BD>
          <AirDry>
            <double>0.05</double>
            <double>0.08</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </AirDry>
          <LL15>
            <double>0.1</double>
            <double>0.1</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </LL15>
          <DUL>
            <double>0.212928416447704</double>
            <double>0.205254328299839</double>
            <double>0.250328719742656</double>
            <double>0.296631845906788</double>
            <double>0.303413715125929</double>
            <double>0.319104244906146</double>
          </DUL>
          <SAT>
            <double>0.409318708434895</double>
            <double>0.409439077969366</double>
            <double>0.39036050675574</double>
            <double>0.414133489813728</double>
            <double>0.357800547681382</double>
            <double>0.369104244906146</double>
          </SAT>
          <SoilCrop name="wheat">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="barley">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.05</double>
              <double>0.05</double>
              <double>0.03</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="oats">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
          <SoilCrop name="canola">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2</WinterCona>
          <WinterU>2</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>88</DiffusConst>
          <DiffusSlope>35</DiffusSlope>
          <Salb>0.13</Salb>
          <CN2Bare>68</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.5</double>
            <double>0.5</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.95545515394913</double>
            <double>0.34206827309237</double>
            <double>0.172858099062918</double>
            <double>0.04595046854083</double>
            <double>0.04595046854083</double>
            <double>0.0459505</double>
          </OC>
          <OCMetadata>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.5</double>
            <double>0.7</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <Texture>
            <string>Sandy loam</string>
            <string>Sandy clay loam</string>
            <string>Sandy clay</string>
            <string>Heavy clay</string>
            <string>Heavy clay</string>
            <string/>
          </Texture>
          <EC>
            <double>0.051</double>
            <double>0.052</double>
            <double>0.033</double>
            <double>0.054</double>
            <double>0.039</double>
            <double>NaN</double>
          </EC>
          <PH>
            <double>4.9</double>
            <double>5.3</double>
            <double>6</double>
            <double>6.4</double>
            <double>6.4</double>
            <double>6.4</double>
          </PH>
          <PHMetadata>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <CL>
            <double>14.7715151515151</double>
            <double>14.7715151515151</double>
            <double>9.62707070707071</double>
            <double>17.4146464646465</double>
            <double>9.62707070707071</double>
            <double>NaN</double>
          </CL>
          <Boron>
            <double>0.603846967220306</double>
            <double>0.594115257263184</double>
            <double>0.649315655231476</double>
            <double>0.862612664699554</double>
            <double>1.26479303836823</double>
            <double>NaN</double>
          </Boron>
          <CEC>
            <double>5.39634633436799</double>
            <double>6.99875513091683</double>
            <double>8.67176376655698</double>
            <double>14.0939270183444</double>
            <double>14.0319516956806</double>
            <double>NaN</double>
          </CEC>
          <Ca>
            <double>3.92466855049133</double>
            <double>5.52656364440918</double>
            <double>6.10458183288574</double>
            <double>8.60516834259033</double>
            <double>8.16468906402588</double>
            <double>NaN</double>
          </Ca>
          <Mg>
            <double>0.518550574779511</double>
            <double>0.987762272357941</double>
            <double>2.07717967033386</double>
            <double>4.75020360946655</double>
            <double>4.96332788467407</double>
            <double>NaN</double>
          </Mg>
          <Na>
            <double>0.0558853186666965</double>
            <double>0.0399000681936741</double>
            <double>0.0451155491173267</double>
            <double>0.0929039046168327</double>
            <double>0.11166724562645</double>
            <double>NaN</double>
          </Na>
          <K>
            <double>0.89724189043045</double>
            <double>0.444529145956039</double>
            <double>0.444886714220047</double>
            <double>0.645651161670685</double>
            <double>0.792267501354218</double>
            <double>NaN</double>
          </K>
          <ESP>
            <double>1.03561400999741</double>
            <double>0.57010236031</double>
            <double>0.520258050516975</double>
            <double>0.659176853235515</double>
            <double>0.795806941530618</double>
            <double>NaN</double>
          </ESP>
          <ParticleSizeSand>
            <double>74.8673428</double>
            <double>64.823956048</double>
            <double>52.991956048</double>
            <double>32.183956048</double>
            <double>35.447956048</double>
            <double>NaN</double>
          </ParticleSizeSand>
          <ParticleSizeSilt>
            <double>5.92687319</double>
            <double>9.89027904</double>
            <double>8.66627904</double>
            <double>6.21827904000001</double>
            <double>5.40227903</double>
            <double>NaN</double>
          </ParticleSizeSilt>
          <ParticleSizeClay>
            <double>19.205784</double>
            <double>25.285764912</double>
            <double>38.341764912</double>
            <double>61.597764912</double>
            <double>59.149764912</double>
            <double>NaN</double>
          </ParticleSizeClay>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>42</double>
            <double>14</double>
            <double>7</double>
            <double>7</double>
            <double>0</double>
            <double>0</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.1925</double>
            <double>0.3855</double>
            <double>0.319</double>
            <double>0.2965</double>
            <double>0.269</double>
            <double>0.255</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Greenethorpe.rainfed.TOS1.Genesis">
    <metfile name="met">
      <filename>Greenethorpe.met</filename>
    </metfile>
    <clock>
      <start_date>29/04/2019</start_date>
      <end_date>25/01/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>30/04/2019</sow_date>
            <reset_date>29/04/2019</reset_date>
            <cultivar>Genesis</cultivar>
            <density>25</density>
            <soil>Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)</soil>
            <Irrigation_level>rainfed</Irrigation_level>
            <site>Greenethorpe</site>
            <tos>TOS1</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif

</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)">
        <RecordNumber>178</RecordNumber>
        <ASCOrder/>
        <ASCSubOrder/>
        <SoilType>Sandy loam </SoilType>
        <LocalName/>
        <Site>Greenethorpe</Site>
        <NearestTown>Greenethorpe</NearestTown>
        <Region>Central West Slopes and Plains</Region>
        <State>New South Wales</State>
        <Country>Australia</Country>
        <NaturalVegetation/>
        <ApsoilNumber>691</ApsoilNumber>
        <Latitude>-34.01972</Latitude>
        <Longitude>148.39261</Longitude>
        <LocationAccuracy> +/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>Data collected as part of the GRDC project ‘Training growers to manage soil water’ by CSIRO Sustainable Ecosystems in collaboration with farmers and Lachlan CMA</DataSource>
        <Comments>Classification based on partical size analysis.</Comments>
        <Water>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.48580542264753</double>
            <double>1.48548644338118</double>
            <double>1.53604465709729</double>
            <double>1.47304625199362</double>
            <double>1.62232854864434</double>
            <double>1.59237375099871</double>
          </BD>
          <AirDry>
            <double>0.05</double>
            <double>0.08</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </AirDry>
          <LL15>
            <double>0.1</double>
            <double>0.1</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </LL15>
          <DUL>
            <double>0.212928416447704</double>
            <double>0.205254328299839</double>
            <double>0.250328719742656</double>
            <double>0.296631845906788</double>
            <double>0.303413715125929</double>
            <double>0.319104244906146</double>
          </DUL>
          <SAT>
            <double>0.409318708434895</double>
            <double>0.409439077969366</double>
            <double>0.39036050675574</double>
            <double>0.414133489813728</double>
            <double>0.357800547681382</double>
            <double>0.369104244906146</double>
          </SAT>
          <SoilCrop name="wheat">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="barley">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.05</double>
              <double>0.05</double>
              <double>0.03</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="oats">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
          <SoilCrop name="canola">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2</WinterCona>
          <WinterU>2</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>88</DiffusConst>
          <DiffusSlope>35</DiffusSlope>
          <Salb>0.13</Salb>
          <CN2Bare>68</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.5</double>
            <double>0.5</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.95545515394913</double>
            <double>0.34206827309237</double>
            <double>0.172858099062918</double>
            <double>0.04595046854083</double>
            <double>0.04595046854083</double>
            <double>0.0459505</double>
          </OC>
          <OCMetadata>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.5</double>
            <double>0.7</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <Texture>
            <string>Sandy loam</string>
            <string>Sandy clay loam</string>
            <string>Sandy clay</string>
            <string>Heavy clay</string>
            <string>Heavy clay</string>
            <string/>
          </Texture>
          <EC>
            <double>0.051</double>
            <double>0.052</double>
            <double>0.033</double>
            <double>0.054</double>
            <double>0.039</double>
            <double>NaN</double>
          </EC>
          <PH>
            <double>4.9</double>
            <double>5.3</double>
            <double>6</double>
            <double>6.4</double>
            <double>6.4</double>
            <double>6.4</double>
          </PH>
          <PHMetadata>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <CL>
            <double>14.7715151515151</double>
            <double>14.7715151515151</double>
            <double>9.62707070707071</double>
            <double>17.4146464646465</double>
            <double>9.62707070707071</double>
            <double>NaN</double>
          </CL>
          <Boron>
            <double>0.603846967220306</double>
            <double>0.594115257263184</double>
            <double>0.649315655231476</double>
            <double>0.862612664699554</double>
            <double>1.26479303836823</double>
            <double>NaN</double>
          </Boron>
          <CEC>
            <double>5.39634633436799</double>
            <double>6.99875513091683</double>
            <double>8.67176376655698</double>
            <double>14.0939270183444</double>
            <double>14.0319516956806</double>
            <double>NaN</double>
          </CEC>
          <Ca>
            <double>3.92466855049133</double>
            <double>5.52656364440918</double>
            <double>6.10458183288574</double>
            <double>8.60516834259033</double>
            <double>8.16468906402588</double>
            <double>NaN</double>
          </Ca>
          <Mg>
            <double>0.518550574779511</double>
            <double>0.987762272357941</double>
            <double>2.07717967033386</double>
            <double>4.75020360946655</double>
            <double>4.96332788467407</double>
            <double>NaN</double>
          </Mg>
          <Na>
            <double>0.0558853186666965</double>
            <double>0.0399000681936741</double>
            <double>0.0451155491173267</double>
            <double>0.0929039046168327</double>
            <double>0.11166724562645</double>
            <double>NaN</double>
          </Na>
          <K>
            <double>0.89724189043045</double>
            <double>0.444529145956039</double>
            <double>0.444886714220047</double>
            <double>0.645651161670685</double>
            <double>0.792267501354218</double>
            <double>NaN</double>
          </K>
          <ESP>
            <double>1.03561400999741</double>
            <double>0.57010236031</double>
            <double>0.520258050516975</double>
            <double>0.659176853235515</double>
            <double>0.795806941530618</double>
            <double>NaN</double>
          </ESP>
          <ParticleSizeSand>
            <double>74.8673428</double>
            <double>64.823956048</double>
            <double>52.991956048</double>
            <double>32.183956048</double>
            <double>35.447956048</double>
            <double>NaN</double>
          </ParticleSizeSand>
          <ParticleSizeSilt>
            <double>5.92687319</double>
            <double>9.89027904</double>
            <double>8.66627904</double>
            <double>6.21827904000001</double>
            <double>5.40227903</double>
            <double>NaN</double>
          </ParticleSizeSilt>
          <ParticleSizeClay>
            <double>19.205784</double>
            <double>25.285764912</double>
            <double>38.341764912</double>
            <double>61.597764912</double>
            <double>59.149764912</double>
            <double>NaN</double>
          </ParticleSizeClay>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>42</double>
            <double>14</double>
            <double>7</double>
            <double>7</double>
            <double>0</double>
            <double>0</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.1925</double>
            <double>0.3855</double>
            <double>0.319</double>
            <double>0.2965</double>
            <double>0.269</double>
            <double>0.255</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Greenethorpe.rainfed.TOS1.HatTrick">
    <metfile name="met">
      <filename>Greenethorpe.met</filename>
    </metfile>
    <clock>
      <start_date>29/04/2019</start_date>
      <end_date>25/01/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>30/04/2019</sow_date>
            <reset_date>29/04/2019</reset_date>
            <cultivar>HatTrick</cultivar>
            <density>25</density>
            <soil>Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)</soil>
            <Irrigation_level>rainfed</Irrigation_level>
            <site>Greenethorpe</site>
            <tos>TOS1</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif

</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)">
        <RecordNumber>178</RecordNumber>
        <ASCOrder/>
        <ASCSubOrder/>
        <SoilType>Sandy loam </SoilType>
        <LocalName/>
        <Site>Greenethorpe</Site>
        <NearestTown>Greenethorpe</NearestTown>
        <Region>Central West Slopes and Plains</Region>
        <State>New South Wales</State>
        <Country>Australia</Country>
        <NaturalVegetation/>
        <ApsoilNumber>691</ApsoilNumber>
        <Latitude>-34.01972</Latitude>
        <Longitude>148.39261</Longitude>
        <LocationAccuracy> +/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>Data collected as part of the GRDC project ‘Training growers to manage soil water’ by CSIRO Sustainable Ecosystems in collaboration with farmers and Lachlan CMA</DataSource>
        <Comments>Classification based on partical size analysis.</Comments>
        <Water>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.48580542264753</double>
            <double>1.48548644338118</double>
            <double>1.53604465709729</double>
            <double>1.47304625199362</double>
            <double>1.62232854864434</double>
            <double>1.59237375099871</double>
          </BD>
          <AirDry>
            <double>0.05</double>
            <double>0.08</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </AirDry>
          <LL15>
            <double>0.1</double>
            <double>0.1</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </LL15>
          <DUL>
            <double>0.212928416447704</double>
            <double>0.205254328299839</double>
            <double>0.250328719742656</double>
            <double>0.296631845906788</double>
            <double>0.303413715125929</double>
            <double>0.319104244906146</double>
          </DUL>
          <SAT>
            <double>0.409318708434895</double>
            <double>0.409439077969366</double>
            <double>0.39036050675574</double>
            <double>0.414133489813728</double>
            <double>0.357800547681382</double>
            <double>0.369104244906146</double>
          </SAT>
          <SoilCrop name="wheat">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="barley">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.05</double>
              <double>0.05</double>
              <double>0.03</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="oats">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
          <SoilCrop name="canola">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2</WinterCona>
          <WinterU>2</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>88</DiffusConst>
          <DiffusSlope>35</DiffusSlope>
          <Salb>0.13</Salb>
          <CN2Bare>68</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.5</double>
            <double>0.5</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.95545515394913</double>
            <double>0.34206827309237</double>
            <double>0.172858099062918</double>
            <double>0.04595046854083</double>
            <double>0.04595046854083</double>
            <double>0.0459505</double>
          </OC>
          <OCMetadata>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.5</double>
            <double>0.7</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <Texture>
            <string>Sandy loam</string>
            <string>Sandy clay loam</string>
            <string>Sandy clay</string>
            <string>Heavy clay</string>
            <string>Heavy clay</string>
            <string/>
          </Texture>
          <EC>
            <double>0.051</double>
            <double>0.052</double>
            <double>0.033</double>
            <double>0.054</double>
            <double>0.039</double>
            <double>NaN</double>
          </EC>
          <PH>
            <double>4.9</double>
            <double>5.3</double>
            <double>6</double>
            <double>6.4</double>
            <double>6.4</double>
            <double>6.4</double>
          </PH>
          <PHMetadata>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <CL>
            <double>14.7715151515151</double>
            <double>14.7715151515151</double>
            <double>9.62707070707071</double>
            <double>17.4146464646465</double>
            <double>9.62707070707071</double>
            <double>NaN</double>
          </CL>
          <Boron>
            <double>0.603846967220306</double>
            <double>0.594115257263184</double>
            <double>0.649315655231476</double>
            <double>0.862612664699554</double>
            <double>1.26479303836823</double>
            <double>NaN</double>
          </Boron>
          <CEC>
            <double>5.39634633436799</double>
            <double>6.99875513091683</double>
            <double>8.67176376655698</double>
            <double>14.0939270183444</double>
            <double>14.0319516956806</double>
            <double>NaN</double>
          </CEC>
          <Ca>
            <double>3.92466855049133</double>
            <double>5.52656364440918</double>
            <double>6.10458183288574</double>
            <double>8.60516834259033</double>
            <double>8.16468906402588</double>
            <double>NaN</double>
          </Ca>
          <Mg>
            <double>0.518550574779511</double>
            <double>0.987762272357941</double>
            <double>2.07717967033386</double>
            <double>4.75020360946655</double>
            <double>4.96332788467407</double>
            <double>NaN</double>
          </Mg>
          <Na>
            <double>0.0558853186666965</double>
            <double>0.0399000681936741</double>
            <double>0.0451155491173267</double>
            <double>0.0929039046168327</double>
            <double>0.11166724562645</double>
            <double>NaN</double>
          </Na>
          <K>
            <double>0.89724189043045</double>
            <double>0.444529145956039</double>
            <double>0.444886714220047</double>
            <double>0.645651161670685</double>
            <double>0.792267501354218</double>
            <double>NaN</double>
          </K>
          <ESP>
            <double>1.03561400999741</double>
            <double>0.57010236031</double>
            <double>0.520258050516975</double>
            <double>0.659176853235515</double>
            <double>0.795806941530618</double>
            <double>NaN</double>
          </ESP>
          <ParticleSizeSand>
            <double>74.8673428</double>
            <double>64.823956048</double>
            <double>52.991956048</double>
            <double>32.183956048</double>
            <double>35.447956048</double>
            <double>NaN</double>
          </ParticleSizeSand>
          <ParticleSizeSilt>
            <double>5.92687319</double>
            <double>9.89027904</double>
            <double>8.66627904</double>
            <double>6.21827904000001</double>
            <double>5.40227903</double>
            <double>NaN</double>
          </ParticleSizeSilt>
          <ParticleSizeClay>
            <double>19.205784</double>
            <double>25.285764912</double>
            <double>38.341764912</double>
            <double>61.597764912</double>
            <double>59.149764912</double>
            <double>NaN</double>
          </ParticleSizeClay>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>42</double>
            <double>14</double>
            <double>7</double>
            <double>7</double>
            <double>0</double>
            <double>0</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.1925</double>
            <double>0.3855</double>
            <double>0.319</double>
            <double>0.2965</double>
            <double>0.269</double>
            <double>0.255</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Greenethorpe.rainfed.TOS2.Genesis">
    <metfile name="met">
      <filename>Greenethorpe.met</filename>
    </metfile>
    <clock>
      <start_date>29/04/2019</start_date>
      <end_date>25/01/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>21/05/2019</sow_date>
            <reset_date>29/04/2019</reset_date>
            <cultivar>Genesis</cultivar>
            <density>25</density>
            <soil>Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)</soil>
            <Irrigation_level>rainfed</Irrigation_level>
            <site>Greenethorpe</site>
            <tos>TOS2</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif

</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)">
        <RecordNumber>178</RecordNumber>
        <ASCOrder/>
        <ASCSubOrder/>
        <SoilType>Sandy loam </SoilType>
        <LocalName/>
        <Site>Greenethorpe</Site>
        <NearestTown>Greenethorpe</NearestTown>
        <Region>Central West Slopes and Plains</Region>
        <State>New South Wales</State>
        <Country>Australia</Country>
        <NaturalVegetation/>
        <ApsoilNumber>691</ApsoilNumber>
        <Latitude>-34.01972</Latitude>
        <Longitude>148.39261</Longitude>
        <LocationAccuracy> +/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>Data collected as part of the GRDC project ‘Training growers to manage soil water’ by CSIRO Sustainable Ecosystems in collaboration with farmers and Lachlan CMA</DataSource>
        <Comments>Classification based on partical size analysis.</Comments>
        <Water>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.48580542264753</double>
            <double>1.48548644338118</double>
            <double>1.53604465709729</double>
            <double>1.47304625199362</double>
            <double>1.62232854864434</double>
            <double>1.59237375099871</double>
          </BD>
          <AirDry>
            <double>0.05</double>
            <double>0.08</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </AirDry>
          <LL15>
            <double>0.1</double>
            <double>0.1</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </LL15>
          <DUL>
            <double>0.212928416447704</double>
            <double>0.205254328299839</double>
            <double>0.250328719742656</double>
            <double>0.296631845906788</double>
            <double>0.303413715125929</double>
            <double>0.319104244906146</double>
          </DUL>
          <SAT>
            <double>0.409318708434895</double>
            <double>0.409439077969366</double>
            <double>0.39036050675574</double>
            <double>0.414133489813728</double>
            <double>0.357800547681382</double>
            <double>0.369104244906146</double>
          </SAT>
          <SoilCrop name="wheat">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="barley">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.05</double>
              <double>0.05</double>
              <double>0.03</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="oats">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
          <SoilCrop name="canola">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2</WinterCona>
          <WinterU>2</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>88</DiffusConst>
          <DiffusSlope>35</DiffusSlope>
          <Salb>0.13</Salb>
          <CN2Bare>68</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.5</double>
            <double>0.5</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.95545515394913</double>
            <double>0.34206827309237</double>
            <double>0.172858099062918</double>
            <double>0.04595046854083</double>
            <double>0.04595046854083</double>
            <double>0.0459505</double>
          </OC>
          <OCMetadata>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.5</double>
            <double>0.7</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <Texture>
            <string>Sandy loam</string>
            <string>Sandy clay loam</string>
            <string>Sandy clay</string>
            <string>Heavy clay</string>
            <string>Heavy clay</string>
            <string/>
          </Texture>
          <EC>
            <double>0.051</double>
            <double>0.052</double>
            <double>0.033</double>
            <double>0.054</double>
            <double>0.039</double>
            <double>NaN</double>
          </EC>
          <PH>
            <double>4.9</double>
            <double>5.3</double>
            <double>6</double>
            <double>6.4</double>
            <double>6.4</double>
            <double>6.4</double>
          </PH>
          <PHMetadata>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <CL>
            <double>14.7715151515151</double>
            <double>14.7715151515151</double>
            <double>9.62707070707071</double>
            <double>17.4146464646465</double>
            <double>9.62707070707071</double>
            <double>NaN</double>
          </CL>
          <Boron>
            <double>0.603846967220306</double>
            <double>0.594115257263184</double>
            <double>0.649315655231476</double>
            <double>0.862612664699554</double>
            <double>1.26479303836823</double>
            <double>NaN</double>
          </Boron>
          <CEC>
            <double>5.39634633436799</double>
            <double>6.99875513091683</double>
            <double>8.67176376655698</double>
            <double>14.0939270183444</double>
            <double>14.0319516956806</double>
            <double>NaN</double>
          </CEC>
          <Ca>
            <double>3.92466855049133</double>
            <double>5.52656364440918</double>
            <double>6.10458183288574</double>
            <double>8.60516834259033</double>
            <double>8.16468906402588</double>
            <double>NaN</double>
          </Ca>
          <Mg>
            <double>0.518550574779511</double>
            <double>0.987762272357941</double>
            <double>2.07717967033386</double>
            <double>4.75020360946655</double>
            <double>4.96332788467407</double>
            <double>NaN</double>
          </Mg>
          <Na>
            <double>0.0558853186666965</double>
            <double>0.0399000681936741</double>
            <double>0.0451155491173267</double>
            <double>0.0929039046168327</double>
            <double>0.11166724562645</double>
            <double>NaN</double>
          </Na>
          <K>
            <double>0.89724189043045</double>
            <double>0.444529145956039</double>
            <double>0.444886714220047</double>
            <double>0.645651161670685</double>
            <double>0.792267501354218</double>
            <double>NaN</double>
          </K>
          <ESP>
            <double>1.03561400999741</double>
            <double>0.57010236031</double>
            <double>0.520258050516975</double>
            <double>0.659176853235515</double>
            <double>0.795806941530618</double>
            <double>NaN</double>
          </ESP>
          <ParticleSizeSand>
            <double>74.8673428</double>
            <double>64.823956048</double>
            <double>52.991956048</double>
            <double>32.183956048</double>
            <double>35.447956048</double>
            <double>NaN</double>
          </ParticleSizeSand>
          <ParticleSizeSilt>
            <double>5.92687319</double>
            <double>9.89027904</double>
            <double>8.66627904</double>
            <double>6.21827904000001</double>
            <double>5.40227903</double>
            <double>NaN</double>
          </ParticleSizeSilt>
          <ParticleSizeClay>
            <double>19.205784</double>
            <double>25.285764912</double>
            <double>38.341764912</double>
            <double>61.597764912</double>
            <double>59.149764912</double>
            <double>NaN</double>
          </ParticleSizeClay>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>42</double>
            <double>14</double>
            <double>7</double>
            <double>7</double>
            <double>0</double>
            <double>0</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.1925</double>
            <double>0.3855</double>
            <double>0.319</double>
            <double>0.2965</double>
            <double>0.269</double>
            <double>0.255</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Greenethorpe.rainfed.TOS2.HatTrick">
    <metfile name="met">
      <filename>Greenethorpe.met</filename>
    </metfile>
    <clock>
      <start_date>29/04/2019</start_date>
      <end_date>25/01/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>21/05/2019</sow_date>
            <reset_date>29/04/2019</reset_date>
            <cultivar>HatTrick</cultivar>
            <density>25</density>
            <soil>Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)</soil>
            <Irrigation_level>rainfed</Irrigation_level>
            <site>Greenethorpe</site>
            <tos>TOS2</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif

</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)">
        <RecordNumber>178</RecordNumber>
        <ASCOrder/>
        <ASCSubOrder/>
        <SoilType>Sandy loam </SoilType>
        <LocalName/>
        <Site>Greenethorpe</Site>
        <NearestTown>Greenethorpe</NearestTown>
        <Region>Central West Slopes and Plains</Region>
        <State>New South Wales</State>
        <Country>Australia</Country>
        <NaturalVegetation/>
        <ApsoilNumber>691</ApsoilNumber>
        <Latitude>-34.01972</Latitude>
        <Longitude>148.39261</Longitude>
        <LocationAccuracy> +/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>Data collected as part of the GRDC project ‘Training growers to manage soil water’ by CSIRO Sustainable Ecosystems in collaboration with farmers and Lachlan CMA</DataSource>
        <Comments>Classification based on partical size analysis.</Comments>
        <Water>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.48580542264753</double>
            <double>1.48548644338118</double>
            <double>1.53604465709729</double>
            <double>1.47304625199362</double>
            <double>1.62232854864434</double>
            <double>1.59237375099871</double>
          </BD>
          <AirDry>
            <double>0.05</double>
            <double>0.08</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </AirDry>
          <LL15>
            <double>0.1</double>
            <double>0.1</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </LL15>
          <DUL>
            <double>0.212928416447704</double>
            <double>0.205254328299839</double>
            <double>0.250328719742656</double>
            <double>0.296631845906788</double>
            <double>0.303413715125929</double>
            <double>0.319104244906146</double>
          </DUL>
          <SAT>
            <double>0.409318708434895</double>
            <double>0.409439077969366</double>
            <double>0.39036050675574</double>
            <double>0.414133489813728</double>
            <double>0.357800547681382</double>
            <double>0.369104244906146</double>
          </SAT>
          <SoilCrop name="wheat">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="barley">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.05</double>
              <double>0.05</double>
              <double>0.03</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="oats">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
          <SoilCrop name="canola">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2</WinterCona>
          <WinterU>2</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>88</DiffusConst>
          <DiffusSlope>35</DiffusSlope>
          <Salb>0.13</Salb>
          <CN2Bare>68</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.5</double>
            <double>0.5</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.95545515394913</double>
            <double>0.34206827309237</double>
            <double>0.172858099062918</double>
            <double>0.04595046854083</double>
            <double>0.04595046854083</double>
            <double>0.0459505</double>
          </OC>
          <OCMetadata>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.5</double>
            <double>0.7</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <Texture>
            <string>Sandy loam</string>
            <string>Sandy clay loam</string>
            <string>Sandy clay</string>
            <string>Heavy clay</string>
            <string>Heavy clay</string>
            <string/>
          </Texture>
          <EC>
            <double>0.051</double>
            <double>0.052</double>
            <double>0.033</double>
            <double>0.054</double>
            <double>0.039</double>
            <double>NaN</double>
          </EC>
          <PH>
            <double>4.9</double>
            <double>5.3</double>
            <double>6</double>
            <double>6.4</double>
            <double>6.4</double>
            <double>6.4</double>
          </PH>
          <PHMetadata>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <CL>
            <double>14.7715151515151</double>
            <double>14.7715151515151</double>
            <double>9.62707070707071</double>
            <double>17.4146464646465</double>
            <double>9.62707070707071</double>
            <double>NaN</double>
          </CL>
          <Boron>
            <double>0.603846967220306</double>
            <double>0.594115257263184</double>
            <double>0.649315655231476</double>
            <double>0.862612664699554</double>
            <double>1.26479303836823</double>
            <double>NaN</double>
          </Boron>
          <CEC>
            <double>5.39634633436799</double>
            <double>6.99875513091683</double>
            <double>8.67176376655698</double>
            <double>14.0939270183444</double>
            <double>14.0319516956806</double>
            <double>NaN</double>
          </CEC>
          <Ca>
            <double>3.92466855049133</double>
            <double>5.52656364440918</double>
            <double>6.10458183288574</double>
            <double>8.60516834259033</double>
            <double>8.16468906402588</double>
            <double>NaN</double>
          </Ca>
          <Mg>
            <double>0.518550574779511</double>
            <double>0.987762272357941</double>
            <double>2.07717967033386</double>
            <double>4.75020360946655</double>
            <double>4.96332788467407</double>
            <double>NaN</double>
          </Mg>
          <Na>
            <double>0.0558853186666965</double>
            <double>0.0399000681936741</double>
            <double>0.0451155491173267</double>
            <double>0.0929039046168327</double>
            <double>0.11166724562645</double>
            <double>NaN</double>
          </Na>
          <K>
            <double>0.89724189043045</double>
            <double>0.444529145956039</double>
            <double>0.444886714220047</double>
            <double>0.645651161670685</double>
            <double>0.792267501354218</double>
            <double>NaN</double>
          </K>
          <ESP>
            <double>1.03561400999741</double>
            <double>0.57010236031</double>
            <double>0.520258050516975</double>
            <double>0.659176853235515</double>
            <double>0.795806941530618</double>
            <double>NaN</double>
          </ESP>
          <ParticleSizeSand>
            <double>74.8673428</double>
            <double>64.823956048</double>
            <double>52.991956048</double>
            <double>32.183956048</double>
            <double>35.447956048</double>
            <double>NaN</double>
          </ParticleSizeSand>
          <ParticleSizeSilt>
            <double>5.92687319</double>
            <double>9.89027904</double>
            <double>8.66627904</double>
            <double>6.21827904000001</double>
            <double>5.40227903</double>
            <double>NaN</double>
          </ParticleSizeSilt>
          <ParticleSizeClay>
            <double>19.205784</double>
            <double>25.285764912</double>
            <double>38.341764912</double>
            <double>61.597764912</double>
            <double>59.149764912</double>
            <double>NaN</double>
          </ParticleSizeClay>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>42</double>
            <double>14</double>
            <double>7</double>
            <double>7</double>
            <double>0</double>
            <double>0</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.1925</double>
            <double>0.3855</double>
            <double>0.319</double>
            <double>0.2965</double>
            <double>0.269</double>
            <double>0.255</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Greenethorpe.rainfed.TOS3.Genesis">
    <metfile name="met">
      <filename>Greenethorpe.met</filename>
    </metfile>
    <clock>
      <start_date>29/04/2019</start_date>
      <end_date>25/01/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>11/06/2019</sow_date>
            <reset_date>29/04/2019</reset_date>
            <cultivar>Genesis</cultivar>
            <density>25</density>
            <soil>Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)</soil>
            <Irrigation_level>rainfed</Irrigation_level>
            <site>Greenethorpe</site>
            <tos>TOS3</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif

</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)">
        <RecordNumber>178</RecordNumber>
        <ASCOrder/>
        <ASCSubOrder/>
        <SoilType>Sandy loam </SoilType>
        <LocalName/>
        <Site>Greenethorpe</Site>
        <NearestTown>Greenethorpe</NearestTown>
        <Region>Central West Slopes and Plains</Region>
        <State>New South Wales</State>
        <Country>Australia</Country>
        <NaturalVegetation/>
        <ApsoilNumber>691</ApsoilNumber>
        <Latitude>-34.01972</Latitude>
        <Longitude>148.39261</Longitude>
        <LocationAccuracy> +/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>Data collected as part of the GRDC project ‘Training growers to manage soil water’ by CSIRO Sustainable Ecosystems in collaboration with farmers and Lachlan CMA</DataSource>
        <Comments>Classification based on partical size analysis.</Comments>
        <Water>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.48580542264753</double>
            <double>1.48548644338118</double>
            <double>1.53604465709729</double>
            <double>1.47304625199362</double>
            <double>1.62232854864434</double>
            <double>1.59237375099871</double>
          </BD>
          <AirDry>
            <double>0.05</double>
            <double>0.08</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </AirDry>
          <LL15>
            <double>0.1</double>
            <double>0.1</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </LL15>
          <DUL>
            <double>0.212928416447704</double>
            <double>0.205254328299839</double>
            <double>0.250328719742656</double>
            <double>0.296631845906788</double>
            <double>0.303413715125929</double>
            <double>0.319104244906146</double>
          </DUL>
          <SAT>
            <double>0.409318708434895</double>
            <double>0.409439077969366</double>
            <double>0.39036050675574</double>
            <double>0.414133489813728</double>
            <double>0.357800547681382</double>
            <double>0.369104244906146</double>
          </SAT>
          <SoilCrop name="wheat">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="barley">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.05</double>
              <double>0.05</double>
              <double>0.03</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="oats">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
          <SoilCrop name="canola">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2</WinterCona>
          <WinterU>2</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>88</DiffusConst>
          <DiffusSlope>35</DiffusSlope>
          <Salb>0.13</Salb>
          <CN2Bare>68</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.5</double>
            <double>0.5</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.95545515394913</double>
            <double>0.34206827309237</double>
            <double>0.172858099062918</double>
            <double>0.04595046854083</double>
            <double>0.04595046854083</double>
            <double>0.0459505</double>
          </OC>
          <OCMetadata>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.5</double>
            <double>0.7</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <Texture>
            <string>Sandy loam</string>
            <string>Sandy clay loam</string>
            <string>Sandy clay</string>
            <string>Heavy clay</string>
            <string>Heavy clay</string>
            <string/>
          </Texture>
          <EC>
            <double>0.051</double>
            <double>0.052</double>
            <double>0.033</double>
            <double>0.054</double>
            <double>0.039</double>
            <double>NaN</double>
          </EC>
          <PH>
            <double>4.9</double>
            <double>5.3</double>
            <double>6</double>
            <double>6.4</double>
            <double>6.4</double>
            <double>6.4</double>
          </PH>
          <PHMetadata>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <CL>
            <double>14.7715151515151</double>
            <double>14.7715151515151</double>
            <double>9.62707070707071</double>
            <double>17.4146464646465</double>
            <double>9.62707070707071</double>
            <double>NaN</double>
          </CL>
          <Boron>
            <double>0.603846967220306</double>
            <double>0.594115257263184</double>
            <double>0.649315655231476</double>
            <double>0.862612664699554</double>
            <double>1.26479303836823</double>
            <double>NaN</double>
          </Boron>
          <CEC>
            <double>5.39634633436799</double>
            <double>6.99875513091683</double>
            <double>8.67176376655698</double>
            <double>14.0939270183444</double>
            <double>14.0319516956806</double>
            <double>NaN</double>
          </CEC>
          <Ca>
            <double>3.92466855049133</double>
            <double>5.52656364440918</double>
            <double>6.10458183288574</double>
            <double>8.60516834259033</double>
            <double>8.16468906402588</double>
            <double>NaN</double>
          </Ca>
          <Mg>
            <double>0.518550574779511</double>
            <double>0.987762272357941</double>
            <double>2.07717967033386</double>
            <double>4.75020360946655</double>
            <double>4.96332788467407</double>
            <double>NaN</double>
          </Mg>
          <Na>
            <double>0.0558853186666965</double>
            <double>0.0399000681936741</double>
            <double>0.0451155491173267</double>
            <double>0.0929039046168327</double>
            <double>0.11166724562645</double>
            <double>NaN</double>
          </Na>
          <K>
            <double>0.89724189043045</double>
            <double>0.444529145956039</double>
            <double>0.444886714220047</double>
            <double>0.645651161670685</double>
            <double>0.792267501354218</double>
            <double>NaN</double>
          </K>
          <ESP>
            <double>1.03561400999741</double>
            <double>0.57010236031</double>
            <double>0.520258050516975</double>
            <double>0.659176853235515</double>
            <double>0.795806941530618</double>
            <double>NaN</double>
          </ESP>
          <ParticleSizeSand>
            <double>74.8673428</double>
            <double>64.823956048</double>
            <double>52.991956048</double>
            <double>32.183956048</double>
            <double>35.447956048</double>
            <double>NaN</double>
          </ParticleSizeSand>
          <ParticleSizeSilt>
            <double>5.92687319</double>
            <double>9.89027904</double>
            <double>8.66627904</double>
            <double>6.21827904000001</double>
            <double>5.40227903</double>
            <double>NaN</double>
          </ParticleSizeSilt>
          <ParticleSizeClay>
            <double>19.205784</double>
            <double>25.285764912</double>
            <double>38.341764912</double>
            <double>61.597764912</double>
            <double>59.149764912</double>
            <double>NaN</double>
          </ParticleSizeClay>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>42</double>
            <double>14</double>
            <double>7</double>
            <double>7</double>
            <double>0</double>
            <double>0</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.1925</double>
            <double>0.3855</double>
            <double>0.319</double>
            <double>0.2965</double>
            <double>0.269</double>
            <double>0.255</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
  <simulation name="Greenethorpe.rainfed.TOS3.HatTrick">
    <metfile name="met">
      <filename>Greenethorpe.met</filename>
    </metfile>
    <clock>
      <start_date>29/04/2019</start_date>
      <end_date>25/01/2020</end_date>
    </clock>
    <summaryfile/>
    <area name="paddock">
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">50</mass>
        <cnr type="text" description="C:N ratio of initial residue">60</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser/>
      <irrigation name="Irrigation">
        <automatic_irrigation type="list" listvalues="on,off" description="Automatic irrigation">off</automatic_irrigation>
        <asw_depth type="text" description="Depth to which ASW is calculated. (mm)">600</asw_depth>
        <crit_fr_asw type="text" description="Fraction of ASW below which irrigation is applied (0-1.0)">0.5</crit_fr_asw>
        <irrigation_efficiency type="text" description="Efficiency of the irrigation. (0-1.0)">1</irrigation_efficiency>
        <irrigation_allocation type="list" listvalues="on,off" description="Allocation limits">off</irrigation_allocation>
        <allocation type="text" description="Allocation in mm">0</allocation>
        <default_no3_conc type="text" description="Nitrate concentration (ppm N)">0.0</default_no3_conc>
        <default_nh4_conc type="text" description="Ammonium concentration (ppm N)">0.0</default_nh4_conc>
        <default_cl_conc type="text" description="Chloride concentration (ppm Cl)">0.0</default_cl_conc>
      </irrigation>
      <chickpea />
      <folder name="Manager folder">
        <manager name="Rules">
          <ui>
            <sow_date>11/06/2019</sow_date>
            <reset_date>29/04/2019</reset_date>
            <cultivar>HatTrick</cultivar>
            <density>25</density>
            <soil>Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)</soil>
            <Irrigation_level>rainfed</Irrigation_level>
            <site>Greenethorpe</site>
            <tos>TOS3</tos>
          </ui>
          <script>
            <text>!rule name 
under_crop = 0 ! 0: no crop in field; 1: field is cropped

sow_day = '[sow_date]'
TOS = '[TOS]'
cultivar = '[cultivar]'
density = '[density]'
site = '[site]'
Irrigation_level = '[Irrigation_level]'
MaxLAI = 0

</text>
            <event>init</event>
          </script>
          <script>
            <text>! finds if there is a crop in the field, if 0 no crop if1 crop

if (under_crop &gt; 0 AND StageName = 'out') then
   under_crop = 0
endif


if (lai &gt; MaxLAI) then
   MaxLAI = lai
endif

if (Today = Date('[reset_date]')) then 
   '[soil] Water' reset
   '[soil] Nitrogen' reset
   'SurfaceOrganicMatter' reset
endif

if (Today = Date('[sow_date]')) then
   chickpea sow cultivar = '[cultivar]', plants = [density] (/m2), sowing_depth = 40 (mm)
   MaxLAI = 0
   under_crop = 1
endif

! if maturity harvest the crop
if (StageName = 'harvest_ripe') or (plant_status = 'dead') then
   act_mods harvest
   act_mods end_crop
endif

</text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>

if (under_crop &gt; 0) then
   'outputfile Daily' do_output
endif

            </text>
            <event>end_of_day</event>
          </script>
        </manager>
        <manager2 name="SW Calcs">
          <ui>
            <category type="category" description="Irrigation parameters"/>
          </ui>
          <text>using System;
using ModelFramework;
using CSGeneral;

public class Script 
{      
   [Input] DateTime today;
   
   [Link] Paddock Paddock;
   private double [] dlayer;
   private double [] dul_dep;
   private double [] ll15_dep;
   
   private ManagerUtility.Tracker&lt;double&gt; stressTracker; 

   [EventHandler] public void OnInitialised()
   {
      dlayer = new double[15];
      Paddock.Get("dlayer", out dlayer);
      ll15_dep = new double[15];
      Paddock.Get("ll15_dep", out ll15_dep);
      dul_dep = new double[15];
      Paddock.Get("dul_dep", out dul_dep);
      stressTracker = new ManagerUtility.Tracker&lt;double&gt;(5); 

   }
   [EventHandler] public void OnProcess()
   {
      double stress = 0;
      Paddock.Get("sw_stress_photo", out stress);
      stressTracker.Add(stress);
   }
   [Output] double stress_5 {
      get {
         return(stressTracker.Average());
      }
      set {
      }
   }
   // Return the fraction of this layer we include in 
   private double LayerFrac (int layer, double max_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt; max_depth)
         return 1.0;
      if (cum_depth - dlayer[layer] &lt; max_depth)
         return((max_depth - (cum_depth - dlayer[layer])) / dlayer[layer]);
      return 0.0;
   }
   private double TopLayerFrac (int layer, double min_depth) {
      double cum_depth = 0;
      for(int i = 0; i &lt;= layer; i++)
         cum_depth += dlayer[i];
      if (cum_depth &lt;= min_depth)
         return 0.0;
      if (cum_depth - min_depth  &lt; dlayer[layer] )
         return((cum_depth - min_depth) / dlayer[layer]);
      return 1.0;
   }
   //ESW calculated to 600mm
   [Output] double esw_0_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated between 100 &amp; 600mm
   [Output] double esw_100_600 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         double s = 0;
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 600.0) * TopLayerFrac(i, 100);
            s += dlayer[i];
            //Console.WriteLine("1-6 L" + i.ToString() + " " + s + " = " + TopLayerFrac(i, 100) + ", " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }

   //ESW calculated to 1200mm
   [Output] double esw_1200 {
      get {
         double[] sw_dep = new double[15];
         Paddock.Get("sw_dep", out sw_dep);
         
         // relative to LL15
         double[] SW = new double[sw_dep.Length]; //double s = 0;
         for (int i = 0; i &lt; sw_dep.Length; i++) {
            SW[i] = Math.Max(0.0, sw_dep[i] - ll15_dep[i]) * LayerFrac(i, 1200.0);
            //s += dlayer[i];
            //Console.WriteLine("L" + i.ToString() + " " + s + " = " + LayerFrac(i, 600.0));
         }
         return(MathUtility.Sum(SW));
      }
      set {}
   }
}
   </text>
        </manager2>
      </folder>
      <outputfile name="outputfile Daily">
        <filename output="yes">base outputfile Daily.out</filename>
        <title>base outputfile Daily</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>StageName</variable>
          <variable>DaysAfterSowing</variable>
          <variable>lai</variable>
          <variable>leaf_no</variable>
          <variable>node_no</variable>
          <variable>leaves_per_node</variable>
          <variable>yield as Yield</variable>
          <variable>biomass as Biomass</variable>
          <variable>leafTotalWt</variable>
          <variable>leafGreenWt</variable>
          <variable>leafSenescedWt</variable>
          <variable>grainTotalWt</variable>
          <variable>podTotalWt</variable>
          <variable>stemTotalWt</variable>
          <variable>root_depth</variable>
          <variable>sw</variable>
          <variable>esw_layr as esw</variable>
          <variable>esw_100_600</variable>
          <variable>esw_0_600</variable>
          <variable>stress_5</variable>
          <variable>TT</variable>
          <variable>TTAfterStart_Grain_fill</variable>
          <variable>site</variable>
          <variable>cultivar</variable>
          <variable>Irrigation_level</variable>
          <variable>tos as TOS</variable>
        </variables>
        <events name="Reporting Frequency"/>
      </outputfile>
      <outputfile name="outputfile Harvest">
        <filename output="yes">base outputfile Harvest.out</filename>
        <title>base outputfile Harvest</title>
        <variables name="Variables">
          <variable>dd/mm/yyyy as HarvestDate</variable>
          <variable>sow_day as SowDate</variable>
          <variable>yield</variable>
          <variable>biomass</variable>
          <variable>root_depth</variable>
          <variable>MaxLAI</variable>
          <variable>floral_initiation_das as BuddingDAS</variable>
          <variable>flowering_das as FloweringDAS</variable>
          <variable>start_grain_fill_das as PoddingDAS</variable>
          <variable>DaysAfterSowing as MaturityDAS</variable>
          <variable>Irrigation_level</variable>
          <variable>cultivar</variable>
          <variable>tos as TOS</variable>
          <variable>site</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>harvesting</event>
        </events>
      </outputfile>
      <Soil name="Sandy loam over a sandy clay and heavy clay (Greenethorpe No691)">
        <RecordNumber>178</RecordNumber>
        <ASCOrder/>
        <ASCSubOrder/>
        <SoilType>Sandy loam </SoilType>
        <LocalName/>
        <Site>Greenethorpe</Site>
        <NearestTown>Greenethorpe</NearestTown>
        <Region>Central West Slopes and Plains</Region>
        <State>New South Wales</State>
        <Country>Australia</Country>
        <NaturalVegetation/>
        <ApsoilNumber>691</ApsoilNumber>
        <Latitude>-34.01972</Latitude>
        <Longitude>148.39261</Longitude>
        <LocationAccuracy> +/- 20m</LocationAccuracy>
        <YearOfSampling>0</YearOfSampling>
        <DataSource>Data collected as part of the GRDC project ‘Training growers to manage soil water’ by CSIRO Sustainable Ecosystems in collaboration with farmers and Lachlan CMA</DataSource>
        <Comments>Classification based on partical size analysis.</Comments>
        <Water>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.48580542264753</double>
            <double>1.48548644338118</double>
            <double>1.53604465709729</double>
            <double>1.47304625199362</double>
            <double>1.62232854864434</double>
            <double>1.59237375099871</double>
          </BD>
          <AirDry>
            <double>0.05</double>
            <double>0.08</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </AirDry>
          <LL15>
            <double>0.1</double>
            <double>0.1</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
            <double>0.157621518984828</double>
          </LL15>
          <DUL>
            <double>0.212928416447704</double>
            <double>0.205254328299839</double>
            <double>0.250328719742656</double>
            <double>0.296631845906788</double>
            <double>0.303413715125929</double>
            <double>0.319104244906146</double>
          </DUL>
          <SAT>
            <double>0.409318708434895</double>
            <double>0.409439077969366</double>
            <double>0.39036050675574</double>
            <double>0.414133489813728</double>
            <double>0.357800547681382</double>
            <double>0.369104244906146</double>
          </SAT>
          <SoilCrop name="wheat">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="barley">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.07</double>
              <double>0.05</double>
              <double>0.05</double>
              <double>0.03</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="oats">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
          <SoilCrop name="canola">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.157621518984828</double>
              <double>0.218077631569724</double>
              <double>0.262428937167227</double>
              <double>0.28338854890655</double>
            </LL>
            <KL>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.04</double>
              <double>0.02</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
            <LLMetadata>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
              <string>Estimated based on local knowledge</string>
            </LLMetadata>
          </SoilCrop>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2</WinterCona>
          <WinterU>2</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>88</DiffusConst>
          <DiffusSlope>35</DiffusSlope>
          <Salb>0.13</Salb>
          <CN2Bare>68</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Slope>NaN</Slope>
          <DischargeWidth>NaN</DischargeWidth>
          <CatchmentArea>NaN</CatchmentArea>
          <MaxPond>NaN</MaxPond>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.5</double>
            <double>0.5</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>1000</RootWt>
          <SoilCN>12</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>0.95545515394913</double>
            <double>0.34206827309237</double>
            <double>0.172858099062918</double>
            <double>0.04595046854083</double>
            <double>0.04595046854083</double>
            <double>0.0459505</double>
          </OC>
          <OCMetadata>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
            <string>Measured</string>
          </OCMetadata>
          <FBiom>
            <double>0.04</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.02</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.5</double>
            <double>0.7</double>
            <double>1</double>
            <double>1</double>
            <double>1</double>
          </FInert>
          <OCUnits>WalkleyBlack</OCUnits>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <Texture>
            <string>Sandy loam</string>
            <string>Sandy clay loam</string>
            <string>Sandy clay</string>
            <string>Heavy clay</string>
            <string>Heavy clay</string>
            <string/>
          </Texture>
          <EC>
            <double>0.051</double>
            <double>0.052</double>
            <double>0.033</double>
            <double>0.054</double>
            <double>0.039</double>
            <double>NaN</double>
          </EC>
          <PH>
            <double>4.9</double>
            <double>5.3</double>
            <double>6</double>
            <double>6.4</double>
            <double>6.4</double>
            <double>6.4</double>
          </PH>
          <PHMetadata>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Unknown source or quality of data</string>
            <string>Estimated based on local knowledge</string>
          </PHMetadata>
          <CL>
            <double>14.7715151515151</double>
            <double>14.7715151515151</double>
            <double>9.62707070707071</double>
            <double>17.4146464646465</double>
            <double>9.62707070707071</double>
            <double>NaN</double>
          </CL>
          <Boron>
            <double>0.603846967220306</double>
            <double>0.594115257263184</double>
            <double>0.649315655231476</double>
            <double>0.862612664699554</double>
            <double>1.26479303836823</double>
            <double>NaN</double>
          </Boron>
          <CEC>
            <double>5.39634633436799</double>
            <double>6.99875513091683</double>
            <double>8.67176376655698</double>
            <double>14.0939270183444</double>
            <double>14.0319516956806</double>
            <double>NaN</double>
          </CEC>
          <Ca>
            <double>3.92466855049133</double>
            <double>5.52656364440918</double>
            <double>6.10458183288574</double>
            <double>8.60516834259033</double>
            <double>8.16468906402588</double>
            <double>NaN</double>
          </Ca>
          <Mg>
            <double>0.518550574779511</double>
            <double>0.987762272357941</double>
            <double>2.07717967033386</double>
            <double>4.75020360946655</double>
            <double>4.96332788467407</double>
            <double>NaN</double>
          </Mg>
          <Na>
            <double>0.0558853186666965</double>
            <double>0.0399000681936741</double>
            <double>0.0451155491173267</double>
            <double>0.0929039046168327</double>
            <double>0.11166724562645</double>
            <double>NaN</double>
          </Na>
          <K>
            <double>0.89724189043045</double>
            <double>0.444529145956039</double>
            <double>0.444886714220047</double>
            <double>0.645651161670685</double>
            <double>0.792267501354218</double>
            <double>NaN</double>
          </K>
          <ESP>
            <double>1.03561400999741</double>
            <double>0.57010236031</double>
            <double>0.520258050516975</double>
            <double>0.659176853235515</double>
            <double>0.795806941530618</double>
            <double>NaN</double>
          </ESP>
          <ParticleSizeSand>
            <double>74.8673428</double>
            <double>64.823956048</double>
            <double>52.991956048</double>
            <double>32.183956048</double>
            <double>35.447956048</double>
            <double>NaN</double>
          </ParticleSizeSand>
          <ParticleSizeSilt>
            <double>5.92687319</double>
            <double>9.89027904</double>
            <double>8.66627904</double>
            <double>6.21827904000001</double>
            <double>5.40227903</double>
            <double>NaN</double>
          </ParticleSizeSilt>
          <ParticleSizeClay>
            <double>19.205784</double>
            <double>25.285764912</double>
            <double>38.341764912</double>
            <double>61.597764912</double>
            <double>59.149764912</double>
            <double>NaN</double>
          </ParticleSizeClay>
          <PHUnits>Water</PHUnits>
          <BoronUnits>HotWater</BoronUnits>
        </Analysis>
        <Sample name="Initial Conditions">
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>42</double>
            <double>14</double>
            <double>7</double>
            <double>7</double>
            <double>0</double>
            <double>0</double>
          </NO3>
          <NH4>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
            <double>0</double>
          </NH4>
          <SW>
            <double>0.1925</double>
            <double>0.3855</double>
            <double>0.319</double>
            <double>0.2965</double>
            <double>0.269</double>
            <double>0.255</double>
          </SW>
          <NO3Units>kgha</NO3Units>
          <NH4Units>kgha</NH4Units>
          <SWUnits>Volumetric</SWUnits>
          <OCUnits>Total</OCUnits>
          <PHUnits>Water</PHUnits>
        </Sample>
      </Soil>
    </area>
  </simulation>
</folder>
