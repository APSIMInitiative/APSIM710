<folder version="27" name="simulations">
  <simulation name="Continuous Wheat">
    <memo>This simulation tests that the new manager module (in script in the paddock) can send a remove_crop_biomass event to a specific crop (lucernce).</memo>
    <metfile name="met">
      <filename name="filename">%apsim%\Examples\MetFiles\goond.met</filename>
    </metfile>
    <clock>
      <start_date type="date" description="Enter the start date of the simulation">1/01/1940</start_date>
      <end_date type="date" description="Enter the end date of the simulation">31/12/1940</end_date>
    </clock>
    <summaryfile>
      <filename name="filename">Continuous Wheat Simulation.sum</filename>
    </summaryfile>
    <area name="paddock">
      <surfaceom name="surface organic matter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">1000</mass>
        <cnr type="text" description="C:N ratio of initial residue">80</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser>
        <memo />
      </fertiliser>
      <folder name="Manager folder">
        <manager name="Sowing rule">
          <ui>
            <category type="category" description="Sowing criteria" />
            <date1 type="ddmmmdate" description="Enter sowing window START date (dd-mmm) : ">15-may</date1>
            <date2 type="ddmmmdate" description="Enter sowing window END date (dd-mmm) : ">10-jul</date2>
            <must_sow type="yesno" description="Must sow? : ">yes</must_sow>
            <raincrit type="text" description="Amount of rainfall : ">30</raincrit>
            <rainnumdays type="text" description="Number of days of rainfall : ">3</rainnumdays>
            <esw_amount type="text" description="Enter minimum allowable available soil water (mm) : ">200</esw_amount>
            <category type="category" description="Sowing parameters" />
            <crop type="crop" description="Enter name of crop to sow : ">lucerne</crop>
            <density type="text" description="Enter sowing density  (plants/m2) : ">100</density>
            <depth type="text" description="Enter sowing depth  (mm) : ">30</depth>
            <cultivar type="cultivars" description="Enter cultivar : ">aquarius</cultivar>
            <class type="classes" description="Enter crop growth class : ">plant</class>
            <row_spacing type="text" description="Enter row spacing (mm) : ">250</row_spacing>
          </ui>
          <script>
            <text>
      if (paddock_is_fallow() = 1 and FallowIn &lt;&gt; 'yes' and (NextCrop = 0 or NextCrop = '[crop]')) then
         if (date_within('[date1], [date2]') = 1) then
            if (rain[[rainnumdays]] &gt;= [raincrit] AND esw &gt;= [esw_amount]) OR
                ('[must_sow]' = 'yes' AND today = date('[date2]'))) THEN
               ChooseNextCrop = 'yes'   ! for rotations
               [crop] sow plants =[density], sowing_depth = [depth], cultivar = [cultivar], row_spacing = [row_spacing], crop_class = [class]
            endif
            if today = date('[date2]') then
               ChooseNextCrop = 'yes'
            endif
         endif
      endif
            </text>
            <event>start_of_day</event>
          </script>
          <script>
            <text>
            nextcrop = 0
            fallowin = 0
            </text>
            <event>init</event>
          </script>
        </manager>
      </folder>
      <outputfile>
        <variables name="Variables">
          <variable name="dd/mm/yyyy as Date" array="?" description="Date (dd/mm/yyyy)" />
          <variable name="biomass" array="?" description="Biomass" />
          <variable name="yield" array="?" description="Yield" />
          <variable name="grain_protein" array="?" description="grain protein content" />
          <variable name="grain_size" array="?" description="Size of each grain" />
          <variable name="esw" array="?" description="Extractable Soil Water (mm)" />
          <variable name="flowering_count" />
          <variable name="stagename" />
        </variables>
        <events name="Reporting Frequency">
          <event name="daily" />
        </events>
      </outputfile>
      <soil name="Soil">
        <Country>Australia</Country>
        <Site>Quorn</Site>
        <Region>Upper North</Region>
        <LocalName />
        <SoilType>Clay loam over medium clay</SoilType>
        <NearestTown>Quorn</NearestTown>
        <NaturalVegetation />
        <State>South Australia</State>
        <ApsoilNumber>605</ApsoilNumber>
        <Latitude>-32.321</Latitude>
        <Longitude>138.026</Longitude>
        <LocationAccuracy>+-20m</LocationAccuracy>
        <DataSource>Characterisation 2008 by University of Adelaide, CSIRO Sustainable Ecosystems and Rural Solutions Jamestown</DataSource>
        <Comments>LB code:QRN; Moderate-high clay strongly duplex soil with moderate bulk density, high CEC. Texture change at about 6cm depth. Impediment to root growth likely below about 50cm due to high ESP, EC and chloride. DM Description: 0-6cm Clay Loam 2.5YR 3/4;  6</Comments>
        <Water>
          <Layer>
            <Thickness units="mm">100</Thickness>
            <KS units="mm/day" />
            <BD units="g/cc">1.205</BD>
            <Airdry units="mm/mm">0.085</Airdry>
            <LL15 units="mm/mm">0.169</LL15>
            <DUL units="mm/mm">0.362</DUL>
            <SAT units="mm/mm">0.515</SAT>
          </Layer>
          <Layer>
            <Thickness>100</Thickness>
            <KS />
            <BD>1.335</BD>
            <Airdry>0.15</Airdry>
            <LL15>0.187</LL15>
            <DUL>0.355</DUL>
            <SAT>0.466</SAT>
          </Layer>
          <Layer>
            <Thickness>250</Thickness>
            <KS />
            <BD>1.338</BD>
            <Airdry>0.215</Airdry>
            <LL15>0.215</LL15>
            <DUL>0.347</DUL>
            <SAT>0.465</SAT>
          </Layer>
          <Layer>
            <Thickness>250</Thickness>
            <KS />
            <BD>1.396</BD>
            <Airdry>0.215</Airdry>
            <LL15>0.215</LL15>
            <DUL>0.393</DUL>
            <SAT>0.443</SAT>
          </Layer>
          <Layer>
            <Thickness>350</Thickness>
            <KS />
            <BD>1.405</BD>
            <Airdry>0.215</Airdry>
            <LL15>0.215</LL15>
            <DUL>0.39</DUL>
            <SAT>0.44</SAT>
          </Layer>
          <Layer>
            <Thickness>450</Thickness>
            <KS />
            <BD>1.396</BD>
            <Airdry>0.215</Airdry>
            <LL15>0.215</LL15>
            <DUL>0.393</DUL>
            <SAT>0.443</SAT>
          </Layer>
          <SoilCrop name="wheat">
            <Layer>
              <Thickness units="mm">100</Thickness>
              <ll units="mm/mm" code="FM">0.169</ll>
              <kl units="/day">0.06</kl>
              <xf units="0-1">1</xf>
            </Layer>
            <Layer>
              <Thickness>100</Thickness>
              <ll code="FM">0.187</ll>
              <kl>0.06</kl>
              <xf>1</xf>
            </Layer>
            <Layer>
              <Thickness>250</Thickness>
              <ll code="FM">0.215</ll>
              <kl>0.06</kl>
              <xf>1</xf>
            </Layer>
            <Layer>
              <Thickness>250</Thickness>
              <ll code="FM">0.246</ll>
              <kl>0.05</kl>
              <xf>1</xf>
            </Layer>
            <Layer>
              <Thickness>350</Thickness>
              <ll code="FM">0.292</ll>
              <kl>0.04</kl>
              <xf>1</xf>
            </Layer>
            <Layer>
              <Thickness>450</Thickness>
              <ll code="FM">0.354</ll>
              <kl>0.02</kl>
              <xf>1</xf>
            </Layer>
          </SoilCrop>
          <SoilCrop name="lucerne">
            <Layer>
              <Thickness units="mm">100</Thickness>
              <ll units="mm/mm" code="FM">0.169</ll>
              <kl units="/day">0.06</kl>
              <xf units="0-1">1</xf>
            </Layer>
            <Layer>
              <Thickness>100</Thickness>
              <ll code="FM">0.187</ll>
              <kl>0.06</kl>
              <xf>1</xf>
            </Layer>
            <Layer>
              <Thickness>250</Thickness>
              <ll code="FM">0.215</ll>
              <kl>0.06</kl>
              <xf>1</xf>
            </Layer>
            <Layer>
              <Thickness>250</Thickness>
              <ll code="FM">0.246</ll>
              <kl>0.05</kl>
              <xf>1</xf>
            </Layer>
            <Layer>
              <Thickness>350</Thickness>
              <ll code="FM">0.292</ll>
              <kl>0.04</kl>
              <xf>1</xf>
            </Layer>
            <Layer>
              <Thickness>450</Thickness>
              <ll code="FM">0.354</ll>
              <kl>0.02</kl>
              <xf>1</xf>
            </Layer>
          </SoilCrop>
        </Water>
        <Analysis>
          <Layer>
            <Thickness units="mm">100</Thickness>
            <Rocks units="%">0</Rocks>
            <Texture>Light Clay</Texture>
            <MunsellColour />
            <EC units="1:5 dS/m">0.3</EC>
            <PH units="1:5 water">8.3</PH>
            <CL units="mg/kg">184</CL>
            <Boron units="Hot CaCl2">1.6</Boron>
            <CEC units="cmol+/kg">34</CEC>
            <Ca units="cmol+/kg">26.3</Ca>
            <Mg units="cmol+/kg">4.9</Mg>
            <Na units="cmol+/kg">1.4</Na>
            <K units="cmol+/kg">1.4</K>
            <ESP units="%">4.2</ESP>
            <Mn units="mg/kg" />
            <Al units="cmol+/kg" />
            <ParticleSizeSand units="%">40.7</ParticleSizeSand>
            <ParticleSizeSilt units="%">13.5</ParticleSizeSilt>
            <ParticleSizeClay units="%">45.8</ParticleSizeClay>
          </Layer>
          <Layer>
            <Thickness>100</Thickness>
            <Rocks>0</Rocks>
            <Texture>Light Clay</Texture>
            <MunsellColour />
            <EC>0.3</EC>
            <PH>8.6</PH>
            <CL>255</CL>
            <Boron>1.4</Boron>
            <CEC>32.9</CEC>
            <Ca>23.8</Ca>
            <Mg>5.6</Mg>
            <Na>2.5</Na>
            <K>1</K>
            <ESP>7.7</ESP>
            <Mn />
            <Al />
            <ParticleSizeSand>40.7</ParticleSizeSand>
            <ParticleSizeSilt>12.6</ParticleSizeSilt>
            <ParticleSizeClay>46.6</ParticleSizeClay>
          </Layer>
          <Layer>
            <Thickness>250</Thickness>
            <Rocks>0</Rocks>
            <Texture>Medium Clay</Texture>
            <MunsellColour />
            <EC>0.7</EC>
            <PH>8.9</PH>
            <CL>724</CL>
            <Boron>3.2</Boron>
            <CEC>31.5</CEC>
            <Ca>17</Ca>
            <Mg>8</Mg>
            <Na>5.6</Na>
            <K>0.9</K>
            <ESP>17.8</ESP>
            <Mn />
            <Al />
            <ParticleSizeSand>32.7</ParticleSizeSand>
            <ParticleSizeSilt>13.1</ParticleSizeSilt>
            <ParticleSizeClay>54.2</ParticleSizeClay>
          </Layer>
          <Layer>
            <Thickness>250</Thickness>
            <Rocks>0</Rocks>
            <Texture>Heavy Clay</Texture>
            <MunsellColour />
            <EC>1.1</EC>
            <PH>9.1</PH>
            <CL>1073</CL>
            <Boron>15.9</Boron>
            <CEC>31.3</CEC>
            <Ca>12.2</Ca>
            <Mg>9.3</Mg>
            <Na>8.8</Na>
            <K>1</K>
            <ESP>28</ESP>
            <Mn />
            <Al />
            <ParticleSizeSand>29.1</ParticleSizeSand>
            <ParticleSizeSilt>12.7</ParticleSizeSilt>
            <ParticleSizeClay>58.3</ParticleSizeClay>
          </Layer>
          <Layer>
            <Thickness>350</Thickness>
            <Rocks>0</Rocks>
            <Texture>Heavy Clay</Texture>
            <MunsellColour />
            <EC>2</EC>
            <PH>8.8</PH>
            <CL>1583</CL>
            <Boron>23.1</Boron>
            <CEC>35</CEC>
            <Ca>13.4</Ca>
            <Mg>9.6</Mg>
            <Na>10.8</Na>
            <K>1.2</K>
            <ESP>31</ESP>
            <Mn />
            <Al />
            <ParticleSizeSand>27</ParticleSizeSand>
            <ParticleSizeSilt>11.7</ParticleSizeSilt>
            <ParticleSizeClay>61.2</ParticleSizeClay>
          </Layer>
          <Layer>
            <Thickness>450</Thickness>
            <Rocks>0</Rocks>
            <Texture>Heavy Clay</Texture>
            <MunsellColour />
            <EC>3.4</EC>
            <PH>8.4</PH>
            <CL>2449</CL>
            <Boron>27</Boron>
            <CEC>39.4</CEC>
            <Ca>15.9</Ca>
            <Mg>9.9</Mg>
            <Na>12.4</Na>
            <K>1.2</K>
            <ESP>31.5</ESP>
            <Mn />
            <Al />
            <ParticleSizeSand>28.1</ParticleSizeSand>
            <ParticleSizeSilt>12.6</ParticleSizeSilt>
            <ParticleSizeClay>59.3</ParticleSizeClay>
          </Layer>
        </Analysis>
        <SoilWat>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>2</WinterCona>
          <WinterU>2</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>88</DiffusConst>
          <DiffusSlope>35</DiffusSlope>
          <Salb>0.13</Salb>
          <Cn2Bare>73</Cn2Bare>
          <CnRed>20</CnRed>
          <CnCov>0.8</CnCov>
          <Slope />
          <DischargeWidth />
          <CatchmentArea />
          <MaxPond />
          <Layer>
            <Thickness units="mm">100</Thickness>
            <SWCON units="0-1">0.4</SWCON>
            <MWCON units="0-1" />
            <KLAT units="mm/d" />
          </Layer>
          <Layer>
            <Thickness>100</Thickness>
            <SWCON>0.3</SWCON>
            <MWCON />
            <KLAT units="mm/d" />
          </Layer>
          <Layer>
            <Thickness>250</Thickness>
            <SWCON>0.3</SWCON>
            <MWCON />
            <KLAT units="mm/d" />
          </Layer>
          <Layer>
            <Thickness>250</Thickness>
            <SWCON>0.3</SWCON>
            <MWCON />
            <KLAT units="mm/d" />
          </Layer>
          <Layer>
            <Thickness>350</Thickness>
            <SWCON>0.3</SWCON>
            <MWCON />
            <KLAT units="mm/d" />
          </Layer>
          <Layer>
            <Thickness>450</Thickness>
            <SWCON>0.3</SWCON>
            <MWCON />
            <KLAT units="mm/d" />
          </Layer>
        </SoilWat>
        <SoilOrganicMatter>
          <RootCn>40</RootCn>
          <RootWt>1000</RootWt>
          <SoilCn>12</SoilCn>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Layer>
            <Thickness units="mm">100</Thickness>
            <OC units="Walkley Black %">0.77</OC>
            <FBIOM units="0-1">0.04</FBIOM>
            <FINERT units="0-1">0.4</FINERT>
          </Layer>
          <Layer>
            <Thickness>100</Thickness>
            <OC>0.71</OC>
            <FBIOM>0.04</FBIOM>
            <FINERT>0.5</FINERT>
          </Layer>
          <Layer>
            <Thickness>250</Thickness>
            <OC>0.42</OC>
            <FBIOM>0.02</FBIOM>
            <FINERT>0.6</FINERT>
          </Layer>
          <Layer>
            <Thickness>250</Thickness>
            <OC>0.27</OC>
            <FBIOM>0.02</FBIOM>
            <FINERT>0.7</FINERT>
          </Layer>
          <Layer>
            <Thickness>350</Thickness>
            <OC>0.21</OC>
            <FBIOM>0.01</FBIOM>
            <FINERT>0.8</FINERT>
          </Layer>
          <Layer>
            <Thickness>450</Thickness>
            <OC>0.12</OC>
            <FBIOM>0.01</FBIOM>
            <FINERT>1</FINERT>
          </Layer>
        </SoilOrganicMatter>
        <Sample>
          <Date type="date" description="Sample date:" />
          <Layer>
            <Thickness units="mm">200</Thickness>
            <no3 units="kg/ha">30</no3>
            <nh4 units="kg/ha">5</nh4>
            <SW units="mm/mm">0.1</SW>
          </Layer>
          <Layer>
            <Thickness units="mm">180</Thickness>
            <no3 units="kg/ha">20</no3>
            <nh4 units="kg/ha">1</nh4>
            <SW>0.25</SW>
          </Layer>
          <Layer>
            <Thickness units="mm">100</Thickness>
            <NO3>15</NO3>
            <NH4>1</NH4>
            <SW>0.25</SW>
          </Layer>
        </Sample>
      </soil>
      <lucerne />
      <wheat />
      <manager2 name="Script">
        <ui />
        <text>Imports System
Imports ModelFramework

Public Class Script
   Inherits Instance

   &lt;Input()&gt; Private Day As Integer
   &lt;Link()&gt; Private MyPaddock As Paddock

   &lt;EventHandler()&gt; Public Sub OnPost()
      Dim dlt(0) As Double
      dlt(0) = 100
      
      Dim part(0) As String
      part(0) = "Leaf"
      
      Dim dms(0) As RemoveCropDmdmType
      dms(0) = New RemoveCropDmdmType
      dms(0).dlt = dlt
      dms(0).part = part
      dms(0).pool = "Pool"
      
      
      Dim MyRemoveCropDM As New RemoveCropDmType
      MyRemoveCropDM.dm = dms
      
      ' Make sure we can send an event using the ComponentByName method.
      If Day = 300 Then
         MyPaddock.ComponentByName("lucerne").Publish("remove_crop_biomass", MyRemoveCropDM)
      End If
      
      ' Make sure we can send an event using the Crops method.
      If Day = 305 Then
         Dim c As Component = MyPaddock.Crops(0)
         c.Publish("remove_crop_biomass", MyRemoveCropDM)
      End If
      
      
   End Sub
End Class
    </text>
      </manager2>
    </area>
  </simulation>
</folder>