<folder version="34" name="simulations">
  <simulation name="FloweringModel">
    <metfile name="met">
      <filename name="filename" input="yes">%apsim%\Examples\MetFiles\lincoln.met</filename>
    </metfile>
    <clock>
      <start_date type="date" description="Enter the start date of the simulation">01/03/2000</start_date>
      <end_date type="date" description="Enter the end date of the simulation">01/04/2001</end_date>
    </clock>
    <summaryfile />
    <area name="paddock">
      <Soil>
        <SoilType description="Soil description">Black Vertosol</SoilType>
        <LocalName>Waco</LocalName>
        <Site>Jimbour</Site>
        <NearestTown description="Nearest town">Jimbour, Q 4352</NearestTown>
        <Region>South East Queensland</Region>
        <NaturalVegetation description="Natural vegetation">Grassland, mainly Qld bluegrass</NaturalVegetation>
        <InitialWater name="Initial water">
          <FractionFull>1</FractionFull>
          <PercentMethod>FilledFromTop</PercentMethod>
        </InitialWater>
        <Water>
          <SoilCrop name="Barley">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.29</double>
              <double>0.29</double>
              <double>0.32</double>
              <double>0.38</double>
              <double>0.39</double>
              <double>0.39</double>
              <double>0.41</double>
              <double>0.48</double>
              <double>0.47</double>
              <double>0.46</double>
              <double>0.44</double>
            </LL>
            <KL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.08</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.02</double>
              <double>0.01</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="Chickpea">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.29</double>
              <double>0.29</double>
              <double>0.36</double>
              <double>0.43</double>
              <double>0.51</double>
              <double>0.5</double>
              <double>0.5</double>
              <double>0.48</double>
              <double>0.47</double>
              <double>0.46</double>
              <double>0.44</double>
            </LL>
            <KL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.08</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.02</double>
              <double>0.01</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="Lucerne">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.29</double>
              <double>0.29</double>
              <double>0.29</double>
              <double>0.29</double>
              <double>0.3</double>
              <double>0.31</double>
              <double>0.32</double>
              <double>0.33</double>
              <double>0.34</double>
              <double>0.35</double>
              <double>0.36</double>
            </LL>
            <KL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.09</double>
              <double>0.09</double>
              <double>0.09</double>
              <double>0.09</double>
              <double>0.09</double>
              <double>0.09</double>
              <double>0.09</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="Maize">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.29</double>
              <double>0.29</double>
              <double>0.34</double>
              <double>0.34</double>
              <double>0.37</double>
              <double>0.4</double>
              <double>0.42</double>
              <double>0.48</double>
              <double>0.47</double>
              <double>0.46</double>
              <double>0.44</double>
            </LL>
            <KL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.08</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.02</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="Perennial Grass">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.29</double>
              <double>0.29</double>
              <double>0.39</double>
              <double>0.41</double>
              <double>0.4</double>
              <double>0.4</double>
              <double>0.41</double>
              <double>0.41</double>
              <double>0.4</double>
              <double>0.4</double>
              <double>0.42</double>
            </LL>
            <KL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.09</double>
              <double>0.07</double>
              <double>0.05</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="Sorghum">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.29</double>
              <double>0.29</double>
              <double>0.35</double>
              <double>0.38</double>
              <double>0.4</double>
              <double>0.4</double>
              <double>0.4</double>
              <double>0.48</double>
              <double>0.47</double>
              <double>0.46</double>
              <double>0.44</double>
            </LL>
            <KL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.08</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.02</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
            </XF>
          </SoilCrop>
          <SoilCrop name="Wheat">
            <Thickness>
              <double>150</double>
              <double>150</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
              <double>300</double>
            </Thickness>
            <LL>
              <double>0.29</double>
              <double>0.29</double>
              <double>0.32</double>
              <double>0.32</double>
              <double>0.35</double>
              <double>0.38</double>
              <double>0.41</double>
              <double>0.48</double>
              <double>0.47</double>
              <double>0.46</double>
              <double>0.44</double>
            </LL>
            <KL>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.08</double>
              <double>0.06</double>
              <double>0.04</double>
              <double>0.02</double>
              <double>0.01</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
            </KL>
            <XF>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>1</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
              <double>0</double>
            </XF>
          </SoilCrop>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <BD>
            <double>1.02</double>
            <double>1.03</double>
            <double>1.02</double>
            <double>1.02</double>
            <double>1.06</double>
            <double>1.11</double>
            <double>1.12</double>
            <double>1.15</double>
            <double>1.18</double>
            <double>1.2</double>
            <double>1.25</double>
          </BD>
          <AirDry>
            <double>0.15</double>
            <double>0.26</double>
            <double>0.29</double>
            <double>0.29</double>
            <double>0.3</double>
            <double>0.31</double>
            <double>0.32</double>
            <double>0.33</double>
            <double>0.34</double>
            <double>0.35</double>
            <double>0.36</double>
          </AirDry>
          <LL15>
            <double>0.29</double>
            <double>0.29</double>
            <double>0.29</double>
            <double>0.29</double>
            <double>0.3</double>
            <double>0.31</double>
            <double>0.32</double>
            <double>0.33</double>
            <double>0.34</double>
            <double>0.35</double>
            <double>0.36</double>
          </LL15>
          <DUL>
            <double>0.54</double>
            <double>0.53</double>
            <double>0.54</double>
            <double>0.54</double>
            <double>0.52</double>
            <double>0.5</double>
            <double>0.5</double>
            <double>0.48</double>
            <double>0.47</double>
            <double>0.46</double>
            <double>0.44</double>
          </DUL>
          <SAT>
            <double>0.59</double>
            <double>0.58</double>
            <double>0.59</double>
            <double>0.58</double>
            <double>0.57</double>
            <double>0.55</double>
            <double>0.55</double>
            <double>0.53</double>
            <double>0.52</double>
            <double>0.51</double>
            <double>0.49</double>
          </SAT>
        </Water>
        <SoilWater>
          <SummerCona>3.5</SummerCona>
          <SummerU>6</SummerU>
          <SummerDate>1-Nov</SummerDate>
          <WinterCona>3.5</WinterCona>
          <WinterU>6</WinterU>
          <WinterDate>1-Apr</WinterDate>
          <DiffusConst>40</DiffusConst>
          <DiffusSlope>16</DiffusSlope>
          <Salb>0.13</Salb>
          <CN2Bare>73</CN2Bare>
          <CNRed>20</CNRed>
          <CNCov>0.8</CNCov>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <SWCON>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
            <double>0.3</double>
          </SWCON>
        </SoilWater>
        <SoilOrganicMatter>
          <RootCN>40</RootCN>
          <RootWt>200</RootWt>
          <SoilCN>12.5</SoilCN>
          <EnrACoeff>7.4</EnrACoeff>
          <EnrBCoeff>0.2</EnrBCoeff>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <OC>
            <double>1.04</double>
            <double>0.89</double>
            <double>0.89</double>
            <double>0.89</double>
            <double>0.77</double>
            <double>0.45</double>
            <double>0.27</double>
            <double>0.22</double>
            <double>0.16</double>
            <double>0.13</double>
            <double>0.12</double>
          </OC>
          <FBiom>
            <double>0.025</double>
            <double>0.02</double>
            <double>0.015</double>
            <double>0.01</double>
            <double>0.01</double>
            <double>0.01</double>
            <double>0.01</double>
            <double>0.01</double>
            <double>0.01</double>
            <double>0.01</double>
            <double>0.01</double>
          </FBiom>
          <FInert>
            <double>0.4</double>
            <double>0.6</double>
            <double>0.8</double>
            <double>0.9</double>
            <double>0.95</double>
            <double>0.95</double>
            <double>0.95</double>
            <double>0.95</double>
            <double>0.95</double>
            <double>0.95</double>
            <double>0.95</double>
          </FInert>
        </SoilOrganicMatter>
        <Analysis>
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <EC>
            <double>0.2</double>
            <double>0.25</double>
            <double>0.31</double>
            <double>0.4</double>
            <double>0.59</double>
            <double>0.84</double>
            <double>0.93</double>
            <double>1.01</double>
            <double>1.06</double>
            <double>1.05</double>
            <double>1.01</double>
          </EC>
          <PH>
            <double>8.4</double>
            <double>8.8</double>
            <double>9</double>
            <double>9.2</double>
            <double>9.2</double>
            <double>9.1</double>
            <double>9</double>
            <double>9</double>
            <double>8.9</double>
            <double>8.9</double>
            <double>8.9</double>
          </PH>
        </Analysis>
        <Sample name="Initial nitrogen">
          <Date type="date" description="Sample date:" />
          <Thickness>
            <double>150</double>
            <double>150</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
            <double>300</double>
          </Thickness>
          <NO3>
            <double>6.50300344798777</double>
            <double>2.10100111398159</double>
            <double>2.10100111398159</double>
            <double>1.70100090189562</double>
            <double>1.70100090189562</double>
            <double>1.70100090189562</double>
            <double>1.70100090189562</double>
            <double>1.70100090189562</double>
            <double>1.70100090189562</double>
            <double>1.70100090189562</double>
            <double>1.70100090189562</double>
          </NO3>
          <NH4>
            <double>0.599004378686979</double>
            <double>0.100000730999496</double>
            <double>0.100000730999496</double>
            <double>0.100000730999496</double>
            <double>0.100000730999496</double>
            <double>0.100000730999496</double>
            <double>0.100000730999496</double>
            <double>0.100000730999496</double>
            <double>0.100000730999496</double>
            <double>0.100000730999496</double>
            <double>0.100000730999496</double>
          </NH4>
        </Sample>
      </Soil>
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">wheat</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">wheat</type>
        <mass type="text" description="Initial surface residue (kg/ha)">1000</mass>
        <cnr type="text" description="C:N ratio of initial residue">80</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <fertiliser />
      <outputfile>
        <filename output="yes">FloweringModel.out</filename>
        <title>FloweringModel</title>
        <variable name="variable102">LagIsFinished</variable>
        <variables name="Variables">
          <variable>dd/mm/yyyy as Date</variable>
          <variable>AccumTt</variable>
          <variable>HS</variable>
          <variable>Vrn1</variable>
          <variable>Vrn2</variable>
          <variable>Vrn3</variable>
          <variable>Vrn4</variable>
          <variable>Vrn1Target</variable>
          <variable>TSHS</variable>
          <variable>FLN</variable>
          <variable>MeanT</variable>
          <variable>Pp</variable>
          <variable>IsGerminated</variable>
          <variable>IsPreVernalised</variable>
          <variable>IsVernalised</variable>
          <variable>IsInduced</variable>
          <variable>IsDevelopingEar</variable>
          <variable>IsFlowering</variable>
          <variable>FlagLeafDay</variable>
          <variable>FlagLeafYear</variable>
          <variable>AnthesisDay</variable>
          <variable>AnthesisYear</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>Daily</event>
        </events>
      </outputfile>
      <Graph name="Expression">
        <Legend>
          <CheckedTitles> Vrn1</CheckedTitles>
          <CheckedTitles> Vrn2</CheckedTitles>
          <CheckedTitles> Vrn3</CheckedTitles>
          <CheckedTitles> Vrn4</CheckedTitles>
          <CheckedTitles> Vrn1Target</CheckedTitles>
        </Legend>
        <Plot>
          <SeriesType>Solid line</SeriesType>
          <PointType>Circle</PointType>
          <colour>
          </colour>
          <X>HS</X>
          <Y>Vrn1</Y>
          <Y>Vrn2</Y>
          <Y>Vrn3</Y>
          <Y>Vrn4</Y>
          <Y>Vrn1Target</Y>
          <GDApsimFileReader name="ApsimFileReader" />
        </Plot>
      </Graph>
      <Graph name="HaunStage">
        <Legend>
          <CheckedTitles> HS</CheckedTitles>
          <CheckedTitles> TSHS</CheckedTitles>
          <CheckedTitles> FLN</CheckedTitles>
        </Legend>
        <Plot>
          <SeriesType>Solid line</SeriesType>
          <PointType>Circle</PointType>
          <colour>
          </colour>
          <Y>HS</Y>
          <Y>FIHS</Y>
          <Y>TSHS</Y>
          <Y>FLN</Y>
          <X>Date</X>
          <GDApsimFileReader name="ApsimFileReader" />
        </Plot>
      </Graph>
      <Graph name="Environment">
        <Legend>
          <CheckedTitles> MeanT</CheckedTitles>
          <CheckedTitles> Pp</CheckedTitles>
        </Legend>
        <Plot>
          <SeriesType>Solid line</SeriesType>
          <PointType>Circle</PointType>
          <colour>
          </colour>
          <Y>MeanT</Y>
          <Y>Pp</Y>
          <X>Date</X>
          <GDApsimFileReader name="ApsimFileReader" />
        </Plot>
      </Graph>
      <manager2 name="PhenMod">
        <text>
using System;
using ModelFramework;

public class Script 
   {      
   [Link] Paddock MyPaddock; // Can be used To dynamically Get access To simulation Structure And variables
   [Link] Clock Clock;
   
    //Set up inputs
   [Link] Function PhotoperiodFunction;
   [Link] Function ThermalTime;
   [Link] Function HaunStage;   
   [Link] Function Vrn1rate;
   [Link] Function Vrn2rate;
   [Link] Function Vrn3rate;
   [Link] Function FL_AN_Tt;
   [Link] Function BaseVrn1Target;
   [Link] Function InitialVrn4Level;
   
   [Input] double MaxT;
   [Input] double MinT;
   
   //Set up class variables
   [Output] double AccumTt = 0;
   [Output] double Vrn1Lag = 0;
   [Output] double Vrn1 = 0;
   [Output] double Vrn2 = 0;
   [Output] double Vrn3 = 0;
   [Output] double Vrn4 = 0;
   [Output] double Vrn1Target = 0;
   [Output] double Pp = 0;
   [Output] double Tt = 0;
   [Output] double HS = 0;
   [Output] double FL_AN_target = 0;
   [Output] double HaunStageYesterday = 0;
   [Output] double DeltaHaunStage = 0;
   [Output] double FIHS = 0;
   [Output] double TSHS = 0;
   [Output] double FLN = 0;
   [Output] double AnthesisDay = 0;
   [Output] double AnthesisYear = 0;
   [Output] double FlagLeafDay = 0;
   [Output] double FlagLeafYear = 0;
   [Output] double FloweringTarget = 0;
   [Output] double MeanT = 0;
   [Output] bool IsGerminated = false;
   [Output] bool IsPreVernalised = false;
   [Output] bool IsVernalised = false;
   [Output] bool IsInduced = false;
   [Output] bool IsDevelopingEar = false;
   [Output] bool IsFlowering = false;
   
   //Event procedures
   [EventHandler] public void OnInitialised()
   {
      Vrn4 = InitialVrn4Level.Value;
      Vrn1Target = BaseVrn1Target.Value;
   }
      
   [EventHandler] public void OnPrepare()
   {
      MeanT = (MaxT + MinT) / 2;
      Pp = PhotoperiodFunction.Value;
      Tt = ThermalTime.Value;
      if (IsDevelopingEar == false)
         HS = HaunStage.Value;
      if (IsGerminated)
         DeltaHaunStage = HS - HaunStageYesterday;
      HaunStageYesterday = HS;
      AccumTt += Tt; 
      IsGerminated = true; //Germinated on 1st day
      
      //Pre-Vernalisation lag, determine the repression of Vrn4
      if (IsPreVernalised == false)
      {
         Vrn4 -= Vrn1rate.Value * DeltaHaunStage;
         Vrn4 = Math.Max(Vrn4, 0.0);
         if (Vrn4 == 0.0)
            IsPreVernalised = true;
      }
      //Vernalisation, determine extent of Vrn1 expression when Vrn 4 is suppressed
      if ((IsPreVernalised) &amp;&amp; (IsVernalised == false))
      {
         Vrn1 += Vrn1rate.Value * DeltaHaunStage;
         Vrn1 = Math.Min(1.0, Vrn1);
      }
      //Update Vernalisation target to reflect photoperiod conditions and determine Vernalisation status
      if ((IsVernalised == false) &amp;&amp; (Vrn1Target &lt;= 1.0))
      { 
         if (HS &gt;= 1.1)
         {
            Vrn2 += Vrn2rate.Value * DeltaHaunStage;
            Vrn1Target = Math.Min(1.0, BaseVrn1Target.Value + Vrn2);
         }
         if (Vrn1 &gt;= Vrn1Target)
            IsVernalised = true;
      }
      //If Vernalisation is complete begin expressing Vrn3
      if ((IsVernalised) &amp;&amp; (IsInduced == false))
      {
         Vrn3 += Vrn3rate.Value * DeltaHaunStage;
         Vrn3 = Math.Min(1.0, Vrn3);
      }
      
      //If Vrn3 is sufficient set timings terminal spiklet and FLN
      if ((Vrn3 &gt;= 1.0) &amp;&amp; (IsInduced == false))
      {
         TSHS = HS + 1.0;
         FLN = 2.86 + 1.1 * TSHS;
         IsInduced = true;
      }
      
      //If all leaves have appeared at Flag leaf and set duration from flagleaf to anthesis
      if ((HS &gt;= FLN) &amp;&amp; (IsInduced) &amp;&amp; (IsDevelopingEar == false))
      {
         FloweringTarget = AccumTt + FL_AN_Tt.Value;
         IsDevelopingEar = true;
         FlagLeafDay = Clock.day_of_year;
         FlagLeafYear = Clock.year;
      }
         
      //If flowering target reached set flowering date
      if((AccumTt &gt;= FloweringTarget) &amp;&amp; (IsDevelopingEar) &amp;&amp; (IsFlowering == false))
      {
         AnthesisDay = Clock.day_of_year;
         AnthesisYear = Clock.year;
         IsFlowering = true;
      }
      
      
    
      
   }
   
}
       </text>
        <Reference>%APSIM%\Model\Plant2.dll</Reference>
        <PhotoperiodFunction>
          <Twilight type="text" description="Twilight">-6</Twilight>
          <Memo>Returns the value of photoperiod.  Twilight is the sun angle below the horizon for beginning and ending photoperiods</Memo>
        </PhotoperiodFunction>
        <AirTemperatureFunction name="ThermalTime">
          <XYPairs>
            <XY>0 0</XY>
            <XY>30 30</XY>
            <XY>40 0</XY>
          </XYPairs>
          <Memo>This function uses max and min air temperature, three hourly temperature interpolation and the temperature threshold specified to return a daily thermal time value</Memo>
        </AirTemperatureFunction>
        <LinearInterpolationFunction name="HaunStage">
          <XProperty type="text" description="XProperty">AccumTt</XProperty>
          <XYPairs>
            <XY>0 -1.6</XY>
            <XY>110 0</XY>
            <XY>335 2.5</XY>
            <XY>884 7</XY>
            <XY>2066 14</XY>
            <XY>2234 15</XY>
            <XY>2830 18</XY>
          </XYPairs>
          <Memo>Takes the current value of the XProperty and returns the corresponding y value from the XY maxtix specified</Memo>
        </LinearInterpolationFunction>
        <ExponentialFunction name="Vrn1rate">
          <A type="text" description="A">.08</A>
          <B type="text" description="B">1.6</B>
          <C type="text" description="C">-.19</C>
          <Memo>Takes the value of the child as the x value and returns the y value from a exponential of the form y = A * B * exp(x * c)</Memo>
          <VariableReference>
            <VariableName type="text" description="Variable Name">MeanT</VariableName>
            <Memo>Returns the value of a nominated Plant2 variable.</Memo>
          </VariableReference>
        </ExponentialFunction>
        <LinearInterpolationFunction name="Vrn2rate">
          <XProperty type="text" description="XProperty">PhotoperiodFunction.Value</XProperty>
          <XYPairs>
            <XY>0 0</XY>
            <XY>8 0</XY>
            <XY>16 0.028</XY>
            <XY>24 0.028</XY>
          </XYPairs>
        </LinearInterpolationFunction>
        <LinearInterpolationFunction name="Vrn3rate">
          <XProperty type="text" description="XProperty">PhotoperiodFunction.Value</XProperty>
          <XYPairs>
            <XY>0 0.153</XY>
            <XY>8 0.153</XY>
            <XY>16 0.33</XY>
            <XY>24 0.33</XY>
          </XYPairs>
          <Memo>Takes the current value of the XProperty and returns the corresponding y value from the XY maxtix specified</Memo>
        </LinearInterpolationFunction>
        <LinearInterpolationFunction name="FL_AN_Tt">
          <XProperty type="text" description="XProperty">PhotoperiodFunction.Value</XProperty>
          <XYPairs>
            <XY>0 220</XY>
            <XY>11 220</XY>
            <XY>11.1 500</XY>
            <XY>16 220</XY>
            <XY>24 220</XY>
          </XYPairs>
          <Memo>Takes the current value of the XProperty and returns the corresponding y value from the XY maxtix specified</Memo>
        </LinearInterpolationFunction>
        <Constant name="BaseVrn1Target">
          <Value type="text" description="Value">0.74</Value>
        </Constant>
        <Constant name="InitialVrn4Level">
          <Value type="text" description="Value">1</Value>
        </Constant>
      </manager2>
    </area>
  </simulation>
</folder>