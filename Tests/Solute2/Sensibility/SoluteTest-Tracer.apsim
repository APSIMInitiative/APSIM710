<folder version="36" creator="Apsim 7.5-r3147" name="simulations">
  <simulation name="Solute2Test-Tracer">
    <clock>
      <start_date type="date" description="Enter the start date of the simulation">01/01/2000</start_date>
      <end_date type="date" description="Enter the end date of the simulation">31/01/2000</end_date>
    </clock>
    <metfile name="met">
      <filename name="filename" input="yes">%apsim%\Examples\MetFiles\MildTemperate.met</filename>
    </metfile>
    <memo name="Info">
========================================================================
      Generic tests for solute2 - tracer
========================================================================


  » This simulation uses a tracer solute:
    + No interactions with soil, except leaching
    + No transformations in the solute
    + Diffusion computed by SWIM


  » Basic simulation description:
    + Bare soil
    + Generic soil - Silt Loam
    + Artificial mild temperate weather
    + 1 kg/ha of tracer in top layer at start
    + Tracer applied 10 kg/ha, on a deep layer (1250mm)


  » Expected behaviour:
    + All outputs should have a numeric value (can be zero)
    + Before the addition of tracer at deep layer:
      - The total amount of tracer in the soil should be constant
      - No noticiable leaching
      - Redistribution of initial solute from the surface downwards in the soil profile
    + After the addition of tracer:
      - Total solute amount spikes up and soon start to decrease
      - Leaching starts soon after application
      - Redistribution at depth is mostly downwards, but goes also upwards

» Variations:
    + Increasing the initial concentration in the top layer to 10 kg/ha:
      - No changes in total solute prior to deep layer addition, as no leaching occurs
      - Redistribution at surface follows similar trend as before, but changes are a bit faster (greater gradient)

    + Adding the tracer at a depth smaller than 1000mm:
      - No noticiable leaching for depth smaller than 990mm
      - Redistribution floows similar pattern as before
</memo>
    <summaryfile />
    <area name="Paddock">
      <folder name="ManagerFolder">
        <manager2 name="Apply_Tracer">
          <ui>
            <Dummy1 type="category" description="Date to start applications (dd/mm/yyyy):" />
            <ApplyTracer_StartDate type="ddmmmdate" description="Date to start applications (dd/mm/yyyy):">10/01/2000</ApplyTracer_StartDate>
            <ApplyTracer_EndDate type="ddmmmdate" description="Date to end applications (dd/mm/yyyy):">31/12/2100</ApplyTracer_EndDate>
            <ApplyTracer_Interval type="text" description="Type the interval between applications (days):">1461</ApplyTracer_Interval>
            <ApplyTracer_Amount2Add type="text" description="Type the amount of inhibitor to apply ((kg/ha):">10</ApplyTracer_Amount2Add>
            <ApplyTracer_Depth type="text" description="Type the depth to apply inhibitor (mm):">1250</ApplyTracer_Depth>
          </ui>
          <text>Imports System
Imports ModelFramework

'This manager applies a tracer solute at the amount and depth specified (it also can repeat the application periodically)
' RCichota, last update: 23/Jul/2013

Public Class Script
   
   'Parameter variables:
   &lt;param&gt; Private ApplyTracer_StartDate As String
   &lt;param&gt; Private ApplyTracer_EndDate As String
   &lt;param&gt; Private ApplyTracer_Interval As Integer
   &lt;param&gt; Private ApplyTracer_Amount2Add As Single
   &lt;param&gt; Private ApplyTracer_Depth As Single
   
   &lt;[Event]()&gt; Public Event SoluteChanged As SoluteChangedDelegate

   'Variables read from other modules
   &lt;Input&gt; Private today As DateTime
   &lt;Input&gt; Private dlayer As Single()

   'Output variables
   &lt;Output&gt;&lt;Units("kg/ha")&gt; Public TracerAdded As Single       'The amount of tracer added

   'Internal variables
   Private StartDate As DateTime                   'The date when applications start (in date format)
   Private EndDate As DateTime                     'The date when applications finish (in date format)
   Private TimeAfterApplication As Integer         'Number of days after a urine application
   Private SoilDepth As Single                     'The soil depth (mm)
   Private Layer2Apply As Integer                  'The layer at which tracer will be applied

   &lt;EventHandler()&gt; Public Sub OnInit2()

      'Put the dates into date format:
      StartDate = Date.Parse(ApplyTracer_StartDate)
      EndDate = Date.Parse(ApplyTracer_EndDate)
              
      'Computes the layer at which NitInhibitor will be applied
      Dim DepthFromSurface As Single = 0
      For z As Integer = 0 To dlayer.length - 1
         If DepthFromSurface &lt;= ApplyTracer_Depth Then Layer2Apply = z
         DepthFromSurface = DepthFromSurface + dlayer(z)
      Next
      
      console.WriteLine(" TracerAdded to be applied at " &amp; ApplyTracer_Depth.ToString() &amp; " mm depth, layer " &amp; (Layer2Apply + 1).ToString())

   End Sub

   &lt;EventHandler()&gt; Public Sub OnPrepare()

      Dim delta_solute As Double()
      Dim canApplyTracer As Boolean = False
      
      'Re-set variables
      ReDim delta_solute(dlayer.Length - 1)
      TracerAdded = 0

      'Decide whether it is time to apply inhibitor:
      If today &gt;= StartDate And today &lt;= EndDate Then
         If today = StartDate Then
            canApplyTracer = True
         Else
            If TimeAfterApplication &gt;= ApplyTracer_Interval Then
               canApplyTracer = True
            Else
               TimeAfterApplication = TimeAfterApplication + 1
               TracerAdded = 0
            End If
         End If
         
         If canApplyTracer Then
            
            'fill the delta_solute array
            For z As Integer=0 To dlayer.Length - 1
               delta_solute(z) = 0.0
            Next
            delta_solute(Layer2Apply) = CDbl(ApplyTracer_Amount2Add)
            TracerAdded += ApplyTracer_Amount2Add
         
            ' send delta_solute to apsim
            Dim SoluteChanges As SoluteChangedType = New SoluteChangedType()
            SoluteChanges.Sender = "Manager: Apply_Tracer"
            SoluteChanges.SoluteName = "Tracer"
            SoluteChanges.SoluteUnits = "kg/ha"
            SoluteChanges.DeltaSolute = delta_solute
            RaiseEvent SoluteChanged(SoluteChanges)

            TimeAfterApplication = 1

            Console.WriteLine(today.ToString("dd MMMM yyyy") + " (Day of year=" + today.DayOfYear.ToString + "), Apply_Tracer:")
            Console.WriteLine("     tracer being applied. " + TracerAdded.ToString + "kg/ha added at depth " + ApplyTracer_Depth.ToString + "mm")
            
         End If         
      End If                  
   End Sub

End Class
    </text>
        </manager2>
      </folder>
      <micromet name="Micromet">
        <soilalbedo type="text" description="soilalbedo">0.23</soilalbedo>
        <a_interception type="text" description="a_interception">0</a_interception>
        <b_interception type="text" description="b_interception">0</b_interception>
        <c_interception type="text" description="c_interception">0</c_interception>
        <d_interception type="text" description="d_interception">0</d_interception>
      </micromet>
      <tracer2 name="Tracer">
        <Dummy1 type="category" description="Initial content of Tracer in the soil" />
        <InitialContent type="text" description="  Amount of Tracer for each layer (kg/ha):">1.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0 0.0  0.0</InitialContent>
        <Dummy2 type="category" description="Solute diffusivity" />
        <MolecularDiffusivity type="text" description="  Diffusivity of Tracer in water (mm2/day):">0.0</MolecularDiffusivity>
      </tracer2>
      <surfaceom name="SurfaceOrganicMatter">
        <PoolName type="text" description="Organic Matter pool name">grass</PoolName>
        <type type="list" listvalues="bambatsi,barley,base_type,broccoli,camaldulensis,canola,centro,chickpea,chikenmanure_base,cm,cmA,cmB,constants,cotton,cowpea,danthonia,fababean,fieldpea,fym,gbean,globulus,goatmanure,grandis,grass,horsegram,inert,lablab,lentil,lucerne,lupin,maize,manB,manure,medic,millet,mucuna,nativepasture,navybean,oats,orobanche,peanut,pigeonpea,potato,rice,sorghum,soybean,stylo,sugar,sunflower,sweetcorn,sweetsorghum,tillage,tithonia,vetch,weed,wheat" description="Organic Matter type">grass</type>
        <mass type="text" description="Initial surface residue (kg/ha)">200</mass>
        <cnr type="text" description="C:N ratio of initial residue">20</cnr>
        <standing_fraction type="text" description="Fraction of residue standing">0</standing_fraction>
      </surfaceom>
      <SWIM2ui2>
        <dummy1 type="category" description="SWIM boundary conditions:" />
        <top_boundary_condition type="list" listvalues="0,1,2,3" description="Choose top boundary condition (0=inf conduct; 1=const potential; 2=limtd conduct):">0</top_boundary_condition>
        <runoff type="list" listvalues="0,1,2" description="Choose runnof/pond condition (0=all runoff; 1=all pond; 2=calc runoff):">1</runoff>
        <bottom_boundary_condition type="list" listvalues="0,1,2,3" description="Choose bottom boundary condition (0=set pot grad; 1=set potential; 2=impermeable;3=seepage):">0</bottom_boundary_condition>
        <run_solutes type="text" description="Type list of solutes SWIM will move:">urea  nh4  no3  tracer</run_solutes>
        <max_water_increment type="text" description="Type base water increment value:">0.5</max_water_increment>
        <dummy2 type="category" description="Description of soil profile" />
        <x type="text" description="Enter the values of x for each layer:">0  10  20  30  50  70  90  110  140  160  190  210  250  270  330  370  430  470  530  570  650  710  790  860  940  1060  1140  1260  1340  1440  1500</x>
        <soil_type type="text" description="Enter the tags for each layer:">A_ZL_mC  A_ZL_mC  A_ZL_mC  A_ZL_mC  A_ZL_mC  A_ZL_mC  A_ZL_mC  A_ZL_mC  A_ZL_mC  -  -  B1_ZL_mC  B1_ZL_mC  B1_ZL_mC  -  -  B2_SL_mC  B2_SL_mC  B2_SL_mC  B2_SL_mC  B2_SL_mC  B2_SL_mC  B2_SL_mC  -  -  BC_S_mC  BC_S_mC  BC_S_mC  BC_S_mC  BC_S_mC  BC_S_mC</soil_type>
        <psi type="text" description="Enter the inital values of psi for each layer:">-100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100  -100</psi>
        <ini name="Ini_SWIM2">
          <filename input="yes">%apsim%\Tests\Solute2\ini_SWIMui2(GenericSiltLoam).xml</filename>
        </ini>
      </SWIM2ui2>
      <SoilNitrogen>
        <category type="category" description="Parameters to initialise soil organic matter" />
        <root_wt type="text" description="Type the initial FOM amount in the soil (kgDM/ha):">1000</root_wt>
        <root_cn type="text" description="Type the initial C:N ratio of FOM:">30</root_cn>
        <soil_cn type="text" description="Type the C:N ratio of soil humus:">12.5</soil_cn>
        <mcn type="text" description="Type the C:N ratio of soil microbial biomass:">8</mcn>
        <category type="category" description="Enter the values for each layer" />
        <ph type="text" description="Type the inital soil pH:">6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0    6.0</ph>
        <oc type="text" description="Type the initial soil organic carbon content (%):">4.817  4.789  4.760  4.717  4.665  4.613  4.331  3.977  3.667  3.396  3.148  2.877  2.630  2.336  2.023  1.761  1.550  1.379  1.241  1.111  0.996  0.912  0.844  0.797  0.752  0.723  0.704  0.692  0.685  0.681  0.680</oc>
        <fbiom type="text" description="Type the microbial biomass fraction of OC (0-1):">0.080  0.080  0.080  0.080  0.079  0.078  0.075  0.069  0.061  0.050  0.040  0.029  0.021  0.013  0.008  0.008  0.008  0.008  0.008  0.008  0.008  0.008  0.008  0.008  0.008  0.008  0.008  0.008  0.008  0.008  0.008</fbiom>
        <finert type="text" description="Type the inert fraction of soil humus (0-1):">0.454  0.461  0.468  0.474  0.487  0.515  0.571  0.626  0.678  0.718  0.755  0.786  0.819  0.843  0.876  0.895  0.915  0.927  0.940  0.947  0.958  0.964  0.971  0.976  0.980  0.985  0.988  0.990  0.992  0.993  0.994</finert>
        <no3ppm type="text" description="Type the initial concentration of NO3 is the soil (ppm):">1.50   2.00   2.40   2.50   2.50   2.50   2.50   2.50   2.50   2.45   2.30   2.15   2.00   1.85   1.60   1.35   1.15   0.90   0.80   0.71   0.65   0.59   0.51   0.44   0.39   0.34   0.30   0.26   0.21   0.20   0.20</no3ppm>
        <nh4ppm type="text" description="Type the initial concentration of NH4 is the soil (ppm):">0.50   0.70   0.80   0.80   0.80   0.80   0.80   0.80   0.80   0.80   0.80   0.70   0.60   0.50   0.40   0.40   0.30   0.30   0.20   0.20   0.20   0.20   0.20   0.10   0.10   0.10   0.10   0.08   0.07   0.07   0.07</nh4ppm>
        <ureappm type="text" description="Type the initial concentration of urea is the soil (ppm):">0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00</ureappm>
      </SoilNitrogen>
      <SoilTemperature2>
        <MaxTTimeDefault>14</MaxTTimeDefault>
        <BoundaryLayerConductanceSource>calc</BoundaryLayerConductanceSource>
        <BoundaryLayerConductance>20</BoundaryLayerConductance>
        <BoundaryLayerConductanceIterations>1</BoundaryLayerConductanceIterations>
        <NetRadiationSource>calc</NetRadiationSource>
        <DefaultWindSpeed>3</DefaultWindSpeed>
        <DefaultAltitude>18</DefaultAltitude>
        <DefaultInstrumentHeight>1.2</DefaultInstrumentHeight>
        <BareSoilHeight>57</BareSoilHeight>
        <Clay>15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0   15.0</Clay>
      </SoilTemperature2>
      <outputfile name="Outputs">
        <filename output="yes">Solute2Test-Tracer Outputs.out</filename>
        <title>Solute2Test-Tracer Outputs</title>
        <variables name="Variables">
          <variable>dd/mmm/yyyy as Date</variable>
          <variable>day as DoY</variable>
          <variable>rain as Rain</variable>
          <variable>drain as Drainage format 2</variable>
          <variable>sw_dep() as SoilWaterContent format 2</variable>
          <variable>TracerAdded format 2</variable>
          <variable>Tracer() format 3</variable>
          <variable>Leach_tracer format 3</variable>
          <variable>InitialContent</variable>
          <variable>tracer format 3</variable>
          <variable>flow_tracer</variable>
          <variable>Diffusion_tracer</variable>
          <variable>tracer_ppm</variable>
          <variable>dlayer</variable>
        </variables>
        <events name="Reporting Frequency">
          <event>end_day</event>
        </events>
        <Graph name="Amounts">
          <Legend>
            <CheckedTitles> TracerAdded</CheckedTitles>
            <CheckedTitles> Tracer()</CheckedTitles>
            <CheckedTitles> Tracer(1)</CheckedTitles>
            <CheckedTitles> Tracer(2)</CheckedTitles>
            <CheckedTitles> Tracer(3)</CheckedTitles>
            <CheckedTitles> Tracer(4)</CheckedTitles>
            <CheckedTitles> Tracer(5)</CheckedTitles>
          </Legend>
          <Plot>
            <SeriesType>Solid line</SeriesType>
            <PointType>None</PointType>
            <colour>
            </colour>
            <X>Date</X>
            <Y>TracerAdded</Y>
            <Y>Tracer()</Y>
            <Y>Tracer(1)</Y>
            <Y>Tracer(2)</Y>
            <Y>Tracer(3)</Y>
            <Y>Tracer(4)</Y>
            <Y>Tracer(5)</Y>
            <GDApsimFileReader name="ApsimFileReader" />
          </Plot>
        </Graph>
        <Graph name="Leaching">
          <Legend>
            <CheckedTitles> TracerAdded</CheckedTitles>
            <CheckedTitles> Cumulative Leach_tracer</CheckedTitles>
            <CheckedTitles> Cumulative flow_tracer(1)</CheckedTitles>
            <CheckedTitles> Cumulative flow_tracer(2)</CheckedTitles>
            <CheckedTitles> Cumulative flow_tracer(28)</CheckedTitles>
            <CheckedTitles> Cumulative flow_tracer(29)</CheckedTitles>
            <CheckedTitles> Cumulative flow_tracer(30)</CheckedTitles>
          </Legend>
          <Plot>
            <SeriesType>Solid line</SeriesType>
            <PointType>None</PointType>
            <colour>
            </colour>
            <X>Date</X>
            <Y>TracerAdded</Y>
            <Y>Cumulative Leach_tracer</Y>
            <Y>Cumulative flow_tracer(1)</Y>
            <Y>Cumulative flow_tracer(2)</Y>
            <Y>Cumulative flow_tracer(28)</Y>
            <Y>Cumulative flow_tracer(29)</Y>
            <Y>Cumulative flow_tracer(30)</Y>
            <GDApsimFileReader name="ApsimFileReader" />
          </Plot>
        </Graph>
        <Graph name="Depth">
          <Legend>
            <CheckedTitles> tracer,   1/01/2000</CheckedTitles>
            <CheckedTitles> tracer,   10/01/2000</CheckedTitles>
            <CheckedTitles> tracer,   31/01/2000</CheckedTitles>
            <CheckedTitles> tracer_ppm,   1/01/2000</CheckedTitles>
            <CheckedTitles> tracer_ppm,   10/01/2000</CheckedTitles>
            <CheckedTitles> tracer_ppm,   31/01/2000</CheckedTitles>
          </Legend>
          <Plot>
            <SeriesType>Solid line</SeriesType>
            <PointType>None</PointType>
            <Y>Depth</Y>
            <colour>
            </colour>
            <XTop>tracer</XTop>
            <XTop>tracer_ppm</XTop>
            <GDDepth name="Depth">
              <AllXOnTopAxis>Yes</AllXOnTopAxis>
              <Date>1/1/2000</Date>
              <Date>10/1/2000</Date>
              <Date>31/1/2000</Date>
              <GDApsimFileReader name="ApsimFileReader" />
            </GDDepth>
          </Plot>
        </Graph>
      </outputfile>
    </area>
  </simulation>
</folder>