<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="Build.xsl"?>
<!--
    This is the Job Scheduler file that Bob uses. It cleans the %APSIM% directory, loads
	Build.xml to perform the build and run and then compresses the %APSIM% directory, creates a 
	binary zip file and sends an email.
	
	NB: If you run this on your computer, it will clean out all unversioned files from your %APSIM%
	    directory and revert all changes to SVN.
		i.e. YOU MAY LOSE YOUR WORK !!!!!!!!

-->
<Folder name="Bob" LoopForever="no">
	<Folder name="Build" >
		<Job name="Remove all example .out and .sum files" wait="yes">
			<WorkingDirectory>%APSIM%/Examples</WorkingDirectory>
			<CommandLineUnix>find . -name \*.out -or -name \*.sum -exec rm {} \; </CommandLineUnix>
		</Job>
		<Job name="Remove all test .out and .sum files" wait="yes">
			<WorkingDirectory>%APSIM%/Tests</WorkingDirectory>
			<CommandLineUnix>find . -name \*.out -or -name \*.sum -exec rm {} \; </CommandLineUnix>
		</Job>
		<Job name="Write potential revision number into Apsim.xml" wait="yes">
			<WorkingDirectory>%APSIM%/Model/Build</WorkingDirectory>
			<CommandLineUnix>tclsh8.5 VersionStamper.tcl Increment</CommandLineUnix>
		</Job>
		<!-- Build APSIM -->
		<Job name="Load in Build.xml" wait="yes">
			<WorkingDirectory>%APSIM%/Model</WorkingDirectory>
			<CommandLineUnix>JobSchedulerSendCommand.exe "AddXMLFile~%JobPath%/../Build~%APSIM%/Model/Build/BuildAll.xml"</CommandLineUnix>
		</Job>
		<Folder name="Build" wait="yes" IgnoreErrors="yes"/>
                <Job name="Create release" wait="yes" >
			<WorkingDirectory>%APSIM%/Release</WorkingDirectory>
			<CommandLineUnix>/bin/sh Release.sh %PatchFileName%</CommandLineUnix>
		</Job>	
		<Job name="Update DB Release" wait="yes">
			<WorkingDirectory>%APSIM%/Model</WorkingDirectory>
			<CommandLine>JobSchedulerUpdateFieldInDB.exe linuxSFX http://bob.apsim.info/files/%PatchFileName%.binaries.zip</CommandLine>
		</Job>		
	</Folder>

	<!-- Run all APSIM tests -->
	<Job name="Load in Run.xml" >
		<WorkingDirectory>%APSIM%/Model</WorkingDirectory>
		<CommandLineUnix>JobSchedulerSendCommand.exe "AddXMLFile~%JobPath%/../Run~%APSIM%/Model/Build/RunAll.xml"</CommandLineUnix>
	</Job>
        <Folder name="Run" wait="yes" IgnoreErrors="yes"/>
	<!--  Finish up by collecting diffs and sending the email. -->	
	<Job name="CreateDiffsZip" wait="yes">
		<WorkingDirectory>%APSIM%/Model</WorkingDirectory>
		<CommandLineUnix>JobSchedulerCreateDiffZip.exe %APSIM% %PatchFileName%</CommandLineUnix>
	</Job>
</Folder>
