<Project>

   <!-- ############### The BuildAll target is used in BuildAll.bat ############### -->
   <Target name="BuildAll">
      <DependsOn>Clean</DependsOn>
      <DependsOn>Pre-Compile</DependsOn>
      <DependsOn>Compile</DependsOn>
      <DependsOn>Post-Compile</DependsOn>
   </Target>

   <!-- ############### Cleaning target called by BuildAll ############### -->
   <Target name="Clean">
      <Job name="Clean model directory">
         <WorkingDirectory>%APSIM%/Model/Build</WorkingDirectory>
         <CommandLine>%APSIM%/Model/cscs.exe RemoveUnwantedFiles.cs Directory=%APSIM%/Model</CommandLine>
         <CommandLineUnix>mono %APSIM%/Model/cscs.exe RemoveUnwantedFiles.cs Directory=%APSIM%/Model</CommandLineUnix>
      </Job>
      <Job name="Remove the %APPDATA%\APSIM">
         <WorkingDirectory>%APSIM%</WorkingDirectory>
         <CommandLine>cmd.exe /c if exist "%APPDATA%\APSIM" rd /S /Q "%APPDATA%\APSIM"</CommandLine>
         <CommandLineUnix>/bin/true</CommandLineUnix>
      </Job>      
      <Job name="Version stamp the build">
         <WorkingDirectory>%APSIM%/Model/Build</WorkingDirectory>
         <CommandLine>%APSIM%/Model/cscs.exe VersionStamper.cs Directory=%APSIM% Increment=%INCREMENT%</CommandLine>
         <CommandLineUnix>mono %APSIM%/Model/cscs.exe VersionStamper.cs Directory=%APSIM% Increment=%INCREMENT%</CommandLineUnix>
      </Job>
   </Target>

   <!-- ############### Compiling targets ############### -->
   <Target name="Pre-Compile">
      <DependsOn>Clean</DependsOn>
      <Job name="Move RunTime files into model directory">
         <WorkingDirectory>%APSIM%/Model/RunTime</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile JobScheduler Tools">
         <DependsOn>Move RunTime files into model directory</DependsOn>
         <WorkingDirectory>%APSIM%/Model/JobScheduler</WorkingDirectory>
         <CommandLine>make --file=MakefileTools</CommandLine>
      </Job>
   </Target>
   <Target name="Compile">
      <DependsOn>Pre-Compile</DependsOn>
      <Job name="Compile CSGeneral">
         <WorkingDirectory>%APSIM%/Model/CSGeneral</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile CMPServices">
         <WorkingDirectory>%APSIM%/Model/CMPServices</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile ApsimFile">
         <DependsOn>Compile CMPServices</DependsOn>
         <WorkingDirectory>%APSIM%/Model/ApsimFile</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile General">
         <WorkingDirectory>%APSIM%/Model/General</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile ApsimShared">
         <DependsOn>Compile General</DependsOn>
         <WorkingDirectory>%APSIM%/Model/ApsimShared</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile DataTypes">
         <DependsOn>Compile General</DependsOn>
         <DependsOn>Compile ApsimShared</DependsOn>
         <WorkingDirectory>%APSIM%/Model/DataTypes</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Protocol">
         <DependsOn>Compile General</DependsOn>
         <DependsOn>Compile ApsimShared</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Protocol</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile ComponentInterface">
         <DependsOn>Compile General</DependsOn>
         <DependsOn>Compile ApsimShared</DependsOn>
         <DependsOn>Compile DataTypes</DependsOn>
         <WorkingDirectory>%APSIM%/Model/ComponentInterface</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile ComponentInterface2">
         <DependsOn>Compile General</DependsOn>
         <DependsOn>Compile ApsimShared</DependsOn>
         <DependsOn>Compile DataTypes</DependsOn>
         <WorkingDirectory>%APSIM%/Model/ComponentInterface2</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile CSDotNetComponentInterface">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DataTypes</DependsOn>
         <WorkingDirectory>%APSIM%/Model/CSDotNetComponentInterface</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile FortranInfrastructure">
         <DependsOn>Compile DataTypes</DependsOn>
         <WorkingDirectory>%APSIM%/Model/FortranInfrastructure</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile FortranComponentInterface">
         <DependsOn>Compile General</DependsOn>
         <DependsOn>Compile ApsimShared</DependsOn>
         <DependsOn>Compile ComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/FortranComponentInterface</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile FortranComponentInterface2">
         <DependsOn>Compile General</DependsOn>
         <DependsOn>Compile ApsimShared</DependsOn>
         <DependsOn>Compile Protocol</DependsOn>
         <DependsOn>Compile ComponentInterface2</DependsOn>
         <WorkingDirectory>%APSIM%/Model/FortranComponentInterface2</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile CropTemplate">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <WorkingDirectory>%APSIM%/Model/CropTemplate</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile DotNetProxies">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/DotNetProxies</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Plant">
         <DependsOn>Compile ComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Plant</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Accum">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Accum</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile AgPasture">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/AgPasture</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Canopy">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Canopy</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Clock">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Clock</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile CropMod">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <DependsOn>Compile CropTemplate</DependsOn>
         <WorkingDirectory>%APSIM%/Model/CropMod</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Eo">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Eo</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Erosion">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Erosion</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Fertiliser">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface2</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Fertiliser</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Grasp">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface2</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Grasp</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Graz">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile ComponentInterface2</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Graz</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Growth">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <DependsOn>Compile CropTemplate</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Growth</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Input">
         <DependsOn>Compile ComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Input</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile PatchInput">
         <DependsOn>Compile Input</DependsOn>
         <WorkingDirectory>%APSIM%/Model/PatchInput</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SiloInput">
         <DependsOn>Compile Input</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SiloInput</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile PatchData">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/PatchData</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>      
      <Job name="Compile Irrigation">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Irrigation</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Log">
         <DependsOn>Compile Protocol</DependsOn>
         <DependsOn>Compile ComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Log</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Maize">
         <DependsOn>Compile ComponentInterface2</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Maize</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Manager">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Manager</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Manager2">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Manager2</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Map">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Map</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile MicroClimate">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%\Model\MicroClimate</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile MicroMet">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/MicroMet</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Millet">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile CropTemplate</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Millet</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Operations">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Operations</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Oryza">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile CropTemplate</DependsOn>
         <DependsOn>Compile CropMod</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Oryza</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Cotton">
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile CSGeneral</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Cotton</WorkingDirectory>
         <CommandLine>make</CommandLine>
         <CommandLineUnix>make -f Makefile.unix</CommandLineUnix>
      </Job>
      <Job name="Compile Parasite">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <DependsOn>Compile CropTemplate</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Parasite</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Pasture">
         <DependsOn>Compile ComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Pasture</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Plant2">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Plant2</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Pond">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Pond</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile ProtocolManager">
         <DependsOn>Compile Protocol</DependsOn>
         <DependsOn>Compile ComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/ProtocolManager</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Report">
         <DependsOn>Compile ComponentInterface2</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Report</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Root">
         <DependsOn>Compile DotNetProxies</DependsOn>
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Root</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SOI">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SOI</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SoilErosion">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SoilErosion</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SoilN">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SoilN</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SoilNitrogen">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SoilNitrogen</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SoilP">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SoilP</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SoilTemp">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SoilTemp</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SoilTemp2">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SoilTemp2</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SoilWat">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SoilWat</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SoilWater">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SoilWater</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SoilWater2">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SoilWater2</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Solute">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Solute</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Solute2">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Solute2</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SlopeEffectsOnWeather">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SlopeEffectsOnWeather</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Sorghum">
         <DependsOn>Compile ComponentInterface2</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Sorghum</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Stock">
         <DependsOn>Compile ComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Stock</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Sugar">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <DependsOn>Compile CropTemplate</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Sugar</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>   
      <Job name="Compile Supplement">
         <DependsOn>Compile ComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Supplement</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Surface">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Surface</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SurfaceOM">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SurfaceOM</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SurfaceTemp">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SurfaceTemp</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SWIM2">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SWIM2</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SWIM3">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SWIM3</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SWIMDotNet">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SWIM3DotNet</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SysBal">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SysBal</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile TclLink">
         <DependsOn>Compile ComponentInterface2</DependsOn>
         <WorkingDirectory>%APSIM%/Model/TclLink</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Textoutput">
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Textoutput</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Tracker">
         <DependsOn>Compile ComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Tracker</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Tree">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Tree</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile UrinePatch">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/UrinePatch</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile VenLink">
         <DependsOn>Compile ComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/VenLink</WorkingDirectory>
         <CommandLine>make</CommandLine>
         <CommandLineUnix>/bin/true</CommandLineUnix>
      </Job>
      <Job name="Compile WaterAllocator">
 	       <DependsOn>Compile CMPServices</DependsOn>	
         <WorkingDirectory>%APSIM%/Model/WaterAllocator</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile WaterSupply">
         <DependsOn>Compile FortranInfrastructure</DependsOn>
         <DependsOn>Compile FortranComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/WaterSupply</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile YieldProphet">
         <DependsOn>Compile ComponentInterface</DependsOn>
         <WorkingDirectory>%APSIM%/Model/YieldProphet</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile DDRules">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/DDRules</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile FarmSimGraze">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/FarmSimGraze</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile ApsimToSim">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile ApsimFile</DependsOn>
         <WorkingDirectory>%APSIM%/Model/ApsimToSim</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile ConToApsim">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile ApsimFile</DependsOn>
         <WorkingDirectory>%APSIM%/Model/ConToApsim</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile ConToSim">
         <DependsOn>Compile General</DependsOn>
         <DependsOn>Compile ApsimShared</DependsOn>
         <WorkingDirectory>%APSIM%/Model/ConToSim</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SetXMLValue">
         <DependsOn>Compile CSGeneral</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SetXMLValue</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Plant2Documentation">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile Plant2</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Plant2Documentation</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile RunMacro">
         <DependsOn>Compile ApsimFile</DependsOn>
         <WorkingDirectory>%APSIM%/Model/RunMacro</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile UpdateDotNetProxies">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile ApsimFile</DependsOn>
         <WorkingDirectory>%APSIM%/Model/UpdateDotNetProxies</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SlurryTank">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SlurryTank</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile StandardProducts">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/StandardProducts</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile PH">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/PH</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile pigs">
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/pigs</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile PigHousing">
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/PigHousing</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile FeedItem">
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/FeedItem</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile atmosphere">
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/atmosphere</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile simpleBuilding">
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/simpleBuilding</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile ExcelUtility">
         <DependsOn>Compile ApsimUI</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Excel</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile ApsimUI">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile ConToApsim</DependsOn>
         <DependsOn>Compile ApsimFile</DependsOn>
         <WorkingDirectory>%APSIM%/Model/ApsimUI</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile Apsim.exe">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile ApsimFile</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Apsim</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile ShellExtensions">
         <WorkingDirectory>%APSIM%/Model/ShellExtensions</WorkingDirectory>
         <CommandLine>make</CommandLine>
         <CommandLineUnix>/bin/true</CommandLineUnix>
      </Job>
      <Job name="Compile ApsimModel">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile ComponentInterface</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/ApsimModel</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile SoilArbitrator">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile ComponentInterface</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/SoilArbitrator</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>	
	  <Job name="Compile Agroforestry">
         <DependsOn>Compile CSGeneral</DependsOn>
         <DependsOn>Compile CSDotNetComponentInterface</DependsOn>
         <DependsOn>Compile CMPServices</DependsOn>
         <DependsOn>Compile ComponentInterface</DependsOn>
         <DependsOn>Compile DotNetProxies</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Agroforestry</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile CreatePatch">
         <DependsOn>Compile CSGeneral</DependsOn>
         <WorkingDirectory>%APSIM%/Model/JobScheduler/CreatePatch</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Compile tav_amp">
         <WorkingDirectory>%APSIM%/Model/TavAmp</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
   </Target>
   <Target name="Post-Compile">
      <DependsOn>Compile</DependsOn>
      <Job name="Delete old .NET proxy classes">
         <WorkingDirectory>%APSIM%/Model/DotNetProxies</WorkingDirectory>
         <CommandLine>%APSIM%\Model\Build\DeleteFileIfExists.bat DotNetProxies.cs</CommandLine>
         <CommandLineUnix>/bin/rm -f DotNetProxies.cs</CommandLineUnix>
      </Job>
      <Job name="Create new .NET proxy classes">
         <DependsOn>Delete old .NET proxy classes</DependsOn>
         <WorkingDirectory>%APSIM%/Model</WorkingDirectory>
         <CommandLine>UpdateDotNetProxies.exe</CommandLine>
         <CommandLineUnix>mono UpdateDotNetProxies.exe</CommandLineUnix>
      </Job>
   </Target>

   <!-- ############### Release target ############### -->
   <Target name="Release">
      <DependsOn>BobBuildAndRun</DependsOn>
      <Job name="Compile InsertFilesIntoSetup">
         <WorkingDirectory>%APSIM%/Release/InsertFilesIntoSetup</WorkingDirectory>
         <CommandLine>make</CommandLine>
         <CommandLineUnix>/bin/true</CommandLineUnix>
      </Job>
      <Job name="Create Bootleg MSI">
	     <DependsOn>Compile InsertFilesIntoSetup</DependsOn>
         <WorkingDirectory>%APSIM%/Release</WorkingDirectory>
         <CommandLine>%APSIM%\Release\CreateInstall.bat %sha1%.Bootleg Bootleg</CommandLine>
         <CommandLineUnix>/bin/true</CommandLineUnix>
      </Job>
      <Job name="Create Release MSI">
	     <DependsOn>Compile InsertFilesIntoSetup</DependsOn>
         <WorkingDirectory>%APSIM%\Release</WorkingDirectory>
         <CommandLine>%APSIM%\Release\CreateInstall.bat %sha1%.ApsimSetup ApsimSetup</CommandLine>
         <CommandLineUnix>/bin/true</CommandLineUnix>
      </Job>
      <Job name="Create SFX Binaries">
       <WorkingDirectory>%APSIM%/Release</WorkingDirectory>
       <CommandLine>%APSIM%/Release/Release.bat %sha1%</CommandLine>
       <CommandLineUnix>%APSIM%/Release/Release.sh %sha1%</CommandLineUnix>
      </Job>
	  <Job name="Create Diff Zip">
        <WorkingDirectory>%APSIM%</WorkingDirectory>
        <CommandLine>%APSIM%/Model/CreateDiffZip.exe Directory=%APSIM% PatchFileName=%sha1%</CommandLine>
      </Job>
   </Target>

   <!-- ############### The Bob target is used by Bob ############### -->
   <Target name="BobBuildAndRun">
      <DependsOn>Pre-Compile</DependsOn>
      <DependsOn>Compile</DependsOn>
      <DependsOn>Post-Compile</DependsOn>
      <DependsOn>RunAll</DependsOn>
   </Target>

   <Target name="Bob">
      <DependsOn IgnoreErrors="true">Release</DependsOn>
      <Job name="Upload SFX Binaries 1">
         <WorkingDirectory>%APSIM%/Release</WorkingDirectory>
         <CommandLine>cmd.exe /c copy %PatchFileNameShort%.binaries.WINDOWS.INTEL.exe C:\inetpub\wwwroot\Files</CommandLine>
      </Job>
      <Job name="Upload SFX Binaries 2">
         <WorkingDirectory>%APSIM%/Release</WorkingDirectory>
         <CommandLine>cmd.exe /c copy %PatchFileNameShort%.binaries.WINDOWS.X86_64.exe C:\inetpub\wwwroot\Files</CommandLine>
      </Job>
	  <Job name="CreateBinariesZip">
	  	<WorkingDirectory>%APSIM%/Model</WorkingDirectory>
	  	<CommandLine>"C:\Program Files\7-Zip\7z.exe" a -mx=9 -mmt=on C:\inetpub\wwwroot\Files\%PatchFileNameShort%.binaries.zip %APSIM%\Model\*.exe %APSIM%\Model\*.dll</CommandLine>
	  </Job>
   </Target>

   <Target name="LinuxX64">
    <DependsOn IgnoreErrors="true">BobBuildAndRun</DependsOn>
    <DependsOn IgnoreErrors="true">Release</DependsOn>
    <Job name="Upload X64 SFX Binaries">
      <WorkingDirectory>%APSIM%/Release</WorkingDirectory>
      <CommandLineUnix>curl -T %PatchFileNameShort%.binaries.LINUX.X86_64.exe -u bob:seg ftp://bob.apsim.info/Files/</CommandLineUnix>
    </Job>
    <Job name="Create X64 Diff Zip">
      <WorkingDirectory>%APSIM%</WorkingDirectory>
      <CommandLine>%APSIM%/Model/CreateDiffZip.exe Directory=%APSIM% PatchFileName=%PatchFileName%</CommandLine>
    </Job>
    <Job name="Upload X64 Diff Zip">
       <DependsOn IgnoreErrors="true">Create X64 Diff Zip</DependsOn>
       <WorkingDirectory>%APSIM%</WorkingDirectory>
       <CommandLineUnix>curl -T %PatchFileNameShort%.diffs.zip -u bob:seg ftp://bob.apsim.info/Files/%PatchFileNameShort%.Linux.diffs.zip</CommandLineUnix>
    </Job>
   </Target>

   <!-- ############### Testing targets ############### -->
    <Target name="FindTests">
      <DependsOn>Clean</DependsOn>
      <FindJob name="Find .apsim Tests">
         <FileSpec>%APSIM%/Tests/*.apsim</FileSpec>
         <TargetFolder>Tests</TargetFolder>
      </FindJob>
      <FindJob name="Find .con Tests">
         <FileSpec>%APSIM%/Tests/*.con</FileSpec>
         <TargetFolder>Tests</TargetFolder>
      </FindJob>	  
      <FindJob name="Find Examples">
         <FileSpec>%APSIM%/Examples/*.apsim</FileSpec>
         <TargetFolder>Tests</TargetFolder>
      </FindJob>
      <Job name="Remove all .out and .sum files from Examples folder">
         <WorkingDirectory>%APSIM%/Examples</WorkingDirectory>
         <CommandLine>%APSIM%\Model\Build\RemoveOutAndSumFiles.bat</CommandLine>
         <CommandLineUnix>find . ( -name "*.out" -or -name "*.sum" ) -exec /bin/rm {} ;</CommandLineUnix>
      </Job>
      <Job name="Remove all .out and .sum files from Tests folder">
         <WorkingDirectory>%APSIM%/Tests</WorkingDirectory>
         <CommandLine>%APSIM%\Model\Build\RemoveOutAndSumFiles.bat</CommandLine>
         <CommandLineUnix>find . ( -name "*.out" -or -name "*.sum" ) -exec /bin/rm {} ;</CommandLineUnix>
      </Job>
   </Target>
   <Target name="RunAll">
      <DependsOn>Post-Compile</DependsOn>
      <DependsOn>Tests</DependsOn>
      <Job name="Unit tests">
         <WorkingDirectory>%APSIM%/Model/Build</WorkingDirectory>
         <CommandLine>%APSIM%/Model/Build/RunAllUnitTests.bat</CommandLine>
         <CommandLineUnix>/bin/true</CommandLineUnix>
      </Job>
	  <Job name="RestoreTestPackages">
		<WorkingDirectory>%APSIM%/Model/Tests</WorkingDirectory>
		<CommandLine>nuget restore -verbosity quiet</CommandLine>
	  </Job>
      <Job name="Compile Tests">
	     <DependsOn>RestoreTestPackages</DependsOn>
         <WorkingDirectory>%APSIM%/Model/Tests</WorkingDirectory>
         <CommandLine>make</CommandLine>
      </Job>
      <Job name="Apsim NUNIT tests">
         <DependsOn>Compile Tests</DependsOn>
         <WorkingDirectory>%APSIM%/Model</WorkingDirectory>
         <CommandLine>APSIM.Tests.exe --out=%APSIM%/Model/Tests/APSIM.Tests.out  --workers=1 --noresult</CommandLine>
      </Job>   
   </Target>

  <!-- ############### All test simulations will go here ############### -->
   <Target name="Tests">
      <DependsOn>Post-Compile</DependsOn>
      <DependsOn>FindTests</DependsOn>
   </Target>
</Project>
